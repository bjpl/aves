# ============================================================================
# AVES BACKEND - ENVIRONMENT CONFIGURATION (EXAMPLE)
# ============================================================================
# This file contains all required environment variables for the application.
# Copy this file to .env and fill in your actual values.
# NEVER commit .env files with real secrets to version control!
# ============================================================================

# ----------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ----------------------------------------------------------------------------
# Local PostgreSQL Configuration (for local development)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=aves
DB_USER=postgres
DB_PASSWORD=postgres

# Supabase Database Configuration (for production/Railway deployment)
# IMPORTANT: When using Supabase pooler, you MUST use port 6543 (transaction mode), NOT 5432
# Example DATABASE_URL format:
# DATABASE_URL=postgresql://postgres.PROJECT_REF:PASSWORD@aws-0-us-west-1.pooler.supabase.com:6543/postgres
SUPABASE_PROJECT_REF=your_project_ref_here
SUPABASE_PASSWORD=your_password_here

# Database Connection Pool (Performance Optimization)
DB_POOL_MAX=20            # Maximum number of connections in pool
DB_POOL_MIN=5             # Minimum number of connections to maintain
DB_STATEMENT_TIMEOUT=10000 # Statement timeout in milliseconds (10s)
DB_QUERY_TIMEOUT=10000    # Query timeout in milliseconds (10s)
DB_DEBUG=false            # Enable detailed connection pool logging

# Database SSL Configuration (Production)
# Set to 'true' in production to enable encrypted database connections
DB_SSL_ENABLED=false
# Optional: Path to Certificate Authority certificate for SSL verification
# DB_SSL_CA=/path/to/ca-certificate.crt

# ----------------------------------------------------------------------------
# SERVER CONFIGURATION
# ----------------------------------------------------------------------------
PORT=3001
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# Server Security
# Enable this ONLY in development for testing without authentication
DEV_AUTH_BYPASS=false

# Logging Configuration
LOG_LEVEL=info            # Options: trace, debug, info, warn, error, fatal
LOG_FILE=./logs/app.log   # Path to log file (optional, logs to console if not set)
LOG_REQUESTS=true         # Enable request logging
LOG_SANITIZE=true         # Sanitize sensitive data in logs

# ----------------------------------------------------------------------------
# AUTHENTICATION & SECURITY
# ----------------------------------------------------------------------------
# JWT Authentication
# SECURITY CRITICAL: In production, use a strong random secret (min 32 characters)
# Generate a strong secret with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# NEVER use default values in production - the server will reject weak secrets
JWT_SECRET=your-secret-key-here-change-in-production
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# Password Security
# Bcrypt rounds for password hashing (10-12 recommended, higher = slower but more secure)
BCRYPT_ROUNDS=10

# Session Configuration
SESSION_SECRET=change-this-session-secret-in-production-use-random-string
SESSION_MAX_AGE=86400000  # 24 hours in milliseconds

# API Key Configuration (for external API access)
# Generate with: node -e "console.log(require('crypto').randomBytes(24).toString('hex'))"
API_KEY_SECRET=your-api-key-secret-here
API_KEY_HEADER=X-API-Key

# ----------------------------------------------------------------------------
# RATE LIMITING
# ----------------------------------------------------------------------------
# Express Rate Limiting Configuration
RATE_LIMIT_WINDOW_MS=900000      # Window in milliseconds (15 minutes = 900000ms)
RATE_LIMIT_MAX_REQUESTS=100      # Maximum requests per window per IP
RATE_LIMIT_MESSAGE=Too many requests, please try again later

# Strict rate limiting for sensitive endpoints (auth, password reset, etc.)
RATE_LIMIT_STRICT_WINDOW_MS=900000    # 15 minutes
RATE_LIMIT_STRICT_MAX_REQUESTS=5      # Only 5 attempts per window

# API rate limiting for authenticated requests
RATE_LIMIT_API_WINDOW_MS=60000   # 1 minute
RATE_LIMIT_API_MAX_REQUESTS=60   # 60 requests per minute

# ----------------------------------------------------------------------------
# CORS CONFIGURATION
# ----------------------------------------------------------------------------
# Allowed origins for CORS (comma-separated list)
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400  # Preflight cache duration in seconds (24 hours)

# ----------------------------------------------------------------------------
# CONTENT SECURITY POLICY (CSP)
# ----------------------------------------------------------------------------
CSP_ENABLED=true
CSP_REPORT_ONLY=false                    # Set to true for testing CSP without blocking
CSP_REPORT_URI=                          # Optional: endpoint to receive CSP violation reports
CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self'
CSP_STYLE_SRC='self','unsafe-inline'     # Allow inline styles for React
CSP_IMG_SRC='self',data:,https:
CSP_FONT_SRC='self',data:
CSP_CONNECT_SRC='self',http://localhost:5173
CSP_FRAME_SRC='none'
CSP_OBJECT_SRC='none'

# ----------------------------------------------------------------------------
# FILE UPLOAD CONFIGURATION
# ----------------------------------------------------------------------------
MAX_FILE_SIZE=10485760     # 10MB in bytes
UPLOAD_DIR=./uploads
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,image/webp
MAX_FILES_PER_REQUEST=5

# ----------------------------------------------------------------------------
# EXTERNAL API KEYS
# ----------------------------------------------------------------------------
# Unsplash API (for bird images)
UNSPLASH_ACCESS_KEY=your_unsplash_key_here
UNSPLASH_SECRET_KEY=your_unsplash_secret_here

# Anthropic Claude Configuration (Primary AI Provider)
# Get your API key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-5-20250929
ANTHROPIC_MAX_TOKENS=8192
ANTHROPIC_TEMPERATURE=0.3

# Legacy OpenAI Configuration (deprecated - migrated to Claude on Oct 5, 2025)
# OPENAI_API_KEY=your_openai_api_key_here
# OPENAI_MODEL=gpt-4o
# OPENAI_VISION_MODEL=gpt-4o

# ----------------------------------------------------------------------------
# AI CONFIGURATION
# ----------------------------------------------------------------------------
# AI Feature Flags
ENABLE_VISION_AI=true
VISION_PROVIDER=claude
ENABLE_IMAGE_GENERATION=false
ENABLE_IMAGE_ANALYSIS=true
ENABLE_EXERCISE_GENERATION=true
ENABLE_BIRD_DETECTION=false  # Enable bird detection quality validation (uses Claude Vision API)

# AI Rate Limiting
VISION_API_TIMEOUT=30000           # 30 seconds
VISION_API_MAX_RETRIES=3
VISION_API_RETRY_DELAY=1000
VISION_RATE_LIMIT_PER_MINUTE=20

# Cost Tracking
ENABLE_COST_TRACKING=true
COST_ALERT_THRESHOLD=10.00

# ----------------------------------------------------------------------------
# SECURITY HEADERS
# ----------------------------------------------------------------------------
# HSTS (HTTP Strict Transport Security)
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000              # 1 year in seconds
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# Additional Security Headers
X_FRAME_OPTIONS=DENY               # Prevent clickjacking
X_CONTENT_TYPE_OPTIONS=nosniff     # Prevent MIME sniffing
X_XSS_PROTECTION=1; mode=block     # Enable XSS protection
REFERRER_POLICY=strict-origin-when-cross-origin

# ----------------------------------------------------------------------------
# INPUT VALIDATION & SANITIZATION
# ----------------------------------------------------------------------------
# Enable strict input validation
ENABLE_INPUT_VALIDATION=true
ENABLE_INPUT_SANITIZATION=true

# Maximum request body size
MAX_REQUEST_BODY_SIZE=10mb

# SQL Injection Protection
ENABLE_PARAMETERIZED_QUERIES=true

# XSS Protection
ENABLE_HTML_SANITIZATION=true

# ----------------------------------------------------------------------------
# MONITORING & ALERTS
# ----------------------------------------------------------------------------
# Error Tracking (e.g., Sentry)
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# Health Check Configuration
HEALTH_CHECK_INTERVAL=30000        # 30 seconds
HEALTH_CHECK_TIMEOUT=5000          # 5 seconds

# ----------------------------------------------------------------------------
# BACKUP & RECOVERY
# ----------------------------------------------------------------------------
# Database backup configuration
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *          # Cron format: daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_DIR=./backups

# ----------------------------------------------------------------------------
# PRODUCTION ONLY SETTINGS
# ----------------------------------------------------------------------------
# These settings should ONLY be enabled in production

# Force HTTPS (redirect HTTP to HTTPS)
FORCE_HTTPS=false

# Trust proxy headers (enable if behind reverse proxy like nginx)
TRUST_PROXY=false

# Secure cookies (requires HTTPS)
SECURE_COOKIES=false

# ----------------------------------------------------------------------------
# DEVELOPMENT ONLY SETTINGS
# ----------------------------------------------------------------------------
# These settings should NEVER be enabled in production

# Enable detailed error messages
VERBOSE_ERRORS=true

# Enable source maps
SOURCE_MAPS=true

# Enable hot reload
HOT_RELOAD=true

# ----------------------------------------------------------------------------
# NOTES
# ----------------------------------------------------------------------------
# 1. Generate strong secrets using: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# 2. All secrets should be at least 32 characters long
# 3. Never use default values in production
# 4. Never commit .env files with real values to version control
# 5. Use environment-specific .env files (.env.production, .env.staging, etc.)
# 6. Regularly rotate secrets and API keys
# 7. Use a secrets manager (e.g., AWS Secrets Manager, HashiCorp Vault) in production
