import{r as e,j as s,L as a}from"./react-vendor-D6vaw4E_.js";import{e as t,u as n}from"./index-BZZsyLrt.js";import{u as l}from"./useSpecies-C2tKR62b.js";import{a as i,M as r,C as o,b as c,c as d,d as m}from"./Modal-D9jlqUyx.js";import{B as x,A as h,u as g,T as u}from"./ToastContainer-ntMMWNyK.js";import{B as p}from"./Badge-DLWuO9O4.js";import{P as j}from"./ProgressBar-BiRo9b8T.js";import{L as b}from"./LazyImage-BuJprSXT.js";import{a as y,u as v,b as f}from"./data-vendor-CRo3OXJP.js";import"./vendor-BKIB45Nt.js";import"./apiAdapter-Dz5wFEMq.js";const N={all:["image-management"],dashboard:()=>[...N.all,"dashboard"],stats:()=>[...N.all,"stats"],quota:()=>[...N.all,"quota"],jobs:()=>[...N.all,"jobs"],pendingImages:()=>[...N.all,"pending-images"],gallery:(e,s,a)=>[...N.all,"gallery",{page:e,status:s,speciesId:a}]},w=()=>{const e=y(),{data:s,isLoading:a,refetch:n}=v({queryKey:N.dashboard(),queryFn:async()=>{try{return(await i.get("/api/admin/dashboard")).data.data}catch(e){return t("Error fetching dashboard:",e instanceof Error?e:new Error(String(e))),{stats:{totalImages:0,pendingAnnotation:0,annotated:0,failed:0,bySpecies:{}},quota:{unsplash:{remaining:50,limit:50,resetTime:null},anthropic:{remaining:1e3,limit:1e3,resetTime:null}},jobs:[],hasActiveJobs:!1}}},staleTime:3e4,gcTime:3e5}),l=s?.hasActiveJobs||!1,{data:r}=((e=!1)=>v({queryKey:N.jobs(),queryFn:async()=>{try{return(await i.get("/api/admin/images/jobs")).data.jobs}catch(e){return t("Error fetching jobs:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:1e4,gcTime:3e5,refetchInterval:!!e&&3e3}))(l),o=l&&r?r:s?.jobs||[],{data:c=[]}=v({queryKey:N.pendingImages(),queryFn:async()=>{try{return(await i.get("/api/admin/images/pending")).data.data}catch(e){return t("Error fetching pending images:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:3e4,gcTime:3e5}),d=(()=>{const e=y();return f({mutationFn:async e=>(await i.post("/api/admin/images/collect",e)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:N.dashboard()}),e.invalidateQueries({queryKey:N.jobs()}),e.invalidateQueries({queryKey:N.stats()}),e.invalidateQueries({queryKey:N.quota()})},onError:e=>{t("Error starting image collection:",e instanceof Error?e:new Error(String(e)))}})})(),m=(()=>{const e=y();return f({mutationFn:async e=>(await i.post("/api/admin/images/annotate",e)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:N.dashboard()}),e.invalidateQueries({queryKey:N.jobs()}),e.invalidateQueries({queryKey:N.stats()}),e.invalidateQueries({queryKey:N.quota()}),e.invalidateQueries({queryKey:N.pendingImages()})},onError:e=>{t("Error starting annotation:",e instanceof Error?e:new Error(String(e)))}})})(),x=(()=>{const e=y();return f({mutationFn:async e=>(await i.post("/api/admin/images/bulk/delete",{imageIds:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:N.all})},onError:e=>{t("Error deleting images:",e instanceof Error?e:new Error(String(e)))}})})(),h=(()=>{const e=y();return f({mutationFn:async e=>(await i.post("/api/admin/images/bulk/annotate",{imageIds:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:N.dashboard()}),e.invalidateQueries({queryKey:N.jobs()}),e.invalidateQueries({queryKey:N.stats()})},onError:e=>{t("Error starting bulk annotation:",e instanceof Error?e:new Error(String(e)))}})})(),g=(()=>{const e=y();return f({mutationFn:async e=>(await i.post("/api/admin/images/bulk/undo",{operationId:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:N.all})},onError:e=>{t("Error undoing bulk operation:",e instanceof Error?e:new Error(String(e)))}})})();return{stats:s?.stats,quota:s?.quota,jobs:o,pendingImages:c,isLoading:a,hasActiveJobs:l,refetchStats:()=>(e.invalidateQueries({queryKey:N.dashboard()}),n()),collectMutation:d,annotateMutation:m,bulkDeleteMutation:x,bulkAnnotateMutation:h,undoMutation:g}},k=({species:a,selected:t,onChange:n,disabled:l=!1})=>{const[i,r]=e.useState(""),[o,c]=e.useState(!1),d=a.filter(e=>e.englishName?.toLowerCase().includes(i.toLowerCase())||e.spanishName?.toLowerCase().includes(i.toLowerCase())||e.scientificName?.toLowerCase().includes(i.toLowerCase()));return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"border rounded-lg p-3 cursor-pointer "+(l?"bg-gray-100 cursor-not-allowed":"bg-white hover:border-blue-500"),onClick:()=>!l&&c(!o),children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-700",children:0===t.length?"Select species...":`${t.length} species selected`}),s.jsx("svg",{className:"w-5 h-5 text-gray-400 transition-transform "+(o?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),t.length>0&&s.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.slice(0,5).map(e=>{const t=a.find(s=>s.id===e);return s.jsx(p,{variant:"primary",size:"sm",children:t?.englishName||e},e)}),t.length>5&&s.jsxs(p,{variant:"default",size:"sm",children:["+",t.length-5," more"]})]})]}),o&&!l&&s.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-80 overflow-hidden",children:[s.jsx("div",{className:"p-2 border-b",children:s.jsx("input",{type:"text",placeholder:"Search species...",className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:i,onChange:e=>r(e.target.value),onClick:e=>e.stopPropagation()})}),s.jsxs("div",{className:"p-2 border-b flex gap-2",children:[s.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-800",onClick:e=>{e.stopPropagation(),n(d.map(e=>e.id))},children:"Select All"}),s.jsx("span",{className:"text-gray-300",children:"|"}),s.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:e=>{e.stopPropagation(),n([])},children:"Clear All"})]}),s.jsxs("div",{className:"max-h-52 overflow-y-auto",children:[d.map(e=>s.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",onClick:e=>e.stopPropagation(),children:[s.jsx("input",{type:"checkbox",checked:t.includes(e.id),onChange:()=>{return s=e.id,void(t.includes(s)?n(t.filter(e=>e!==s)):n([...t,s]));var s},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),s.jsxs("span",{className:"ml-3",children:[s.jsx("span",{className:"font-medium",children:e.englishName}),s.jsx("span",{className:"text-gray-500 text-sm ml-2",children:e.scientificName})]})]},e.id)),0===d.length&&s.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"No species found"})]})]})]})},C=({selectedCount:e,onSelectAll:a,onDeselectAll:t,onDelete:n,onAnnotate:l,isDeleting:i,isAnnotating:r,totalCount:o,allSelected:c})=>0===e?null:s.jsx("div",{className:"sticky top-[140px] z-20 bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 shadow-sm",children:s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"font-medium text-blue-900",children:[e," image",1!==e?"s":""," selected"]}),s.jsxs("div",{className:"flex gap-2",children:[!c&&o>0&&s.jsxs("button",{type:"button",onClick:a,className:"text-sm text-blue-600 hover:text-blue-800 underline",children:["Select all ",o]}),s.jsx("button",{type:"button",onClick:t,className:"text-sm text-gray-600 hover:text-gray-800 underline",children:"Deselect all"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(x,{variant:"secondary",size:"sm",onClick:l,isLoading:r,disabled:r||i,children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Annotate Selected"]}),s.jsxs(x,{variant:"danger",size:"sm",onClick:n,isLoading:i,disabled:r||i,children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Selected"]})]})]})}),S=({isOpen:e,onClose:a,onConfirm:t,count:n,isDeleting:l})=>e?s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),s.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:s.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delete ",n," image",1!==n?"s":"","?"]}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"This action cannot be undone. All selected images and their associated annotations will be permanently deleted."})]})]}),s.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[s.jsx(x,{variant:"secondary",onClick:a,disabled:l,children:"Cancel"}),s.jsx(x,{variant:"danger",onClick:t,isLoading:l,disabled:l,children:"Delete"})]})]})]}):null,L=({className:e=""})=>s.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${e}`}),A=()=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 text-center",children:[s.jsx(L,{className:"h-8 w-16 mx-auto mb-2"}),s.jsx(L,{className:"h-4 w-24 mx-auto"})]}),I=()=>s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(A,{}),s.jsx(A,{}),s.jsx(A,{}),s.jsx(A,{})]}),P=()=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-10 w-full"})]}),M=()=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(L,{className:"h-5 w-24"}),s.jsx(L,{className:"h-5 w-16 rounded-full"})]}),s.jsx(L,{className:"h-2 w-full rounded-full mb-2"}),s.jsx(L,{className:"h-4 w-32"})]}),E=()=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/3 mb-2"}),s.jsx(L,{className:"h-4 w-2/3 mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(M,{}),s.jsx(M,{})]})]}),D=({count:e=8})=>s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:e}).map((e,a)=>s.jsx("div",{className:"aspect-square",children:s.jsx(L,{className:"h-full w-full rounded-lg"})},a))}),q=()=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(L,{className:"h-4 w-24"}),s.jsx(L,{className:"h-3 w-full rounded-full"}),s.jsx(L,{className:"h-3 w-32"})]}),z=()=>s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/3 mb-2"}),s.jsx(L,{className:"h-4 w-2/3 mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(P,{}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(L,{className:"h-4 w-40"}),s.jsx(L,{className:"h-10 w-full"}),s.jsx(L,{className:"h-3 w-48"})]})]}),s.jsx("div",{className:"mt-6 pt-4 border-t",children:s.jsx(L,{className:"h-10 w-40"})})]}),s.jsx(E,{})]}),T=()=>s.jsxs("div",{className:"space-y-6",children:[s.jsx(I,{}),s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/4 mb-2"}),s.jsx(L,{className:"h-4 w-1/3 mb-6"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(q,{}),s.jsx(q,{})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/3 mb-2"}),s.jsx(L,{className:"h-4 w-1/2 mb-6"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:8}).map((e,a)=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[s.jsx(L,{className:"h-6 w-8 mx-auto mb-1"}),s.jsx(L,{className:"h-3 w-20 mx-auto"})]},a))})]})]}),F=()=>s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(L,{className:"h-10 w-48"}),s.jsx(L,{className:"h-10 w-32"})]}),s.jsx(D,{count:12}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx(L,{className:"h-10 w-24"}),s.jsx(L,{className:"h-10 w-10"}),s.jsx(L,{className:"h-10 w-10"}),s.jsx(L,{className:"h-10 w-10"}),s.jsx(L,{className:"h-10 w-24"})]})]}),B=()=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/4 mb-2"}),s.jsx(L,{className:"h-4 w-1/3 mb-6"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-4 pb-3 border-b",children:[s.jsx(L,{className:"h-4 w-16"}),s.jsx(L,{className:"h-4 w-16"}),s.jsx(L,{className:"h-4 w-24"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-20"})]}),Array.from({length:5}).map((e,a)=>s.jsxs("div",{className:"flex gap-4 py-3 border-b border-gray-100",children:[s.jsx(L,{className:"h-5 w-16 rounded-full"}),s.jsx(L,{className:"h-5 w-16 rounded-full"}),s.jsx(L,{className:"h-3 w-24 rounded-full"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-20"})]},a))]})]}),$=({activeTab:e})=>{switch(e){case"collection":case"annotation":default:return s.jsx(z,{});case"gallery":return s.jsx(F,{});case"statistics":return s.jsx(T,{});case"history":return s.jsx(B,{})}},Q=({operationId:a,message:n,itemCount:l,expiresAt:i,onUndo:r,onExpire:o,onDismiss:c})=>{const[d,m]=e.useState(30),[x,h]=e.useState(!1),[g,u]=e.useState(!1);e.useEffect(()=>{const e=()=>{const e=(new Date).getTime(),s=new Date(i).getTime();return Math.max(0,Math.ceil((s-e)/1e3))};m(e());const s=setInterval(()=>{const a=e();m(a),a<=0&&(clearInterval(s),o&&!g&&o())},1e3);return()=>clearInterval(s)},[i,o,g]);if(g||d<=0)return null;const p=d/30*100;return s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-slide-up",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-2xl border-2 border-orange-400 overflow-hidden",children:[s.jsx("div",{className:"h-1 bg-gray-200",children:s.jsx("div",{className:"h-full bg-orange-500 transition-all duration-1000 ease-linear",style:{width:`${p}%`}})}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:s.jsx("svg",{className:"w-6 h-6 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:n}),s.jsxs("p",{className:"text-sm text-gray-600",children:[l," item",1!==l?"s":""," will be deleted in"," ",s.jsxs("span",{className:"font-bold text-orange-600",children:[d,"s"]})]})]}),s.jsx("button",{type:"button",onClick:()=>{u(!0),c&&c()},className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",disabled:x,children:s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),s.jsx("div",{className:"flex gap-2 mt-3",children:s.jsx("button",{type:"button",onClick:async()=>{h(!0);try{await r(a),u(!0)}catch(e){t("Failed to undo operation",e instanceof Error?e:{error:e}),h(!1)}},disabled:x,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 disabled:bg-orange-400 text-white font-medium rounded-md transition-colors flex items-center justify-center gap-2",children:x?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Undoing..."]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),"Undo"]})})})]})]})})},O={all:["gallery"],list:e=>[...O.all,"list",e],detail:e=>[...O.all,"detail",e]},R=({onFilesSelected:a,disabled:t})=>{const[n,l]=e.useState(!1),i=e.useRef(null),r=e.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),o=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.items&&e.dataTransfer.items.length>0&&l(!0)},[]),c=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),l(!1)},[]),d=e.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),l(!1),t)return;const s=Array.from(e.dataTransfer.files).filter(e=>["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type));s.length>0&&a(s)},[a,t]),m=e.useCallback(e=>{if(e.target.files&&e.target.files.length>0){const s=Array.from(e.target.files);a(s)}},[a]);return s.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer\n        transition-all duration-200\n        ${n?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}\n        ${t?"opacity-50 cursor-not-allowed":""}\n      `,onDragEnter:o,onDragLeave:c,onDragOver:r,onDrop:d,onClick:()=>{t||i.current?.click()},children:[s.jsx("input",{ref:i,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:m,className:"hidden",disabled:t}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto "+(n?"text-blue-500":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-medium text-gray-700",children:n?"Drop images here":"Drag & drop images here"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"or click to browse files"})]}),s.jsx("p",{className:"text-xs text-gray-400",children:"Supports: JPEG, PNG, WebP (max 10MB each, up to 20 files)"})]})]})},U=({files:e,onRemove:a,disabled:t})=>0===e.length?null:s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Selected Files (",e.length,")"]})}),s.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-1",children:e.map(e=>s.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-200",children:[s.jsx("img",{src:e.preview,alt:e.file.name,className:"w-full h-full object-cover"}),!t&&s.jsx("button",{type:"button",onClick:()=>a(e.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 px-1 py-0.5",children:s.jsx("p",{className:"text-xs text-white truncate",children:e.file.name})})]},e.id))})]}),K=({species:e,value:a,onChange:t,disabled:n})=>s.jsxs("div",{className:"mt-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Species ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{value:a,onChange:e=>t(e.target.value),disabled:n,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[s.jsx("option",{value:"",children:"Select a species..."}),e.map(e=>s.jsxs("option",{value:e.id,children:[e.englishName," (",e.scientificName,")"]},e.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All uploaded images will be associated with this species"})]}),W=({isOpen:a,onClose:n,species:l,onSuccess:o,onToast:c})=>{const[d,m]=e.useState([]),[g,u]=e.useState(""),[p,b]=e.useState(0),[v,N]=e.useState(null),w=(()=>{const e=y();return f({mutationFn:async({files:e,speciesId:s,onProgress:a})=>{const t=new FormData;return t.append("speciesId",s),e.forEach(e=>{t.append("files",e)}),(await i.post("/api/admin/images/upload",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total&&a){const s=Math.round(e.loaded/e.total*100);a(s)}}})).data},onSuccess:()=>{e.invalidateQueries({queryKey:["image-management"]}),e.invalidateQueries({queryKey:["gallery"]})},onError:e=>{t("Error uploading images:",e instanceof Error?e:new Error(String(e)))}})})(),k=e.useCallback(e=>{const s=e.map(e=>({file:e,preview:URL.createObjectURL(e),id:`${e.name}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}));m(e=>[...e,...s].slice(0,20)),N(null)},[]),C=e.useCallback(e=>{m(s=>{const a=s.find(s=>s.id===e);return a&&URL.revokeObjectURL(a.preview),s.filter(s=>s.id!==e)})},[]),S=()=>{d.forEach(e=>URL.revokeObjectURL(e.preview)),m([]),u(""),b(0),N(null),n()},L=w.isPending,A=d.length>0&&g&&!L;return s.jsx(r,{isOpen:a,onClose:S,title:"Upload Images",size:"lg",closeOnOverlayClick:!L,closeOnEscape:!L,children:s.jsxs("div",{className:"space-y-4",children:[v&&s.jsx(h,{variant:"danger",onClose:()=>N(null),children:v}),s.jsx(R,{onFilesSelected:k,disabled:L}),s.jsx(U,{files:d,onRemove:C,disabled:L}),s.jsx(K,{species:l,value:g,onChange:u,disabled:L}),L&&s.jsx("div",{className:"mt-4",children:s.jsx(j,{value:p,max:100,variant:"gradient",color:"primary",showLabel:!0,label:"Uploading...",animated:!0})}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[s.jsx(x,{variant:"secondary",onClick:S,disabled:L,children:"Cancel"}),s.jsxs(x,{variant:"primary",onClick:async()=>{if(0!==d.length)if(g){N(null),b(0);try{const e=await w.mutateAsync({files:d.map(e=>e.file),speciesId:g,onProgress:b});e.summary.successful>0&&(c("success",`Successfully uploaded ${e.summary.successful} image${1!==e.summary.successful?"s":""}`),o(),S()),e.failed&&e.failed.length>0&&c("error",`${e.failed.length} file${1!==e.failed.length?"s":""} failed to upload`)}catch{N("Upload failed. Please try again.")}}else N("Please select a species");else N("Please select at least one image")},disabled:!A,isLoading:L,children:["Upload ",d.length>0?`(${d.length})`:""]})]})]})})},H=e=>null==e?{variant:"info",label:"N/A"}:e>=80?{variant:"success",label:`${e}%`}:e>=60?{variant:"warning",label:`${e}%`}:{variant:"danger",label:`${e}%`},V=({species:e,filters:a,onFilterChange:t})=>s.jsxs("div",{className:"flex flex-wrap gap-4 p-4 bg-gray-50 rounded-lg mb-6",children:[s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Species"}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.speciesId||"",onChange:e=>t({speciesId:e.target.value||void 0,page:1}),children:[s.jsx("option",{value:"",children:"All Species"}),e.map(e=>s.jsx("option",{value:e.id,children:e.englishName},e.id))]})]}),s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Annotation Status"}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.annotationStatus||"all",onChange:e=>t({annotationStatus:e.target.value,page:1}),children:[s.jsx("option",{value:"all",children:"All Images"}),s.jsx("option",{value:"annotated",children:"Annotated"}),s.jsx("option",{value:"unannotated",children:"Unannotated"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quality"}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.qualityFilter||"all",onChange:e=>t({qualityFilter:e.target.value,page:1}),children:[s.jsx("option",{value:"all",children:"All Quality"}),s.jsx("option",{value:"high",children:"High (80-100)"}),s.jsx("option",{value:"medium",children:"Medium (60-79)"}),s.jsx("option",{value:"low",children:"Low (0-59)"}),s.jsx("option",{value:"unscored",children:"Unscored"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.sortBy||"createdAt",onChange:e=>t({sortBy:e.target.value}),children:[s.jsx("option",{value:"createdAt",children:"Date Added"}),s.jsx("option",{value:"speciesName",children:"Species Name"}),s.jsx("option",{value:"annotationCount",children:"Annotation Count"}),s.jsx("option",{value:"qualityScore",children:"Quality Score"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[150px]",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order"}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.sortOrder||"desc",onChange:e=>t({sortOrder:e.target.value}),children:[s.jsx("option",{value:"desc",children:"Newest First"}),s.jsx("option",{value:"asc",children:"Oldest First"})]})]})]}),G=({image:e,onView:a,onAnnotate:t,onDelete:n,isDeleting:l,isAnnotating:i,isSelected:r,onToggleSelect:o})=>s.jsxs("div",{className:"relative group bg-white rounded-lg shadow-sm border-2 overflow-hidden hover:shadow-md transition-all "+(r?"border-blue-500 ring-2 ring-blue-200":"border-gray-200"),children:[s.jsx("div",{className:"absolute top-2 left-2 z-10",children:s.jsx("label",{className:"flex items-center cursor-pointer",children:s.jsx("input",{type:"checkbox",checked:r,onChange:e=>{e.stopPropagation(),o()},className:"w-5 h-5 rounded border-2 border-gray-400 text-blue-600 focus:ring-2 focus:ring-blue-500 cursor-pointer bg-white/90 shadow-md hover:border-blue-500 transition-colors",title:r?"Click to deselect":"Click to select for batch actions","aria-label":r?"Deselect this image":"Select this image for batch actions"})})}),s.jsxs("div",{className:"relative aspect-[4/3] cursor-pointer",onClick:a,children:[s.jsx(b,{src:e.url,alt:e.speciesName,className:"w-full h-full object-cover"}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center",children:s.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium transition-opacity",children:"Click to view"})}),s.jsx("div",{className:"absolute bottom-2 left-2",children:(()=>{const a=H(e.qualityScore);return s.jsx(p,{variant:a.variant,size:"sm",title:"Quality: "+(null!==e.qualityScore?`${e.qualityScore}%`:"Not scored"),children:a.label})})()}),s.jsx("div",{className:"absolute bottom-2 right-2",children:s.jsx(p,{variant:e.annotationCount>0?"success":"warning",size:"sm",title:`${e.annotationCount} vocabulary annotation${1!==e.annotationCount?"s":""}`,children:e.annotationCount})})]}),s.jsxs("div",{className:"p-3",children:[s.jsx("h3",{className:"font-medium text-gray-900 truncate",title:e.speciesName,children:e.speciesName}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()}),s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx(x,{variant:"secondary",size:"sm",onClick:a,className:"w-full",title:"View details",children:"View"})}),0===e.annotationCount&&s.jsx("div",{className:"flex-1",children:s.jsx(x,{variant:"primary",size:"sm",onClick:t,isLoading:i,disabled:i,className:"w-full",title:"Generate annotations",children:"Annotate"})}),s.jsx("div",{children:s.jsx(x,{variant:"danger",size:"sm",onClick:n,isLoading:l,disabled:l,title:"Delete image",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]})]})]}),J=({page:e,totalPages:a,total:t,pageSize:n,onPageChange:l})=>{const i=(e-1)*n+1,r=Math.min(e*n,t);return s.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",i," to ",r," of ",t," images"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(x,{variant:"secondary",size:"sm",disabled:e<=1,onClick:()=>l(e-1),children:"Previous"}),s.jsxs("span",{className:"px-4 py-2 text-sm text-gray-600",children:["Page ",e," of ",a]}),s.jsx(x,{variant:"secondary",size:"sm",disabled:e>=a,onClick:()=>l(e+1),children:"Next"})]})]})},X=({imageId:a,isOpen:n,onClose:l,onAnnotate:o,onDelete:c,isAnnotating:d,isDeleting:m})=>{const{data:g,isLoading:u}=(e=>v({queryKey:O.detail(e||""),queryFn:async()=>{if(!e)return null;try{return(await i.get(`/api/admin/images/${e}`)).data.data}catch(s){return t("Error fetching image details:",s instanceof Error?s:new Error(String(s))),null}},enabled:!!e,staleTime:6e4,gcTime:3e5}))(n?a:null),[j,b]=e.useState(!0);return n?s.jsx(r,{isOpen:n,onClose:l,title:"Image Details",size:"xl",children:u?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):g?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-lg",children:[s.jsx("img",{src:g.url,alt:g.species?.englishName||"Bird image",className:"w-full"}),j&&g.annotations.filter(e=>"rejected"!==e.status).map(e=>{if(!e.boundingBox)return null;const a=Math.max(0,Math.min(1,e.boundingBox.x)),t=Math.max(0,Math.min(1,e.boundingBox.y)),n=Math.min(e.boundingBox.width,1-a),l=Math.min(e.boundingBox.height,1-t);return s.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-500 bg-opacity-20 rounded",style:{left:100*a+"%",top:100*t+"%",width:100*n+"%",height:100*l+"%"},title:`${e.spanishTerm} (${e.englishTerm})`,children:s.jsx("span",{className:"absolute -top-6 left-0 bg-blue-600 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:e.spanishTerm})},e.id)})]}),g.annotations.length>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"showAnnotations",checked:j,onChange:e=>b(e.target.checked),className:"rounded text-blue-600"}),s.jsx("label",{htmlFor:"showAnnotations",className:"text-sm text-gray-600",children:"Show annotation overlays"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Species"}),s.jsx("p",{className:"text-gray-600",children:g.species?.englishName||"Unknown"}),s.jsx("p",{className:"text-sm text-gray-500 italic",children:g.species?.scientificName}),s.jsx("p",{className:"text-sm text-gray-500",children:g.species?.spanishName})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Image Info"}),s.jsxs("p",{className:"text-sm text-gray-600",children:[g.width," x ",g.height]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"Quality:"}),(()=>{const e=H(g.qualityScore);return s.jsx(p,{variant:e.variant,size:"sm",children:e.label})})()]}),g.photographer&&s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Photo by ",g.photographer,g.photographerUsername&&s.jsxs("span",{className:"text-gray-400",children:[" ","(@",g.photographerUsername,")"]})]}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Added ",new Date(g.createdAt).toLocaleString()]})]})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["Annotations (",g.annotations.length,")"]}),0===g.annotations.length?s.jsx("p",{className:"text-gray-500 text-sm",children:"No annotations yet"}):s.jsx("div",{className:"max-h-48 overflow-y-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left py-2 px-3",children:"Spanish"}),s.jsx("th",{className:"text-left py-2 px-3",children:"English"}),s.jsx("th",{className:"text-left py-2 px-3",children:"Type"}),s.jsx("th",{className:"text-left py-2 px-3",children:"Status"}),s.jsx("th",{className:"text-left py-2 px-3",children:"Confidence"})]})}),s.jsx("tbody",{children:g.annotations.map(e=>s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"py-2 px-3 font-medium",children:e.spanishTerm}),s.jsx("td",{className:"py-2 px-3",children:e.englishTerm}),s.jsx("td",{className:"py-2 px-3",children:s.jsx(p,{variant:"info",size:"sm",children:e.annotationType})}),s.jsx("td",{className:"py-2 px-3",children:s.jsx(p,{variant:"approved"===e.status?"success":"rejected"===e.status?"danger":"warning",size:"sm",children:e.status})}),s.jsx("td",{className:"py-2 px-3",children:e.confidence?`${(100*e.confidence).toFixed(0)}%`:"-"})]},e.id))})]})})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[0===g.annotations.length&&s.jsx(x,{variant:"primary",onClick:o,isLoading:d,disabled:d,children:"Generate Annotations"}),s.jsx(x,{variant:"danger",onClick:c,isLoading:m,disabled:m,children:"Delete Image"}),s.jsx(x,{variant:"secondary",onClick:l,children:"Close"})]})]}):s.jsx(h,{variant:"danger",children:"Failed to load image details"})}):null},Y=({species:a,onToast:n,selectedImages:l,onSelectionChange:m})=>{const[h,g]=e.useState({page:1,pageSize:20,annotationStatus:"all",qualityFilter:"all",sortBy:"createdAt",sortOrder:"desc"}),[u,p]=e.useState(null),[j,b]=e.useState(null),[N,w]=e.useState(!1),[k,S]=e.useState([]),L=l??k,A=m??S,{data:I,isLoading:P,refetch:M}=((e={})=>{const{page:s=1,pageSize:a=20,speciesId:n,annotationStatus:l="all",qualityFilter:r="all",sortBy:o="createdAt",sortOrder:c="desc"}=e;return v({queryKey:O.list(e),queryFn:async()=>{try{const e=new URLSearchParams({page:s.toString(),pageSize:a.toString(),annotationStatus:l,qualityFilter:r,sortBy:o,sortOrder:c});return n&&e.append("speciesId",n),(await i.get(`/api/admin/images?${e}`)).data.data}catch(e){return t("Error fetching gallery images:",e instanceof Error?e:new Error(String(e))),{images:[],pagination:{total:0,page:1,pageSize:20,totalPages:0}}}},staleTime:3e4,gcTime:3e5})})(h),E=(()=>{const e=y();return f({mutationFn:async e=>(await i.delete(`/api/admin/images/${e}`)).data,onSuccess:()=>{e.invalidateQueries({queryKey:O.all})},onError:e=>{t("Error deleting image:",e instanceof Error?e:new Error(String(e)))}})})(),D=(()=>{const e=y();return f({mutationFn:async e=>{if(!e||"string"!=typeof e)throw new Error("Invalid image ID provided");if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))throw new Error("Invalid image ID format");return(await i.post(`/api/admin/images/${e}/annotate`)).data},onSuccess:(s,a)=>{e.invalidateQueries({queryKey:O.detail(a)}),e.invalidateQueries({queryKey:O.all})},onError:e=>{t("Error annotating image:",new Error(e?.response?.data?.error||e?.response?.data?.message||e?.message||"Failed to annotate image"))}})})();e.useEffect(()=>{A([])},[h.speciesId,h.annotationStatus,h.qualityFilter,A]);const q=e.useCallback(e=>{g(s=>({...s,...e}))},[]),z=e.useCallback(e=>{p(e)},[]),T=e.useCallback(async e=>{try{const s=await D.mutateAsync(e);n("success",`Generated ${s.annotationCount} annotations`),M()}catch{n("error","Failed to generate annotations")}},[D,n,M]),F=e.useCallback(async e=>{try{await E.mutateAsync(e),n("success","Image deleted successfully"),p(null),b(null),M()}catch{n("error","Failed to delete image")}},[E,n,M]),B=e.useCallback(e=>{g(s=>({...s,page:e}))},[]),$=e.useCallback(e=>{const s=L.includes(e)?L.filter(s=>s!==e):[...L,e];A(s)},[L,A]),Q=e.useCallback(()=>{const e=(I?.images||[]).map(e=>e.id);A(e)},[I?.images,A]),R=e.useCallback(()=>{A([])},[A]),U=e.useCallback(async()=>{if(0!==L.length)try{for(const e of L)await E.mutateAsync(e);n("success",`Deleted ${L.length} image(s) successfully`),A([]),M()}catch{n("error","Failed to delete selected images")}},[L,E,n,A,M]),K=e.useCallback(async()=>{if(0!==L.length)try{let e=0;for(const s of L){await D.mutateAsync(s)&&e++}n("success",`Generated annotations for ${e} image(s)`),A([]),M()}catch{n("error","Failed to generate annotations for selected images")}},[L,D,n,A,M]),H=I?.images||[],Y=I?.pagination||{total:0,page:1,pageSize:20,totalPages:0},Z=H.map(e=>e.id),_=Z.length>0&&Z.every(e=>L.includes(e));return s.jsxs("div",{children:[s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Image Gallery",subtitle:`Browse and manage ${Y.total} bird images (each card represents one image)`}),s.jsxs(d,{children:[s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs(x,{variant:"primary",onClick:()=>w(!0),title:"Upload new images",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Upload Images"]})}),s.jsx(V,{species:a,filters:h,onFilterChange:q}),0===L.length&&H.length>0&&s.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 mb-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600",children:[s.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsxs("span",{children:[s.jsx("strong",{children:"Tip:"})," Check the boxes on images to select them for batch annotation or deletion."]})]}),s.jsx(C,{selectedCount:L.length,onSelectAll:Q,onDeselectAll:R,onDelete:U,onAnnotate:K,isDeleting:E.isPending,isAnnotating:D.isPending,totalCount:Z.length,allSelected:_}),P?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-3 text-gray-600",children:"Loading images..."})]}):0===H.length?s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("p",{className:"text-lg font-medium",children:"No images found"}),s.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your filters or collect some images first."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:H.map(e=>s.jsx(G,{image:e,onView:()=>z(e.id),onAnnotate:()=>T(e.id),onDelete:()=>b(e.id),isDeleting:E.isPending&&j===e.id,isAnnotating:D.isPending,isSelected:L.includes(e.id),onToggleSelect:()=>$(e.id)},e.id))}),s.jsx(J,{page:Y.page,totalPages:Y.totalPages,total:Y.total,pageSize:Y.pageSize,onPageChange:B})]})]})]}),u&&s.jsx(X,{imageId:u,isOpen:!!u,onClose:()=>p(null),onAnnotate:()=>T(u),onDelete:()=>F(u),isAnnotating:D.isPending,isDeleting:E.isPending}),s.jsx(r,{isOpen:!!j,onClose:()=>b(null),title:"Delete Image",size:"sm",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-gray-600",children:"Are you sure you want to delete this image? This will also delete all associated annotations. This action cannot be undone."}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx(x,{variant:"secondary",onClick:()=>b(null),children:"Cancel"}),s.jsx(x,{variant:"danger",onClick:()=>j&&F(j),isLoading:E.isPending,children:"Delete"})]})]})}),s.jsx(W,{isOpen:N,onClose:()=>w(!1),species:a,onSuccess:()=>M(),onToast:n})]})},Z=()=>{const{user:t,loading:i}=n(),{data:r=[],isLoading:b}=l(),{stats:y,quota:v,jobs:f,pendingImages:N,isLoading:C,refetchStats:L,collectMutation:A,annotateMutation:I,bulkDeleteMutation:P,bulkAnnotateMutation:M,undoMutation:E}=w(),{toasts:D,addToast:q,removeToast:z}=g(),[T,F]=e.useState("collection"),[B,O]=e.useState([]),[R,U]=e.useState(2),[K,W]=e.useState([]),[H,V]=e.useState(!0),[G,J]=e.useState(!1),[X,Z]=e.useState([]),[_,ee]=e.useState(null);if(i)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading..."})]})});if(!t)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access image management."}),s.jsx(a,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});const se=b||C;return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Image Management"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Collect bird images and manage AI annotations"})]}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(a,{to:"/admin/annotations",className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"View Annotations"})})]}),s.jsx("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[{key:"collection",label:"Image Collection"},{key:"gallery",label:"Gallery"},{key:"annotation",label:"Batch Annotation"},{key:"statistics",label:"Statistics"},{key:"history",label:"Job History"}].map(e=>s.jsxs("button",{onClick:()=>F(e.key),className:"relative px-4 py-2 font-medium border-b-2 transition-colors "+(T===e.key?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[e.label,"annotation"===e.key&&X.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-600 rounded-full",children:X.length})]},e.key))})]})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[se&&s.jsx($,{activeTab:T}),!se&&s.jsxs(s.Fragment,{children:["collection"===T&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Collect Images",subtitle:"Select species and configure collection parameters"}),s.jsx(d,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bird Species"}),s.jsx(k,{species:r,selected:B,onChange:O,disabled:A.isPending})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images per Species"}),s.jsx("input",{type:"number",min:1,max:10,value:R,onChange:e=>U(parseInt(e.target.value)||2),disabled:A.isPending,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:bg-gray-100"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Recommended: 2-5 images per species"})]}),v&&v.unsplash.remaining<10&&s.jsxs(h,{variant:"warning",title:"Low API Quota",children:["Only ",v.unsplash.remaining," Unsplash requests remaining.",v.unsplash.resetTime&&s.jsxs("span",{children:[" Resets at ",new Date(v.unsplash.resetTime).toLocaleTimeString()]})]})]})}),s.jsx(m,{children:s.jsxs(x,{variant:"primary",onClick:async()=>{if(0!==B.length)try{await A.mutateAsync({speciesIds:B,imagesPerSpecies:R}),q("success",`Started collecting images for ${B.length} species`),O([])}catch{q("error","Failed to start image collection")}else q("error","Please select at least one species")},isLoading:A.isPending,disabled:0===B.length||A.isPending,children:["Collect Images (",B.length," species)"]})})]}),s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Active Jobs",subtitle:"Currently running collection and annotation jobs"}),s.jsx(d,{children:0===f.filter(e=>"running"===e.status||"pending"===e.status).length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{children:"No active jobs"})]}):s.jsx("div",{className:"space-y-4",children:f.filter(e=>"running"===e.status||"pending"===e.status).map(e=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-medium capitalize",children:e.type}),s.jsx(p,{variant:"running"===e.status?"primary":"warning",dot:!0,children:e.status})]}),s.jsx(j,{value:e.progress,max:e.total,variant:"gradient",color:"primary",showLabel:!0,animated:"running"===e.status}),s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[e.progress," / ",e.total," completed"]})]},e.id))})})]})]}),"gallery"===T&&s.jsx(Y,{species:r,onToast:q,selectedImages:X,onSelectionChange:Z}),"annotation"===T&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Batch Annotation",subtitle:"Generate AI annotations for multiple images"}),s.jsx(d,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"How Batch Annotation Works:"}),s.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-blue-700",children:[s.jsxs("li",{children:["Go to the ",s.jsx("strong",{children:"Gallery"})," tab"]}),s.jsx("li",{children:"Select images using the checkboxes"}),s.jsx("li",{children:'Click "Annotate Selected" in the toolbar'}),s.jsx("li",{children:"Monitor progress in real-time below"})]}),s.jsx("p",{className:"mt-2 text-blue-700",children:"Or use the quick options below to annotate all pending images at once."})]})]})}),X.length>0&&s.jsxs("div",{className:"border-2 border-blue-300 bg-blue-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsxs("span",{className:"font-medium text-blue-900",children:[X.length," image",1!==X.length?"s":""," selected from Gallery"]})]}),s.jsx(x,{variant:"secondary",size:"sm",onClick:()=>Z([]),children:"Clear"})]}),s.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Ready to annotate your selected images with AI-generated vocabulary terms."}),s.jsxs(x,{variant:"primary",onClick:async()=>{try{const e=await M.mutateAsync(X);q("success",e.message),Z([])}catch{q("error","Failed to start bulk annotation")}},isLoading:M.isPending,disabled:M.isPending,className:"w-full",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Annotate ",X.length," Selected Image",1!==X.length?"s":""]})]}),0===X.length&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border rounded-lg p-4",children:s.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[s.jsx("input",{type:"radio",checked:H,onChange:()=>V(!0),disabled:I.isPending,className:"w-4 h-4 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Annotate all un-annotated images"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Process all ",y?.pendingAnnotation||0," images without annotations"]})]})]})}),s.jsx("div",{className:"border rounded-lg p-4",children:s.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[s.jsx("input",{type:"radio",checked:!H,onChange:()=>V(!1),disabled:I.isPending,className:"w-4 h-4 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Select specific pending images"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Choose individual images from the list below"})]})]})}),!H&&s.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto bg-gray-50",children:0===N.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{className:"font-medium",children:"All images are annotated!"}),s.jsx("p",{className:"text-sm mt-1",children:"No pending images to process"})]}):s.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.map(e=>s.jsxs("label",{className:"relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all "+(K.includes(e.id)?"border-blue-500 ring-2 ring-blue-200":"border-transparent hover:border-gray-300"),children:[s.jsx("input",{type:"checkbox",checked:K.includes(e.id),onChange:s=>{s.target.checked?W([...K,e.id]):W(K.filter(s=>s!==e.id))},className:"sr-only"}),s.jsx("img",{src:e.url,alt:"Bird",className:"w-full h-20 object-cover"}),K.includes(e.id)&&s.jsx("div",{className:"absolute top-1 right-1 bg-blue-600 rounded-full p-0.5",children:s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.id))})})]}),v&&v.anthropic.remaining<100&&s.jsxs(h,{variant:"warning",title:"Low API Quota",children:["Only ",v.anthropic.remaining," Anthropic requests remaining.",v.anthropic.resetTime&&s.jsxs("span",{children:[" Resets at ",new Date(v.anthropic.resetTime).toLocaleTimeString()]})]})]})}),s.jsx(m,{children:0===X.length&&s.jsxs(x,{variant:"primary",onClick:async()=>{try{if(H)await I.mutateAsync({all:!0}),q("success","Started annotation for all pending images");else{if(0===K.length)return void q("error","Please select at least one image");await I.mutateAsync({imageIds:K}),q("success",`Started annotation for ${K.length} images`),W([])}}catch{q("error","Failed to start annotation")}},isLoading:I.isPending,disabled:I.isPending||!H&&0===K.length||H&&0===(y?.pendingAnnotation||0),children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Start Annotation"]})})]}),s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Annotation Progress",subtitle:"Real-time annotation status"}),s.jsx(d,{children:0===f.filter(e=>"annotation"===e.type&&("running"===e.status||"pending"===e.status)).length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),s.jsx("p",{children:"No annotation jobs running"}),s.jsx("p",{className:"text-sm mt-1",children:"Start an annotation job to see progress here"})]}):s.jsx("div",{className:"space-y-4",children:f.filter(e=>"annotation"===e.type&&("running"===e.status||"pending"===e.status)).map(e=>s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(p,{variant:"running"===e.status?"success":"warning",dot:!0,children:"running"===e.status?"Processing":"Queued"}),s.jsxs("span",{className:"text-sm text-gray-500",children:["Started ",new Date(e.startedAt).toLocaleTimeString()]})]}),s.jsx(j,{value:e.progress,max:e.total,variant:"striped",color:"success",size:"lg",showLabel:!0,label:"Annotation Progress",animated:!0}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[s.jsxs("div",{className:"bg-green-50 rounded-lg p-2",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:e.results?.annotated||0}),s.jsx("div",{className:"text-xs text-green-700",children:"Annotated"})]}),s.jsxs("div",{className:"bg-yellow-50 rounded-lg p-2",children:[s.jsx("div",{className:"text-lg font-bold text-yellow-600",children:e.total-e.progress}),s.jsx("div",{className:"text-xs text-yellow-700",children:"Remaining"})]}),s.jsxs("div",{className:"bg-red-50 rounded-lg p-2",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:e.results?.failed||0}),s.jsx("div",{className:"text-xs text-red-700",children:"Failed"})]})]})]},e.id))})})]})]}),"statistics"===T&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(o,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-blue-600",children:y?.totalImages||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Total Images"})]})}),s.jsx(o,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:y?.pendingAnnotation||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Pending Annotation"})]})}),s.jsx(o,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-green-600",children:y?.annotated||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Annotated"})]})}),s.jsx(o,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-red-600",children:y?.failed||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Failed"})]})})]}),s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"API Quota Status",subtitle:"Current usage and limits"}),s.jsx(d,{children:s.jsx("div",{className:"grid grid-cols-1 gap-6",children:s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Unsplash API"}),s.jsx(j,{value:v?.unsplash.remaining||0,max:v?.unsplash.limit||50,variant:"gradient",color:(v?.unsplash.remaining||0)<10?"danger":(v?.unsplash.remaining||0)<25?"warning":"success",showLabel:!0,label:"Requests Remaining"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[v?.unsplash.remaining||0," / ",v?.unsplash.limit||50," requests",v?.unsplash.resetTime&&s.jsxs("span",{className:"ml-2",children:["(Resets: ",new Date(v.unsplash.resetTime).toLocaleString(),")"]})]})]})})})]}),s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Images by Species",subtitle:"Distribution of collected images - click to filter gallery"}),s.jsx(d,{children:y?.bySpecies&&Object.keys(y.bySpecies).length>0?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Object.entries(y.bySpecies).sort(([,e],[,s])=>{const a="number"==typeof e?e:e.count;return("number"==typeof s?s:s.count)-a}).slice(0,12).map(([e,a])=>{const t="number"==typeof a?a:a.count,n="object"==typeof a&&a.sampleImageUrl?a.sampleImageUrl:null;return s.jsxs("button",{onClick:()=>{F("gallery")},className:"bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all border-2 border-gray-200 hover:border-blue-400 text-left group",title:`View ${t} ${e} image${1!==t?"s":""}`,children:[n?s.jsxs("div",{className:"relative aspect-[4/3] bg-gray-100",children:[s.jsx("img",{src:n,alt:e,className:"w-full h-full object-cover",loading:"lazy"}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center",children:s.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium text-sm bg-blue-600 px-3 py-1 rounded-full transition-opacity",children:"View All"})})]}):s.jsx("div",{className:"aspect-[4/3] bg-gray-100 flex items-center justify-center",children:s.jsx("svg",{className:"w-12 h-12 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),s.jsxs("div",{className:"p-3",children:[s.jsx("div",{className:"text-xl font-bold text-gray-800 mb-1",children:t}),s.jsx("div",{className:"text-sm text-gray-600 truncate",title:e,children:e})]})]},e)})}):s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No images collected yet"})})]})]}),"history"===T&&s.jsxs(o,{variant:"elevated",padding:"lg",children:[s.jsx(c,{title:"Job History",subtitle:"Recent collection and annotation jobs"}),s.jsx(d,{children:0===f.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),s.jsx("p",{children:"No jobs yet"}),s.jsx("p",{className:"text-sm mt-1",children:"Start collecting or annotating images to see job history"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Type"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Status"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Progress"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Started"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Completed"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Results"})]})}),s.jsx("tbody",{children:f.map(e=>s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"py-3 px-4",children:s.jsx(p,{variant:"collection"===e.type?"primary":"info",size:"sm",children:e.type})}),s.jsx("td",{className:"py-3 px-4",children:s.jsx(p,{variant:"completed"===e.status?"success":"failed"===e.status?"danger":"running"===e.status?"primary":"warning",dot:!0,size:"sm",children:e.status})}),s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{value:e.progress,max:e.total,size:"sm",color:"failed"===e.status?"danger":"primary",className:"w-24"}),s.jsxs("span",{className:"text-sm text-gray-600",children:[e.progress,"/",e.total]})]})}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(e.startedAt).toLocaleString()}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:e.completedAt?new Date(e.completedAt).toLocaleString():"-"}),s.jsx("td",{className:"py-3 px-4",children:e.results?s.jsxs("div",{className:"text-sm",children:["collection"===e.type&&s.jsxs("span",{className:"text-green-600",children:[e.results.collected," collected"]}),"annotation"===e.type&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"text-green-600",children:[e.results.annotated," annotated"]}),e.results.failed&&e.results.failed>0&&s.jsxs("span",{className:"text-red-600 ml-2",children:[e.results.failed," failed"]})]})]}):e.error?s.jsx("span",{className:"text-sm text-red-600",title:e.error,children:"Error"}):"-"})]},e.id))})]})})})]})]})]}),s.jsx(u,{toasts:D,onRemove:z}),s.jsx(S,{isOpen:G,onClose:()=>J(!1),onConfirm:async()=>{try{const e=await P.mutateAsync(X);ee(e),J(!1)}catch{q("error","Failed to queue delete operation")}},count:X.length,isDeleting:P.isPending}),_&&s.jsx(Q,{operationId:_.operationId,message:_.message,itemCount:_.imageCount,expiresAt:_.expiresAt,onUndo:async e=>{try{await E.mutateAsync(e),q("success","Delete operation cancelled"),ee(null),Z([])}catch{q("error","Failed to undo operation")}},onExpire:()=>{_&&(q("success",`${_.imageCount} image${1!==_.imageCount?"s":""} deleted`),ee(null),Z([]),L())},onDismiss:()=>ee(null)})]})};export{Z as ImageManagementPage,Z as default};
