import{r as e,j as s,L as a}from"./react-vendor-BjSJ0Zw_.js";import{u as t}from"./useSupabaseAuth-DZBIfm12.js";import{u as n}from"./useSpecies-DfZeKMF_.js";import{a as i,B as l,C as r,b as o,c,T as d,d as m}from"./Tooltip-BDDCW5yJ.js";import{B as x,A as g,u as h,T as u}from"./ToastContainer-kmbyk56n.js";import{M as p}from"./Modal-Dn8BwoZG.js";import{L as j}from"./LazyImage-Bs-JPsN2.js";import{a as b,u as y,b as v}from"./data-vendor-Co-Mk0hz.js";import{e as f}from"./index-BRFl2-OY.js";import"./vendor-B4WW6Bjp.js";import"./apiAdapter-Ds9msyIR.js";const N={all:["image-management"],dashboard:()=>[...N.all,"dashboard"],stats:()=>[...N.all,"stats"],quota:()=>[...N.all,"quota"],jobs:()=>[...N.all,"jobs"],pendingImages:()=>[...N.all,"pending-images"],gallery:(e,s,a)=>[...N.all,"gallery",{page:e,status:s,speciesId:a}]},w=()=>{const e=b(),{data:s,isLoading:a,refetch:t}=y({queryKey:N.dashboard(),queryFn:async()=>{try{return(await i.get("/api/admin/dashboard")).data.data}catch(e){return f("Error fetching dashboard:",e instanceof Error?e:new Error(String(e))),{stats:{totalImages:0,pendingAnnotation:0,annotated:0,failed:0,bySpecies:{}},quota:{unsplash:{remaining:50,limit:50,resetTime:null},anthropic:{remaining:1e3,limit:1e3,resetTime:null}},jobs:[],hasActiveJobs:!1}}},staleTime:3e4,gcTime:3e5}),n=s?.hasActiveJobs||!1,{data:l}=((e=!1)=>y({queryKey:N.jobs(),queryFn:async()=>{try{return(await i.get("/api/admin/images/jobs")).data.jobs}catch(e){return f("Error fetching jobs:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:1e4,gcTime:3e5,refetchInterval:!!e&&3e3}))(n),r=n&&l?l:s?.jobs||[],{data:o=[]}=y({queryKey:N.pendingImages(),queryFn:async()=>{try{return(await i.get("/api/admin/images/pending")).data.data}catch(e){return f("Error fetching pending images:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:3e4,gcTime:3e5}),c=(()=>{const e=b();return v({mutationFn:async e=>(await i.post("/api/admin/images/collect",e)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:N.dashboard()}),e.invalidateQueries({queryKey:N.jobs()}),e.invalidateQueries({queryKey:N.stats()}),e.invalidateQueries({queryKey:N.quota()})},onError:e=>{f("Error starting image collection:",e instanceof Error?e:new Error(String(e)))}})})(),d=(()=>{const e=b();return v({mutationFn:async e=>(await i.post("/api/admin/images/annotate",e)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:N.dashboard()}),e.invalidateQueries({queryKey:N.jobs()}),e.invalidateQueries({queryKey:N.stats()}),e.invalidateQueries({queryKey:N.quota()}),e.invalidateQueries({queryKey:N.pendingImages()})},onError:e=>{f("Error starting annotation:",e instanceof Error?e:new Error(String(e)))}})})(),m=(()=>{const e=b();return v({mutationFn:async e=>(await i.post("/api/admin/images/bulk/delete",{imageIds:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:N.all})},onError:e=>{f("Error deleting images:",e instanceof Error?e:new Error(String(e)))}})})(),x=(()=>{const e=b();return v({mutationFn:async e=>(await i.post("/api/admin/images/bulk/annotate",{imageIds:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:N.dashboard()}),e.invalidateQueries({queryKey:N.jobs()}),e.invalidateQueries({queryKey:N.stats()})},onError:e=>{f("Error starting bulk annotation:",e instanceof Error?e:new Error(String(e)))}})})();return{stats:s?.stats,quota:s?.quota,jobs:r,pendingImages:o,isLoading:a,hasActiveJobs:n,refetchStats:()=>(e.invalidateQueries({queryKey:N.dashboard()}),t()),collectMutation:c,annotateMutation:d,bulkDeleteMutation:m,bulkAnnotateMutation:x}},k=({species:a,selected:t,onChange:n,disabled:i=!1})=>{const[r,o]=e.useState(""),[c,d]=e.useState(!1),m=a.filter(e=>e.englishName?.toLowerCase().includes(r.toLowerCase())||e.spanishName?.toLowerCase().includes(r.toLowerCase())||e.scientificName?.toLowerCase().includes(r.toLowerCase()));return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"border rounded-lg p-3 cursor-pointer "+(i?"bg-gray-100 cursor-not-allowed":"bg-white hover:border-blue-500"),onClick:()=>!i&&d(!c),children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-700",children:0===t.length?"Select species...":`${t.length} species selected`}),s.jsx("svg",{className:"w-5 h-5 text-gray-400 transition-transform "+(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),t.length>0&&s.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.slice(0,5).map(e=>{const t=a.find(s=>s.id===e);return s.jsx(l,{variant:"primary",size:"sm",children:t?.englishName||e},e)}),t.length>5&&s.jsxs(l,{variant:"default",size:"sm",children:["+",t.length-5," more"]})]})]}),c&&!i&&s.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-80 overflow-hidden",children:[s.jsx("div",{className:"p-2 border-b",children:s.jsx("input",{type:"text",placeholder:"Search species...",className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:r,onChange:e=>o(e.target.value),onClick:e=>e.stopPropagation()})}),s.jsxs("div",{className:"p-2 border-b flex gap-2",children:[s.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-800",onClick:e=>{e.stopPropagation(),n(m.map(e=>e.id))},children:"Select All"}),s.jsx("span",{className:"text-gray-300",children:"|"}),s.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:e=>{e.stopPropagation(),n([])},children:"Clear All"})]}),s.jsxs("div",{className:"max-h-52 overflow-y-auto",children:[m.map(e=>s.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",onClick:e=>e.stopPropagation(),children:[s.jsx("input",{type:"checkbox",checked:t.includes(e.id),onChange:()=>{return s=e.id,void(t.includes(s)?n(t.filter(e=>e!==s)):n([...t,s]));var s},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),s.jsxs("span",{className:"ml-3",children:[s.jsx("span",{className:"font-medium",children:e.englishName}),s.jsx("span",{className:"text-gray-500 text-sm ml-2",children:e.scientificName})]})]},e.id)),0===m.length&&s.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"No species found"})]})]})]})},C=({selectedCount:e,onSelectAll:a,onDeselectAll:t,onDelete:n,onAnnotate:i,isDeleting:l,isAnnotating:r,totalCount:o,allSelected:c})=>0===e?null:s.jsx("div",{className:"sticky top-[140px] z-20 bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 shadow-sm",children:s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"font-medium text-blue-900",children:[e," image",1!==e?"s":""," selected"]}),s.jsxs("div",{className:"flex gap-2",children:[!c&&o>0&&s.jsxs("button",{type:"button",onClick:a,className:"text-sm text-blue-600 hover:text-blue-800 underline",children:["Select all ",o]}),s.jsx("button",{type:"button",onClick:t,className:"text-sm text-gray-600 hover:text-gray-800 underline",children:"Deselect all"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(x,{variant:"secondary",size:"sm",onClick:i,isLoading:r,disabled:r||l,children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Annotate Selected"]}),s.jsxs(x,{variant:"danger",size:"sm",onClick:n,isLoading:l,disabled:r||l,children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Selected"]})]})]})}),S=({isOpen:e,onClose:a,onConfirm:t,count:n,isDeleting:i})=>e?s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),s.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:s.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delete ",n," image",1!==n?"s":"","?"]}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"This action cannot be undone. All selected images and their associated annotations will be permanently deleted."})]})]}),s.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[s.jsx(x,{variant:"secondary",onClick:a,disabled:i,children:"Cancel"}),s.jsx(x,{variant:"danger",onClick:t,isLoading:i,disabled:i,children:"Delete"})]})]})]}):null,L=({className:e=""})=>s.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${e}`}),A=()=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 text-center",children:[s.jsx(L,{className:"h-8 w-16 mx-auto mb-2"}),s.jsx(L,{className:"h-4 w-24 mx-auto"})]}),P=()=>s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(A,{}),s.jsx(A,{}),s.jsx(A,{}),s.jsx(A,{})]}),I=()=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-10 w-full"})]}),q=()=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(L,{className:"h-5 w-24"}),s.jsx(L,{className:"h-5 w-16 rounded-full"})]}),s.jsx(L,{className:"h-2 w-full rounded-full mb-2"}),s.jsx(L,{className:"h-4 w-32"})]}),T=()=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/3 mb-2"}),s.jsx(L,{className:"h-4 w-2/3 mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(q,{}),s.jsx(q,{})]})]}),D=({count:e=8})=>s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:e}).map((e,a)=>s.jsx("div",{className:"aspect-square",children:s.jsx(L,{className:"h-full w-full rounded-lg"})},a))}),z=()=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(L,{className:"h-4 w-24"}),s.jsx(L,{className:"h-3 w-full rounded-full"}),s.jsx(L,{className:"h-3 w-32"})]}),E=()=>s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/3 mb-2"}),s.jsx(L,{className:"h-4 w-2/3 mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(I,{}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(L,{className:"h-4 w-40"}),s.jsx(L,{className:"h-10 w-full"}),s.jsx(L,{className:"h-3 w-48"})]})]}),s.jsx("div",{className:"mt-6 pt-4 border-t",children:s.jsx(L,{className:"h-10 w-40"})})]}),s.jsx(T,{})]}),M=()=>s.jsxs("div",{className:"space-y-6",children:[s.jsx(P,{}),s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/4 mb-2"}),s.jsx(L,{className:"h-4 w-1/3 mb-6"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(z,{}),s.jsx(z,{})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/3 mb-2"}),s.jsx(L,{className:"h-4 w-1/2 mb-6"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:8}).map((e,a)=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[s.jsx(L,{className:"h-6 w-8 mx-auto mb-1"}),s.jsx(L,{className:"h-3 w-20 mx-auto"})]},a))})]})]}),F=()=>s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(L,{className:"h-10 w-48"}),s.jsx(L,{className:"h-10 w-32"})]}),s.jsx(D,{count:12}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx(L,{className:"h-10 w-24"}),s.jsx(L,{className:"h-10 w-10"}),s.jsx(L,{className:"h-10 w-10"}),s.jsx(L,{className:"h-10 w-10"}),s.jsx(L,{className:"h-10 w-24"})]})]}),B=()=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsx(L,{className:"h-6 w-1/4 mb-2"}),s.jsx(L,{className:"h-4 w-1/3 mb-6"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-4 pb-3 border-b",children:[s.jsx(L,{className:"h-4 w-16"}),s.jsx(L,{className:"h-4 w-16"}),s.jsx(L,{className:"h-4 w-24"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-20"})]}),Array.from({length:5}).map((e,a)=>s.jsxs("div",{className:"flex gap-4 py-3 border-b border-gray-100",children:[s.jsx(L,{className:"h-5 w-16 rounded-full"}),s.jsx(L,{className:"h-5 w-16 rounded-full"}),s.jsx(L,{className:"h-3 w-24 rounded-full"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-32"}),s.jsx(L,{className:"h-4 w-20"})]},a))]})]}),$=({activeTab:e})=>{switch(e){case"collection":case"annotation":default:return s.jsx(E,{});case"gallery":return s.jsx(F,{});case"statistics":return s.jsx(M,{});case"history":return s.jsx(B,{})}},O=({value:e,max:a=100,size:t="md",variant:n="default",color:i="primary",showLabel:l=!1,label:r,animated:o=!1,className:c=""})=>{const d=Math.min(Math.max(e/a*100,0),100),m={primary:"bg-blue-600",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-600"},x={primary:"bg-gradient-to-r from-blue-400 to-blue-600",success:"bg-gradient-to-r from-green-400 to-green-600",warning:"bg-gradient-to-r from-yellow-400 to-yellow-600",danger:"bg-gradient-to-r from-red-400 to-red-600"};return s.jsxs("div",{className:c,children:[(l||r)&&s.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[s.jsx("span",{children:r||"Progress"}),s.jsxs("span",{children:[Math.round(d),"%"]})]}),s.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${{sm:"h-1",md:"h-3",lg:"h-4"}[t]}`,children:s.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${"gradient"===n?x[i]:"striped"===n?`${m[i]} bg-[length:1rem_1rem] bg-[linear-gradient(45deg,rgba(255,255,255,.15)_25%,transparent_25%,transparent_50%,rgba(255,255,255,.15)_50%,rgba(255,255,255,.15)_75%,transparent_75%,transparent)]`:m[i]} ${o?"animate-pulse":""}`,style:{width:`${d}%`},role:"progressbar","aria-valuenow":e,"aria-valuemin":0,"aria-valuemax":a})})]})},Q={all:["gallery"],list:e=>[...Q.all,"list",e],detail:e=>[...Q.all,"detail",e]},R=({onFilesSelected:a,disabled:t})=>{const[n,i]=e.useState(!1),l=e.useRef(null),r=e.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),o=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.items&&e.dataTransfer.items.length>0&&i(!0)},[]),c=e.useCallback(e=>{e.preventDefault(),e.stopPropagation(),i(!1)},[]),d=e.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),i(!1),t)return;const s=Array.from(e.dataTransfer.files).filter(e=>["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type));s.length>0&&a(s)},[a,t]),m=e.useCallback(e=>{if(e.target.files&&e.target.files.length>0){const s=Array.from(e.target.files);a(s)}},[a]);return s.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer\n        transition-all duration-200\n        ${n?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}\n        ${t?"opacity-50 cursor-not-allowed":""}\n      `,onDragEnter:o,onDragLeave:c,onDragOver:r,onDrop:d,onClick:()=>{t||l.current?.click()},children:[s.jsx("input",{ref:l,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:m,className:"hidden",disabled:t}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto "+(n?"text-blue-500":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-medium text-gray-700",children:n?"Drop images here":"Drag & drop images here"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"or click to browse files"})]}),s.jsx("p",{className:"text-xs text-gray-400",children:"Supports: JPEG, PNG, WebP (max 10MB each, up to 20 files)"})]})]})},K=({files:e,onRemove:a,disabled:t})=>0===e.length?null:s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Selected Files (",e.length,")"]})}),s.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-1",children:e.map(e=>s.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-200",children:[s.jsx("img",{src:e.preview,alt:e.file.name,className:"w-full h-full object-cover"}),!t&&s.jsx("button",{type:"button",onClick:()=>a(e.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 px-1 py-0.5",children:s.jsx("p",{className:"text-xs text-white truncate",children:e.file.name})})]},e.id))})]}),U=({species:e,value:a,onChange:t,disabled:n})=>s.jsxs("div",{className:"mt-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Species ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{value:a,onChange:e=>t(e.target.value),disabled:n,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[s.jsx("option",{value:"",children:"Select a species..."}),e.map(e=>s.jsxs("option",{value:e.id,children:[e.englishName," (",e.scientificName,")"]},e.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All uploaded images will be associated with this species"})]}),W=({isOpen:a,onClose:t,species:n,onSuccess:l,onToast:r})=>{const[o,c]=e.useState([]),[d,m]=e.useState(""),[h,u]=e.useState(0),[j,y]=e.useState(null),N=(()=>{const e=b();return v({mutationFn:async({files:e,speciesId:s,onProgress:a})=>{const t=new FormData;return t.append("speciesId",s),e.forEach(e=>{t.append("files",e)}),(await i.post("/api/admin/images/upload",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total&&a){const s=Math.round(e.loaded/e.total*100);a(s)}}})).data},onSuccess:()=>{e.invalidateQueries({queryKey:["image-management"]}),e.invalidateQueries({queryKey:["gallery"]})},onError:e=>{f("Error uploading images:",e instanceof Error?e:new Error(String(e)))}})})(),w=e.useCallback(e=>{const s=e.map(e=>({file:e,preview:URL.createObjectURL(e),id:`${e.name}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}));c(e=>[...e,...s].slice(0,20)),y(null)},[]),k=e.useCallback(e=>{c(s=>{const a=s.find(s=>s.id===e);return a&&URL.revokeObjectURL(a.preview),s.filter(s=>s.id!==e)})},[]),C=()=>{o.forEach(e=>URL.revokeObjectURL(e.preview)),c([]),m(""),u(0),y(null),t()},S=N.isPending,L=o.length>0&&d&&!S;return s.jsx(p,{isOpen:a,onClose:C,title:"Upload Images",size:"lg",closeOnOverlayClick:!S,closeOnEscape:!S,children:s.jsxs("div",{className:"space-y-4",children:[j&&s.jsx(g,{variant:"danger",onClose:()=>y(null),children:j}),s.jsx(R,{onFilesSelected:w,disabled:S}),s.jsx(K,{files:o,onRemove:k,disabled:S}),s.jsx(U,{species:n,value:d,onChange:m,disabled:S}),S&&s.jsx("div",{className:"mt-4",children:s.jsx(O,{value:h,max:100,variant:"gradient",color:"primary",showLabel:!0,label:"Uploading...",animated:!0})}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[s.jsx(x,{variant:"secondary",onClick:C,disabled:S,children:"Cancel"}),s.jsxs(x,{variant:"primary",onClick:async()=>{if(0!==o.length)if(d){y(null),u(0);try{const e=await N.mutateAsync({files:o.map(e=>e.file),speciesId:d,onProgress:u});e.summary.successful>0&&(r("success",`Successfully uploaded ${e.summary.successful} image${1!==e.summary.successful?"s":""}`),l(),C()),e.failed&&e.failed.length>0&&r("error",`${e.failed.length} file${1!==e.failed.length?"s":""} failed to upload`)}catch{y("Upload failed. Please try again.")}}else y("Please select a species");else y("Please select at least one image")},disabled:!L,isLoading:S,children:["Upload ",o.length>0?`(${o.length})`:""]})]})]})})},H=e=>null==e?{variant:"info",label:"N/A"}:e>=80?{variant:"success",label:`${e}%`}:e>=60?{variant:"warning",label:`${e}%`}:{variant:"danger",label:`${e}%`},V=({species:e,filters:a,onFilterChange:t})=>s.jsxs("div",{className:"flex flex-wrap gap-4 p-4 bg-gray-50 rounded-lg mb-6",children:[s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx(d,{content:"Filter images by specific bird species",position:"top",children:s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 cursor-help border-b border-dotted border-gray-400 inline-block",children:"Species"})}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.speciesId||"",onChange:e=>t({speciesId:e.target.value||void 0,page:1}),children:[s.jsx("option",{value:"",children:"All Species"}),e.map(e=>s.jsx("option",{value:e.id,children:e.englishName},e.id))]})]}),s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx(d,{content:"Filter by whether images have been annotated with vocabulary terms",position:"top",children:s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 cursor-help border-b border-dotted border-gray-400 inline-block",children:"Annotation Status"})}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.annotationStatus||"all",onChange:e=>t({annotationStatus:e.target.value,page:1}),children:[s.jsx("option",{value:"all",children:"All Images"}),s.jsx("option",{value:"annotated",children:"Annotated"}),s.jsx("option",{value:"unannotated",children:"Unannotated"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx(d,{content:"Filter by image quality score: High (80-100), Medium (60-79), Low (0-59)",position:"top",children:s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 cursor-help border-b border-dotted border-gray-400 inline-block",children:"Quality"})}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.qualityFilter||"all",onChange:e=>t({qualityFilter:e.target.value,page:1}),children:[s.jsx("option",{value:"all",children:"All Quality"}),s.jsx("option",{value:"high",children:"High (80-100)"}),s.jsx("option",{value:"medium",children:"Medium (60-79)"}),s.jsx("option",{value:"low",children:"Low (0-59)"}),s.jsx("option",{value:"unscored",children:"Unscored"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[200px]",children:[s.jsx(d,{content:"Choose how to order images in the gallery",position:"top",children:s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 cursor-help border-b border-dotted border-gray-400 inline-block",children:"Sort By"})}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.sortBy||"createdAt",onChange:e=>t({sortBy:e.target.value}),children:[s.jsx("option",{value:"createdAt",children:"Date Added"}),s.jsx("option",{value:"speciesName",children:"Species Name"}),s.jsx("option",{value:"annotationCount",children:"Annotation Count"}),s.jsx("option",{value:"qualityScore",children:"Quality Score"})]})]}),s.jsxs("div",{className:"flex-1 min-w-[150px]",children:[s.jsx(d,{content:"Display newest or oldest items first",position:"top",children:s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 cursor-help border-b border-dotted border-gray-400 inline-block",children:"Order"})}),s.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.sortOrder||"desc",onChange:e=>t({sortOrder:e.target.value}),children:[s.jsx("option",{value:"desc",children:"Newest First"}),s.jsx("option",{value:"asc",children:"Oldest First"})]})]})]}),G=({image:e,onView:a,onAnnotate:t,onDelete:n,isDeleting:i,isAnnotating:r,isSelected:o,onToggleSelect:c})=>s.jsxs("div",{className:"relative group bg-white rounded-lg shadow-sm border-2 overflow-hidden hover:shadow-md transition-all "+(o?"border-blue-500 ring-2 ring-blue-200":"border-gray-200"),children:[s.jsx("div",{className:"absolute top-2 left-2 z-10",children:s.jsx("label",{className:"flex items-center cursor-pointer",children:s.jsx("input",{type:"checkbox",checked:o,onChange:e=>{e.stopPropagation(),c()},className:"w-5 h-5 rounded border-2 border-gray-400 text-blue-600 focus:ring-2 focus:ring-blue-500 cursor-pointer bg-white/90 shadow-md hover:border-blue-500 transition-colors",title:o?"Click to deselect":"Click to select for batch actions","aria-label":o?"Deselect this image":"Select this image for batch actions"})})}),s.jsxs("div",{className:"relative aspect-[4/3] cursor-pointer",onClick:a,children:[s.jsx(j,{src:e.url,alt:e.speciesName,className:"w-full h-full object-cover"}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center",children:s.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium transition-opacity",children:"Click to view"})}),s.jsx("div",{className:"absolute bottom-2 left-2",children:(()=>{const a=H(e.qualityScore);return s.jsx(d,{content:"Image quality score: "+(null!==e.qualityScore?`${e.qualityScore}% (${e.qualityScore>=80?"High - excellent for training":e.qualityScore>=60?"Medium - acceptable quality":"Low - may need better image"})`:"Not yet scored"),position:"right",children:s.jsx("div",{className:"cursor-help",children:s.jsx(l,{variant:a.variant,size:"sm",title:"Quality Score",children:a.label})})})})()}),s.jsx("div",{className:"absolute bottom-2 right-2",children:s.jsx(d,{content:`${e.annotationCount} vocabulary annotations${0===e.annotationCount?" - click Annotate to generate":" - click View to see details"}`,position:"left",children:s.jsx("div",{className:"cursor-help",children:s.jsxs(l,{variant:e.annotationCount>0?"success":"warning",size:"sm",children:[e.annotationCount," annotations"]})})})})]}),s.jsxs("div",{className:"p-3",children:[s.jsx("h3",{className:"font-medium text-gray-900 truncate",title:e.speciesName,children:e.speciesName}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()}),s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsx(d,{content:"View full image details and annotations",position:"top",children:s.jsx("div",{className:"flex-1",children:s.jsx(x,{variant:"secondary",size:"sm",onClick:a,className:"w-full",children:"View"})})}),0===e.annotationCount&&s.jsx(d,{content:"Generate AI-powered vocabulary annotations for this image",position:"top",children:s.jsx("div",{className:"flex-1",children:s.jsx(x,{variant:"primary",size:"sm",onClick:t,isLoading:r,disabled:r,className:"w-full",children:"Annotate"})})}),s.jsx(d,{content:"Permanently delete this image and all associated annotations",position:"top",children:s.jsx("div",{children:s.jsx(x,{variant:"danger",size:"sm",onClick:n,isLoading:i,disabled:i,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})})]})]})]}),J=({page:e,totalPages:a,total:t,pageSize:n,onPageChange:i})=>{const l=(e-1)*n+1,r=Math.min(e*n,t);return s.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",l," to ",r," of ",t," images"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(x,{variant:"secondary",size:"sm",disabled:e<=1,onClick:()=>i(e-1),children:"Previous"}),s.jsxs("span",{className:"px-4 py-2 text-sm text-gray-600",children:["Page ",e," of ",a]}),s.jsx(x,{variant:"secondary",size:"sm",disabled:e>=a,onClick:()=>i(e+1),children:"Next"})]})]})},_=({imageId:a,isOpen:t,onClose:n,onAnnotate:r,onDelete:o,isAnnotating:c,isDeleting:d})=>{const{data:m,isLoading:h}=(e=>y({queryKey:Q.detail(e||""),queryFn:async()=>{if(!e)return null;try{return(await i.get(`/api/admin/images/${e}`)).data.data}catch(s){return f("Error fetching image details:",s instanceof Error?s:new Error(String(s))),null}},enabled:!!e,staleTime:6e4,gcTime:3e5}))(t?a:null),[u,j]=e.useState(!0);return t?s.jsx(p,{isOpen:t,onClose:n,title:"Image Details",size:"xl",children:h?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):m?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:m.url,alt:m.species?.englishName||"Bird image",className:"w-full rounded-lg"}),u&&m.annotations.map(e=>e.boundingBox?s.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-500 bg-opacity-20 rounded",style:{left:100*e.boundingBox.x+"%",top:100*e.boundingBox.y+"%",width:100*e.boundingBox.width+"%",height:100*e.boundingBox.height+"%"},title:`${e.spanishTerm} (${e.englishTerm})`,children:s.jsx("span",{className:"absolute -top-6 left-0 bg-blue-600 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:e.spanishTerm})},e.id):null)]}),m.annotations.length>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"showAnnotations",checked:u,onChange:e=>j(e.target.checked),className:"rounded text-blue-600"}),s.jsx("label",{htmlFor:"showAnnotations",className:"text-sm text-gray-600",children:"Show annotation overlays"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Species"}),s.jsx("p",{className:"text-gray-600",children:m.species?.englishName||"Unknown"}),s.jsx("p",{className:"text-sm text-gray-500 italic",children:m.species?.scientificName}),s.jsx("p",{className:"text-sm text-gray-500",children:m.species?.spanishName})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Image Info"}),s.jsxs("p",{className:"text-sm text-gray-600",children:[m.width," x ",m.height]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("span",{className:"text-sm text-gray-500",children:"Quality:"}),(()=>{const e=H(m.qualityScore);return s.jsx(l,{variant:e.variant,size:"sm",children:e.label})})()]}),m.photographer&&s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Photo by ",m.photographer,m.photographerUsername&&s.jsxs("span",{className:"text-gray-400",children:[" ","(@",m.photographerUsername,")"]})]}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Added ",new Date(m.createdAt).toLocaleString()]})]})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["Annotations (",m.annotations.length,")"]}),0===m.annotations.length?s.jsx("p",{className:"text-gray-500 text-sm",children:"No annotations yet"}):s.jsx("div",{className:"max-h-48 overflow-y-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left py-2 px-3",children:"Spanish"}),s.jsx("th",{className:"text-left py-2 px-3",children:"English"}),s.jsx("th",{className:"text-left py-2 px-3",children:"Type"}),s.jsx("th",{className:"text-left py-2 px-3",children:"Status"}),s.jsx("th",{className:"text-left py-2 px-3",children:"Confidence"})]})}),s.jsx("tbody",{children:m.annotations.map(e=>s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"py-2 px-3 font-medium",children:e.spanishTerm}),s.jsx("td",{className:"py-2 px-3",children:e.englishTerm}),s.jsx("td",{className:"py-2 px-3",children:s.jsx(l,{variant:"info",size:"sm",children:e.annotationType})}),s.jsx("td",{className:"py-2 px-3",children:s.jsx(l,{variant:"approved"===e.status?"success":"rejected"===e.status?"danger":"warning",size:"sm",children:e.status})}),s.jsx("td",{className:"py-2 px-3",children:e.confidence?`${(100*e.confidence).toFixed(0)}%`:"-"})]},e.id))})]})})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[0===m.annotations.length&&s.jsx(x,{variant:"primary",onClick:r,isLoading:c,disabled:c,children:"Generate Annotations"}),s.jsx(x,{variant:"danger",onClick:o,isLoading:d,disabled:d,children:"Delete Image"}),s.jsx(x,{variant:"secondary",onClick:n,children:"Close"})]})]}):s.jsx(g,{variant:"danger",children:"Failed to load image details"})}):null},X=({species:a,onToast:t,selectedImages:n,onSelectionChange:l})=>{const[m,g]=e.useState({page:1,pageSize:20,annotationStatus:"all",qualityFilter:"all",sortBy:"createdAt",sortOrder:"desc"}),[h,u]=e.useState(null),[j,N]=e.useState(null),[w,k]=e.useState(!1),[S,L]=e.useState([]),A=n??S,P=l??L,{data:I,isLoading:q,refetch:T}=((e={})=>{const{page:s=1,pageSize:a=20,speciesId:t,annotationStatus:n="all",qualityFilter:l="all",sortBy:r="createdAt",sortOrder:o="desc"}=e;return y({queryKey:Q.list(e),queryFn:async()=>{try{const e=new URLSearchParams({page:s.toString(),pageSize:a.toString(),annotationStatus:n,qualityFilter:l,sortBy:r,sortOrder:o});return t&&e.append("speciesId",t),(await i.get(`/api/admin/images?${e}`)).data.data}catch(e){return f("Error fetching gallery images:",e instanceof Error?e:new Error(String(e))),{images:[],pagination:{total:0,page:1,pageSize:20,totalPages:0}}}},staleTime:3e4,gcTime:3e5})})(m),D=(()=>{const e=b();return v({mutationFn:async e=>(await i.delete(`/api/admin/images/${e}`)).data,onSuccess:()=>{e.invalidateQueries({queryKey:Q.all})},onError:e=>{f("Error deleting image:",e instanceof Error?e:new Error(String(e)))}})})(),z=(()=>{const e=b();return v({mutationFn:async e=>{if(!e||"string"!=typeof e)throw new Error("Invalid image ID provided");if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))throw new Error("Invalid image ID format");return(await i.post(`/api/admin/images/${e}/annotate`)).data},onSuccess:(s,a)=>{e.invalidateQueries({queryKey:Q.detail(a)}),e.invalidateQueries({queryKey:Q.all})},onError:e=>{f("Error annotating image:",new Error(e?.response?.data?.error||e?.response?.data?.message||e?.message||"Failed to annotate image"))}})})();e.useEffect(()=>{P([])},[m.speciesId,m.annotationStatus,m.qualityFilter,P]);const E=e.useCallback(e=>{g(s=>({...s,...e}))},[]),M=e.useCallback(e=>{u(e)},[]),F=e.useCallback(async e=>{try{const s=await z.mutateAsync(e);t("success",`Generated ${s.annotationCount} annotations`),T()}catch{t("error","Failed to generate annotations")}},[z,t,T]),B=e.useCallback(async e=>{try{await D.mutateAsync(e),t("success","Image deleted successfully"),u(null),N(null),T()}catch{t("error","Failed to delete image")}},[D,t,T]),$=e.useCallback(e=>{g(s=>({...s,page:e}))},[]),O=e.useCallback(e=>{P(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},[P]),R=e.useCallback(()=>{const e=(I?.images||[]).map(e=>e.id);P(e)},[I?.images,P]),K=e.useCallback(()=>{P([])},[P]),U=e.useCallback(async()=>{if(0!==A.length)try{for(const e of A)await D.mutateAsync(e);t("success",`Deleted ${A.length} image(s) successfully`),P([]),T()}catch{t("error","Failed to delete selected images")}},[A,D,t,P,T]),H=e.useCallback(async()=>{if(0!==A.length)try{let e=0;for(const s of A){await z.mutateAsync(s)&&e++}t("success",`Generated annotations for ${e} image(s)`),P([]),T()}catch{t("error","Failed to generate annotations for selected images")}},[A,z,t,P,T]),X=I?.images||[],Y=I?.pagination||{total:0,page:1,pageSize:20,totalPages:0},Z=X.map(e=>e.id),ee=Z.length>0&&Z.every(e=>A.includes(e));return s.jsxs("div",{children:[s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Image Gallery",subtitle:`Browse and manage ${Y.total} collected images`}),s.jsxs(c,{children:[s.jsx("div",{className:"flex justify-end mb-4",children:s.jsx(d,{content:"Upload new bird images from your computer to add to the dataset",position:"left",children:s.jsx("div",{children:s.jsxs(x,{variant:"primary",onClick:()=>k(!0),children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Upload Images"]})})})}),s.jsx(V,{species:a,filters:m,onFilterChange:E}),0===A.length&&X.length>0&&s.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 mb-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600",children:[s.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsxs("span",{children:[s.jsx("strong",{children:"Tip:"})," Check the boxes on images to select them for batch annotation or deletion."]})]}),s.jsx(C,{selectedCount:A.length,onSelectAll:R,onDeselectAll:K,onDelete:U,onAnnotate:H,isDeleting:D.isPending,isAnnotating:z.isPending,totalCount:Z.length,allSelected:ee}),q?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-3 text-gray-600",children:"Loading images..."})]}):0===X.length?s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s.jsx("p",{className:"text-lg font-medium",children:"No images found"}),s.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your filters or collect some images first."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:X.map(e=>s.jsx(G,{image:e,onView:()=>M(e.id),onAnnotate:()=>F(e.id),onDelete:()=>N(e.id),isDeleting:D.isPending&&j===e.id,isAnnotating:z.isPending,isSelected:A.includes(e.id),onToggleSelect:()=>O(e.id)},e.id))}),s.jsx(J,{page:Y.page,totalPages:Y.totalPages,total:Y.total,pageSize:Y.pageSize,onPageChange:$})]})]})]}),h&&s.jsx(_,{imageId:h,isOpen:!!h,onClose:()=>u(null),onAnnotate:()=>F(h),onDelete:()=>B(h),isAnnotating:z.isPending,isDeleting:D.isPending}),s.jsx(p,{isOpen:!!j,onClose:()=>N(null),title:"Delete Image",size:"sm",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-gray-600",children:"Are you sure you want to delete this image? This will also delete all associated annotations. This action cannot be undone."}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx(x,{variant:"secondary",onClick:()=>N(null),children:"Cancel"}),s.jsx(x,{variant:"danger",onClick:()=>j&&B(j),isLoading:D.isPending,children:"Delete"})]})]})}),s.jsx(W,{isOpen:w,onClose:()=>k(!1),species:a,onSuccess:()=>T(),onToast:t})]})},Y=()=>{const{user:i,loading:d}=t(),{data:p=[],isLoading:j}=n(),{stats:b,quota:y,jobs:v,pendingImages:f,isLoading:N,refetchStats:C,collectMutation:L,annotateMutation:A,bulkDeleteMutation:P,bulkAnnotateMutation:I}=w(),{toasts:q,addToast:T,removeToast:D}=h(),[z,E]=e.useState("collection"),[M,F]=e.useState([]),[B,Q]=e.useState(2),[R,K]=e.useState([]),[U,W]=e.useState(!0),[H,V]=e.useState(!1),[G,J]=e.useState([]);if(d)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading..."})]})});if(!i)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access image management."}),s.jsx(a,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});const _=j||N;return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Image Management"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Collect bird images and manage AI annotations"})]}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(a,{to:"/admin/annotations",className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"View Annotations"})})]}),s.jsx("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[{key:"collection",label:"Image Collection"},{key:"gallery",label:"Gallery"},{key:"annotation",label:"Batch Annotation"},{key:"statistics",label:"Statistics"},{key:"history",label:"Job History"}].map(e=>s.jsxs("button",{onClick:()=>E(e.key),className:"relative px-4 py-2 font-medium border-b-2 transition-colors "+(z===e.key?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[e.label,"annotation"===e.key&&G.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-600 rounded-full",children:G.length})]},e.key))})]})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[_&&s.jsx($,{activeTab:z}),!_&&s.jsxs(s.Fragment,{children:["collection"===z&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Collect Images",subtitle:"Select species and configure collection parameters"}),s.jsx(c,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bird Species"}),s.jsx(k,{species:p,selected:M,onChange:F,disabled:L.isPending})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images per Species"}),s.jsx("input",{type:"number",min:1,max:10,value:B,onChange:e=>Q(parseInt(e.target.value)||2),disabled:L.isPending,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:bg-gray-100"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Recommended: 2-5 images per species"})]}),y&&y.unsplash.remaining<10&&s.jsxs(g,{variant:"warning",title:"Low API Quota",children:["Only ",y.unsplash.remaining," Unsplash requests remaining.",y.unsplash.resetTime&&s.jsxs("span",{children:[" Resets at ",new Date(y.unsplash.resetTime).toLocaleTimeString()]})]})]})}),s.jsx(m,{children:s.jsxs(x,{variant:"primary",onClick:async()=>{if(0!==M.length)try{await L.mutateAsync({speciesIds:M,imagesPerSpecies:B}),T("success",`Started collecting images for ${M.length} species`),F([])}catch{T("error","Failed to start image collection")}else T("error","Please select at least one species")},isLoading:L.isPending,disabled:0===M.length||L.isPending,children:["Collect Images (",M.length," species)"]})})]}),s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Active Jobs",subtitle:"Currently running collection and annotation jobs"}),s.jsx(c,{children:0===v.filter(e=>"running"===e.status||"pending"===e.status).length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{children:"No active jobs"})]}):s.jsx("div",{className:"space-y-4",children:v.filter(e=>"running"===e.status||"pending"===e.status).map(e=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-medium capitalize",children:e.type}),s.jsx(l,{variant:"running"===e.status?"primary":"warning",dot:!0,children:e.status})]}),s.jsx(O,{value:e.progress,max:e.total,variant:"gradient",color:"primary",showLabel:!0,animated:"running"===e.status}),s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[e.progress," / ",e.total," completed"]})]},e.id))})})]})]}),"gallery"===z&&s.jsx(X,{species:p,onToast:T,selectedImages:G,onSelectionChange:J}),"annotation"===z&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Batch Annotation",subtitle:"Generate AI annotations for multiple images"}),s.jsx(c,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"How Batch Annotation Works:"}),s.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-blue-700",children:[s.jsxs("li",{children:["Go to the ",s.jsx("strong",{children:"Gallery"})," tab"]}),s.jsx("li",{children:"Select images using the checkboxes"}),s.jsx("li",{children:'Click "Annotate Selected" in the toolbar'}),s.jsx("li",{children:"Monitor progress in real-time below"})]}),s.jsx("p",{className:"mt-2 text-blue-700",children:"Or use the quick options below to annotate all pending images at once."})]})]})}),G.length>0&&s.jsxs("div",{className:"border-2 border-blue-300 bg-blue-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsxs("span",{className:"font-medium text-blue-900",children:[G.length," image",1!==G.length?"s":""," selected from Gallery"]})]}),s.jsx(x,{variant:"secondary",size:"sm",onClick:()=>J([]),children:"Clear"})]}),s.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Ready to annotate your selected images with AI-generated vocabulary terms."}),s.jsxs(x,{variant:"primary",onClick:async()=>{try{const e=await I.mutateAsync(G);T("success",e.message),J([])}catch{T("error","Failed to start bulk annotation")}},isLoading:I.isPending,disabled:I.isPending,className:"w-full",children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Annotate ",G.length," Selected Image",1!==G.length?"s":""]})]}),0===G.length&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border rounded-lg p-4",children:s.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[s.jsx("input",{type:"radio",checked:U,onChange:()=>W(!0),disabled:A.isPending,className:"w-4 h-4 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Annotate all un-annotated images"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Process all ",b?.pendingAnnotation||0," images without annotations"]})]})]})}),s.jsx("div",{className:"border rounded-lg p-4",children:s.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[s.jsx("input",{type:"radio",checked:!U,onChange:()=>W(!1),disabled:A.isPending,className:"w-4 h-4 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Select specific pending images"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Choose individual images from the list below"})]})]})}),!U&&s.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto bg-gray-50",children:0===f.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{className:"font-medium",children:"All images are annotated!"}),s.jsx("p",{className:"text-sm mt-1",children:"No pending images to process"})]}):s.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map(e=>s.jsxs("label",{className:"relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all "+(R.includes(e.id)?"border-blue-500 ring-2 ring-blue-200":"border-transparent hover:border-gray-300"),children:[s.jsx("input",{type:"checkbox",checked:R.includes(e.id),onChange:s=>{s.target.checked?K([...R,e.id]):K(R.filter(s=>s!==e.id))},className:"sr-only"}),s.jsx("img",{src:e.url,alt:"Bird",className:"w-full h-20 object-cover"}),R.includes(e.id)&&s.jsx("div",{className:"absolute top-1 right-1 bg-blue-600 rounded-full p-0.5",children:s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.id))})})]}),y&&y.anthropic.remaining<100&&s.jsxs(g,{variant:"warning",title:"Low API Quota",children:["Only ",y.anthropic.remaining," Anthropic requests remaining.",y.anthropic.resetTime&&s.jsxs("span",{children:[" Resets at ",new Date(y.anthropic.resetTime).toLocaleTimeString()]})]})]})}),s.jsx(m,{children:0===G.length&&s.jsxs(x,{variant:"primary",onClick:async()=>{try{if(U)await A.mutateAsync({all:!0}),T("success","Started annotation for all pending images");else{if(0===R.length)return void T("error","Please select at least one image");await A.mutateAsync({imageIds:R}),T("success",`Started annotation for ${R.length} images`),K([])}}catch{T("error","Failed to start annotation")}},isLoading:A.isPending,disabled:A.isPending||!U&&0===R.length||U&&0===(b?.pendingAnnotation||0),children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Start Annotation"]})})]}),s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Annotation Progress",subtitle:"Real-time annotation status"}),s.jsx(c,{children:0===v.filter(e=>"annotation"===e.type&&("running"===e.status||"pending"===e.status)).length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),s.jsx("p",{children:"No annotation jobs running"}),s.jsx("p",{className:"text-sm mt-1",children:"Start an annotation job to see progress here"})]}):s.jsx("div",{className:"space-y-4",children:v.filter(e=>"annotation"===e.type&&("running"===e.status||"pending"===e.status)).map(e=>s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(l,{variant:"running"===e.status?"success":"warning",dot:!0,children:"running"===e.status?"Processing":"Queued"}),s.jsxs("span",{className:"text-sm text-gray-500",children:["Started ",new Date(e.startedAt).toLocaleTimeString()]})]}),s.jsx(O,{value:e.progress,max:e.total,variant:"striped",color:"success",size:"lg",showLabel:!0,label:"Annotation Progress",animated:!0}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[s.jsxs("div",{className:"bg-green-50 rounded-lg p-2",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:e.results?.annotated||0}),s.jsx("div",{className:"text-xs text-green-700",children:"Annotated"})]}),s.jsxs("div",{className:"bg-yellow-50 rounded-lg p-2",children:[s.jsx("div",{className:"text-lg font-bold text-yellow-600",children:e.total-e.progress}),s.jsx("div",{className:"text-xs text-yellow-700",children:"Remaining"})]}),s.jsxs("div",{className:"bg-red-50 rounded-lg p-2",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:e.results?.failed||0}),s.jsx("div",{className:"text-xs text-red-700",children:"Failed"})]})]})]},e.id))})})]})]}),"statistics"===z&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(r,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-blue-600",children:b?.totalImages||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Total Images"})]})}),s.jsx(r,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:b?.pendingAnnotation||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Pending Annotation"})]})}),s.jsx(r,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-green-600",children:b?.annotated||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Annotated"})]})}),s.jsx(r,{variant:"elevated",padding:"md",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-red-600",children:b?.failed||0}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Failed"})]})})]}),s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"API Quota Status",subtitle:"Current usage and limits"}),s.jsx(c,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Unsplash API"}),s.jsx(O,{value:y?.unsplash.remaining||0,max:y?.unsplash.limit||50,variant:"gradient",color:(y?.unsplash.remaining||0)<10?"danger":(y?.unsplash.remaining||0)<25?"warning":"success",showLabel:!0,label:"Requests Remaining"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[y?.unsplash.remaining||0," / ",y?.unsplash.limit||50," requests",y?.unsplash.resetTime&&s.jsxs("span",{className:"ml-2",children:["(Resets: ",new Date(y.unsplash.resetTime).toLocaleString(),")"]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Anthropic API"}),s.jsx(O,{value:y?.anthropic.remaining||0,max:y?.anthropic.limit||1e3,variant:"gradient",color:(y?.anthropic.remaining||0)<100?"danger":(y?.anthropic.remaining||0)<500?"warning":"success",showLabel:!0,label:"Tokens Remaining"}),s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[y?.anthropic.remaining||0," / ",y?.anthropic.limit||1e3," requests",y?.anthropic.resetTime&&s.jsxs("span",{className:"ml-2",children:["(Resets: ",new Date(y.anthropic.resetTime).toLocaleString(),")"]})]})]})]})})]}),s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Images by Species",subtitle:"Distribution of collected images - click to filter gallery"}),s.jsx(c,{children:b?.bySpecies&&Object.keys(b.bySpecies).length>0?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Object.entries(b.bySpecies).sort(([,e],[,s])=>{const a="number"==typeof e?e:e.count;return("number"==typeof s?s:s.count)-a}).slice(0,12).map(([e,a])=>{const t="number"==typeof a?a:a.count,n="object"==typeof a&&a.sampleImageUrl?a.sampleImageUrl:null;return"object"==typeof a&&a.speciesId&&a.speciesId,s.jsxs("button",{onClick:()=>{E("gallery")},className:"bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all border-2 border-gray-200 hover:border-blue-400 text-left group",title:`View ${t} ${e} image${1!==t?"s":""}`,children:[n?s.jsxs("div",{className:"relative aspect-[4/3] bg-gray-100",children:[s.jsx("img",{src:n,alt:e,className:"w-full h-full object-cover",loading:"lazy"}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center",children:s.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium text-sm bg-blue-600 px-3 py-1 rounded-full transition-opacity",children:"View All"})})]}):s.jsx("div",{className:"aspect-[4/3] bg-gray-100 flex items-center justify-center",children:s.jsx("svg",{className:"w-12 h-12 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),s.jsxs("div",{className:"p-3",children:[s.jsx("div",{className:"text-xl font-bold text-gray-800 mb-1",children:t}),s.jsx("div",{className:"text-sm text-gray-600 truncate",title:e,children:e})]})]},e)})}):s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No images collected yet"})})]})]}),"history"===z&&s.jsxs(r,{variant:"elevated",padding:"lg",children:[s.jsx(o,{title:"Job History",subtitle:"Recent collection and annotation jobs"}),s.jsx(c,{children:0===v.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),s.jsx("p",{children:"No jobs yet"}),s.jsx("p",{className:"text-sm mt-1",children:"Start collecting or annotating images to see job history"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Type"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Status"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Progress"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Started"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Completed"}),s.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Results"})]})}),s.jsx("tbody",{children:v.map(e=>s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"py-3 px-4",children:s.jsx(l,{variant:"collection"===e.type?"primary":"info",size:"sm",children:e.type})}),s.jsx("td",{className:"py-3 px-4",children:s.jsx(l,{variant:"completed"===e.status?"success":"failed"===e.status?"danger":"running"===e.status?"primary":"warning",dot:!0,size:"sm",children:e.status})}),s.jsx("td",{className:"py-3 px-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(O,{value:e.progress,max:e.total,size:"sm",color:"failed"===e.status?"danger":"primary",className:"w-24"}),s.jsxs("span",{className:"text-sm text-gray-600",children:[e.progress,"/",e.total]})]})}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(e.startedAt).toLocaleString()}),s.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:e.completedAt?new Date(e.completedAt).toLocaleString():"-"}),s.jsx("td",{className:"py-3 px-4",children:e.results?s.jsxs("div",{className:"text-sm",children:["collection"===e.type&&s.jsxs("span",{className:"text-green-600",children:[e.results.collected," collected"]}),"annotation"===e.type&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"text-green-600",children:[e.results.annotated," annotated"]}),e.results.failed&&e.results.failed>0&&s.jsxs("span",{className:"text-red-600 ml-2",children:[e.results.failed," failed"]})]})]}):e.error?s.jsx("span",{className:"text-sm text-red-600",title:e.error,children:"Error"}):"-"})]},e.id))})]})})})]})]})]}),s.jsx(u,{toasts:q,onRemove:D}),s.jsx(S,{isOpen:H,onClose:()=>V(!1),onConfirm:async()=>{try{const e=await P.mutateAsync(G);T("success",e.message),J([]),V(!1),C()}catch{T("error","Failed to delete images")}},count:G.length,isDeleting:P.isPending})]})};export{Y as ImageManagementPage,Y as default};
