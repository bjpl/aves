import{r as e,j as t,L as s}from"./react-vendor-BjSJ0Zw_.js";import{a as r,B as a,C as i,c as n,T as l,b as c}from"./Tooltip-BDDCW5yJ.js";import{M as d}from"./Modal-Dn8BwoZG.js";import{u as o}from"./data-vendor-Co-Mk0hz.js";import{e as x}from"./index-DR9osLae.js";import{u as m}from"./useSupabaseAuth-D05WyEDk.js";import"./vendor-B4WW6Bjp.js";const h={all:["ml-analytics"],overview:()=>[...h.all,"overview"],vocabularyBalance:()=>[...h.all,"vocabulary-balance"],patternLearning:()=>[...h.all,"pattern-learning"],qualityTrends:()=>[...h.all,"quality-trends"],performanceMetrics:()=>[...h.all,"performance-metrics"]},g=()=>{const{data:s,isLoading:m}=o({queryKey:h.overview(),queryFn:async()=>{try{return(await r.get("/api/ml/analytics/overview")).data}catch(e){throw x("Error fetching ML overview:",e instanceof Error?e:new Error(String(e))),e}},staleTime:12e4,gcTime:6e5,retry:2}),{data:g,isLoading:p}=o({queryKey:h.vocabularyBalance(),queryFn:async()=>{try{return(await r.get("/api/ml/analytics/vocabulary-balance")).data}catch(e){throw x("Error fetching vocabulary balance:",e instanceof Error?e:new Error(String(e))),e}},staleTime:3e5,gcTime:9e5,retry:2}),{data:b,isLoading:y}=o({queryKey:h.patternLearning(),queryFn:async()=>{try{return(await r.get("/api/ml/analytics/pattern-learning")).data}catch(e){throw x("Error fetching pattern learning:",e instanceof Error?e:new Error(String(e))),e}},staleTime:18e4,gcTime:6e5,retry:2}),{data:u,isLoading:j}=o({queryKey:h.qualityTrends(),queryFn:async()=>{try{return(await r.get("/api/ml/analytics/quality-trends")).data}catch(e){throw x("Error fetching quality trends:",e instanceof Error?e:new Error(String(e))),e}},staleTime:3e5,gcTime:9e5,retry:2}),{data:v,isLoading:f}=o({queryKey:h.performanceMetrics(),queryFn:async()=>{try{return(await r.get("/api/ml/analytics/performance-metrics")).data}catch(e){throw x("Error fetching performance metrics:",e instanceof Error?e:new Error(String(e))),e}},staleTime:12e4,gcTime:6e5,retry:2}),[N,w]=e.useState(null),[L,q]=e.useState(!1);return m||p||y||j||f?t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading ML analytics..."})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"ML Optimization Dashboard"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pattern learning, vocabulary balance, and quality improvements"})]}),t.jsx(a,{variant:"active"===b?.learningStatus?"success":"warning",size:"lg",children:"active"===b?.learningStatus?"üß† Learning Active":"‚è≥ Initializing"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(i,{variant:"elevated",children:t.jsx(n,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Number of unique visual/vocabulary patterns the ML model has identified from approved annotations",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Learned Patterns"})}),t.jsx("p",{className:"text-4xl font-bold text-purple-600",children:s?.patternLearning.totalPatterns||0}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Across ",s?.patternLearning.speciesTracked||0," species"]})]})})}),t.jsx(i,{variant:"elevated",children:t.jsx(n,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Percentage change in annotation quality comparing recent annotations to historical baseline",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Quality Improvement"})}),t.jsx("p",{className:"text-4xl font-bold "+(s?.qualityMetrics.improvement.startsWith("+")?"text-green-600":"text-gray-600"),children:s?.qualityMetrics.improvement||"0%"}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Recent vs Historical"})]})})}),t.jsx(i,{variant:"elevated",children:t.jsx(n,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Percentage of expected bird anatomy features (beak, wing, tail, etc.) covered by annotations across all species",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Vocab Coverage"})}),t.jsxs("p",{className:"text-4xl font-bold text-blue-600",children:[g?.coverage||0,"%"]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[g?.totalFeatures||0," features tracked"]})]})})}),t.jsx(i,{variant:"elevated",children:t.jsx(n,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Average number of images processed per second by the annotation pipeline",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Throughput"})}),t.jsx("p",{className:"text-4xl font-bold text-orange-600",children:(v?.pipeline?.throughput||0).toFixed(2)}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"images/second"})]})})})]}),b&&b.topPatterns.length>0&&t.jsxs(i,{variant:"elevated",children:[t.jsx(c,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Learned Patterns"}),b.topPatterns.length>6&&t.jsxs("button",{onClick:()=>q(!0),className:"text-sm text-blue-600 hover:text-blue-800 underline",children:["View all ",b.topPatterns.length," patterns"]})]})}),t.jsx(n,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:b.topPatterns.slice(0,6).map((e,s)=>t.jsxs("button",{onClick:()=>w(e),className:"text-left border-2 rounded-lg p-4 cursor-pointer transition-all hover:shadow-md "+("high"===e.reliability?"border-green-300 bg-green-50 hover:border-green-400":"medium"===e.reliability?"border-yellow-300 bg-yellow-50 hover:border-yellow-400":"border-gray-300 bg-gray-50 hover:border-gray-400"),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-900",children:e.feature}),t.jsxs(a,{variant:"high"===e.reliability?"success":"medium"===e.reliability?"warning":"default",size:"sm",children:[(100*e.confidence).toFixed(0),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[t.jsxs("span",{children:[e.observations," observations"]}),t.jsx("span",{className:"text-blue-600",children:"Click for details"})]})]},s))})})]}),t.jsx(d,{isOpen:null!==N,onClose:()=>w(null),title:"Pattern Details",size:"md",children:N&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"p-4 rounded-lg "+("high"===N.reliability?"bg-green-50":"medium"===N.reliability?"bg-yellow-50":"bg-gray-50"),children:[t.jsx("h4",{className:"text-xl font-bold text-gray-900 mb-2",children:N.feature}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Confidence Score"}),t.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[(100*N.confidence).toFixed(1),"%"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Observations"}),t.jsx("p",{className:"text-2xl font-bold text-purple-600",children:N.observations})]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Reliability Level"}),t.jsxs(a,{variant:"high"===N.reliability?"success":"medium"===N.reliability?"warning":"default",size:"lg",children:[N.reliability.charAt(0).toUpperCase()+N.reliability.slice(1)," Reliability"]})]}),t.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"What this means:"}),' The ML system has learned to recognize "',N.feature,'" with'," ","high"===N.reliability?"high":"medium"===N.reliability?"moderate":"low"," ","accuracy based on ",N.observations," verified examples in the training data."]})})]})}),t.jsx(d,{isOpen:L,onClose:()=>q(!1),title:"All Learned Patterns",size:"lg",children:b&&t.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:b.topPatterns.map((e,s)=>t.jsxs("button",{onClick:()=>{q(!1),w(e)},className:"text-left border-2 rounded-lg p-3 cursor-pointer transition-all hover:shadow-md "+("high"===e.reliability?"border-green-300 bg-green-50":"medium"===e.reliability?"border-yellow-300 bg-yellow-50":"border-gray-300 bg-gray-50"),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-900",children:e.feature}),t.jsxs(a,{variant:"high"===e.reliability?"success":"medium"===e.reliability?"warning":"default",size:"sm",children:[(100*e.confidence).toFixed(0),"%"]})]}),t.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.observations," observations"]})]},s))})})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[g&&g.topGaps&&g.topGaps.length>0&&t.jsxs(i,{variant:"elevated",children:[t.jsx(c,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Vocabulary Gaps"})}),t.jsxs(n,{children:[t.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:g.topGaps.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-yellow-50 border border-yellow-200 rounded hover:bg-yellow-100 transition-colors",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:e}),t.jsx(a,{variant:"warning",size:"sm",children:"Missing"})]},s))}),t.jsx("p",{className:"text-xs text-gray-600 mt-3",children:"üí° Run ML-optimized pipeline to target these features"})]})]}),u&&u.summary&&t.jsxs(i,{variant:"elevated",children:[t.jsx(c,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quality Trend"})}),t.jsx(n,{children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Current Quality"}),t.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[(100*(u.summary.currentQuality||0)).toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Improvement"}),t.jsxs("span",{className:"text-xl font-bold "+(Number(u.summary.improvement||0)>0?"text-green-600":"text-gray-600"),children:[Number(u.summary.improvement||0)>0?"+":"",u.summary.improvement||0,"%"]})]}),u.summary.totalWeeks&&t.jsx("div",{className:"pt-2 border-t",children:t.jsxs("p",{className:"text-xs text-gray-600",children:["üìà Tracking ",u.summary.totalWeeks," weeks of data"]})})]})})]})]}),v&&"active"===v.status?.pipelineStatus&&v.pipeline&&t.jsxs(i,{variant:"elevated",children:[t.jsx(c,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pipeline Performance"})}),t.jsxs(n,{children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Median processing time - 50% of images complete within this time",position:"bottom",children:t.jsx("p",{className:"text-sm text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"P50 Latency"})}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[((v.pipeline.p50Duration||0)/1e3).toFixed(1),"s"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"95th percentile processing time - 95% of images complete within this time (worst-case typical)",position:"bottom",children:t.jsx("p",{className:"text-sm text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"P95 Latency"})}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[((v.pipeline.p95Duration||0)/1e3).toFixed(1),"s"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Percentage of annotation attempts that completed without errors",position:"bottom",children:t.jsx("p",{className:"text-sm text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Success Rate"})}),t.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[v.pipeline.successRate||0,"%"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(l,{content:"Number of images being processed in parallel - higher means faster batch processing",position:"bottom",children:t.jsx("p",{className:"text-sm text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Concurrency"})}),t.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[v.pipeline.concurrency||1,"x"]})]})]}),v.status?.lastRun&&t.jsxs("p",{className:"text-xs text-gray-600 mt-4 text-center",children:["Last run: ",new Date(v.status.lastRun).toLocaleString()]})]})]}),b&&b.speciesInsights.length>0&&t.jsxs(i,{variant:"elevated",children:[t.jsx(c,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Species-Specific Recommendations"})}),t.jsx(n,{children:t.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:b.speciesInsights.slice(0,8).map((e,s)=>t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"font-semibold text-gray-900",children:e.species}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(a,{variant:"info",size:"sm",children:[e.annotations," annotations"]}),t.jsxs(a,{variant:"default",size:"sm",children:[e.features," features"]})]})]}),e.recommendedFeatures.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Recommended features:"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:e.recommendedFeatures.map((e,s)=>t.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:e},s))})]})]},s))})})]})]})},p=()=>{const{user:e,loading:r}=m();return r?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading ML analytics..."})]})}):e?t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ML Analytics Dashboard"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Pattern learning, vocabulary balance, and quality optimization insights"})]}),t.jsx(s,{to:"/admin/annotations",className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"‚Üê Back to Annotations"})]})})}),t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:t.jsx(g,{})})]}):t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access ML analytics."}),t.jsx(s,{to:"/login",className:"inline-block bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})})};export{p as MLAnalyticsPage,p as default};
