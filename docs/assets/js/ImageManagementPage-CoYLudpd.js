import{j as e,r as s,L as a}from"./react-vendor-B7ruFUgT.js";import{u as t}from"./useSupabaseAuth-n6klg7qD.js";import{L as n,u as l}from"./useSpecies-CgYLMz3M.js";import{a as i,d as r,C as d,b as o,c,B as m,e as x}from"./Badge-Dl6uxi5r.js";import{u as g,a as h,b as u}from"./data-vendor-DnujTR0P.js";import{e as p}from"./index-Xh41Qkge.js";import"./vendor-BPmQ3rSz.js";import"./apiAdapter-wUL4QmyJ.js";const j=({value:s,max:a=100,size:t="md",variant:n="default",color:l="primary",showLabel:i=!1,label:r,animated:d=!1,className:o=""})=>{const c=Math.min(Math.max(s/a*100,0),100),m={primary:"bg-blue-600",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-600"},x={primary:"bg-gradient-to-r from-blue-400 to-blue-600",success:"bg-gradient-to-r from-green-400 to-green-600",warning:"bg-gradient-to-r from-yellow-400 to-yellow-600",danger:"bg-gradient-to-r from-red-400 to-red-600"};return e.jsxs("div",{className:o,children:[(i||r)&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:r||"Progress"}),e.jsxs("span",{children:[Math.round(c),"%"]})]}),e.jsx("div",{className:`w-full bg-gray-200 rounded-full overflow-hidden ${{sm:"h-1",md:"h-3",lg:"h-4"}[t]}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${"gradient"===n?x[l]:"striped"===n?`${m[l]} bg-[length:1rem_1rem] bg-[linear-gradient(45deg,rgba(255,255,255,.15)_25%,transparent_25%,transparent_50%,rgba(255,255,255,.15)_50%,rgba(255,255,255,.15)_75%,transparent_75%,transparent)]`:m[l]} ${d?"animate-pulse":""}`,style:{width:`${c}%`},role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":a})})]})},y=({variant:s="info",title:a,children:t,onClose:n,icon:l})=>{const i={info:{container:"bg-blue-50 border-blue-400 text-blue-700",icon:"text-blue-400",defaultIcon:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})},success:{container:"bg-green-50 border-green-400 text-green-700",icon:"text-green-400",defaultIcon:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})},warning:{container:"bg-yellow-50 border-yellow-400 text-yellow-700",icon:"text-yellow-400",defaultIcon:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})},danger:{container:"bg-red-50 border-red-400 text-red-700",icon:"text-red-400",defaultIcon:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}}[s];return e.jsx("div",{className:`border-l-4 rounded p-4 ${i.container}`,role:"alert",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 ${i.icon}`,children:l||i.defaultIcon}),e.jsxs("div",{className:"ml-3 flex-1",children:[a&&e.jsx("h3",{className:"text-sm font-bold mb-1",children:a}),e.jsx("div",{className:"text-sm",children:t})]}),n&&e.jsx("button",{onClick:n,className:"flex-shrink-0 ml-3 inline-flex text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded","aria-label":"Close alert",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})},b=({isOpen:a,onClose:t,title:n,size:l="md",showCloseButton:i=!0,closeOnOverlayClick:r=!0,closeOnEscape:d=!0,children:o,footer:c})=>{const m=s.useRef(null);if(s.useEffect(()=>{const e=e=>{d&&"Escape"===e.key&&t()};return a&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[a,t,d]),!a)return null;return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity",onClick:e=>{r&&e.target===e.currentTarget&&t()}}),e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:e.jsxs("div",{ref:m,className:`relative bg-white rounded-lg shadow-xl transform transition-all w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-full mx-4"}[l]}`,children:[(n||i)&&e.jsxs("div",{className:"flex items-start justify-between p-6 border-b border-gray-200",children:[n&&e.jsx("h3",{id:"modal-title",className:"text-xl font-semibold text-gray-900",children:n}),i&&e.jsx("button",{onClick:t,className:"ml-auto text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg p-1","aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 max-h-[calc(100vh-16rem)] overflow-y-auto",children:o}),c&&e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:c})]})})]})},v={all:["gallery"],list:e=>[...v.all,"list",e],detail:e=>[...v.all,"detail",e]},f=({onFilesSelected:a,disabled:t})=>{const[n,l]=s.useState(!1),i=s.useRef(null),r=s.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),d=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.items&&e.dataTransfer.items.length>0&&l(!0)},[]),o=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),l(!1)},[]),c=s.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),l(!1),t)return;const s=Array.from(e.dataTransfer.files).filter(e=>["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type));s.length>0&&a(s)},[a,t]),m=s.useCallback(e=>{if(e.target.files&&e.target.files.length>0){const s=Array.from(e.target.files);a(s)}},[a]);return e.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer\n        transition-all duration-200\n        ${n?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}\n        ${t?"opacity-50 cursor-not-allowed":""}\n      `,onDragEnter:d,onDragLeave:o,onDragOver:r,onDrop:c,onClick:()=>{t||i.current?.click()},children:[e.jsx("input",{ref:i,type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:m,className:"hidden",disabled:t}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto "+(n?"text-blue-500":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:n?"Drop images here":"Drag & drop images here"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"or click to browse files"})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Supports: JPEG, PNG, WebP (max 10MB each, up to 20 files)"})]})]})},N=({files:s,onRemove:a,disabled:t})=>0===s.length?null:e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Selected Files (",s.length,")"]})}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-1",children:s.map(s=>e.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-gray-200",children:[e.jsx("img",{src:s.preview,alt:s.file.name,className:"w-full h-full object-cover"}),!t&&e.jsx("button",{type:"button",onClick:()=>a(s.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 px-1 py-0.5",children:e.jsx("p",{className:"text-xs text-white truncate",children:s.file.name})})]},s.id))})]}),w=({species:s,value:a,onChange:t,disabled:n})=>e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Species ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a,onChange:e=>t(e.target.value),disabled:n,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select a species..."}),s.map(s=>e.jsxs("option",{value:s.id,children:[s.englishName," (",s.scientificName,")"]},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All uploaded images will be associated with this species"})]}),k=({isOpen:a,onClose:t,species:n,onSuccess:l,onToast:d})=>{const[o,c]=s.useState([]),[m,x]=s.useState(""),[g,v]=s.useState(0),[k,C]=s.useState(null),S=(()=>{const e=h();return u({mutationFn:async({files:e,speciesId:s,onProgress:a})=>{const t=new FormData;return t.append("speciesId",s),e.forEach(e=>{t.append("files",e)}),(await i.post("/api/admin/images/upload",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total&&a){const s=Math.round(e.loaded/e.total*100);a(s)}}})).data},onSuccess:()=>{e.invalidateQueries({queryKey:["image-management"]}),e.invalidateQueries({queryKey:["gallery"]})},onError:e=>{p("Error uploading images:",e instanceof Error?e:new Error(String(e)))}})})(),L=s.useCallback(e=>{const s=e.map(e=>({file:e,preview:URL.createObjectURL(e),id:`${e.name}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}));c(e=>[...e,...s].slice(0,20)),C(null)},[]),A=s.useCallback(e=>{c(s=>{const a=s.find(s=>s.id===e);return a&&URL.revokeObjectURL(a.preview),s.filter(s=>s.id!==e)})},[]),P=()=>{o.forEach(e=>URL.revokeObjectURL(e.preview)),c([]),x(""),v(0),C(null),t()},E=S.isPending,q=o.length>0&&m&&!E;return e.jsx(b,{isOpen:a,onClose:P,title:"Upload Images",size:"lg",closeOnOverlayClick:!E,closeOnEscape:!E,children:e.jsxs("div",{className:"space-y-4",children:[k&&e.jsx(y,{variant:"danger",onClose:()=>C(null),children:k}),e.jsx(f,{onFilesSelected:L,disabled:E}),e.jsx(N,{files:o,onRemove:A,disabled:E}),e.jsx(w,{species:n,value:m,onChange:x,disabled:E}),E&&e.jsx("div",{className:"mt-4",children:e.jsx(j,{value:g,max:100,variant:"gradient",color:"primary",showLabel:!0,label:"Uploading...",animated:!0})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(r,{variant:"secondary",onClick:P,disabled:E,children:"Cancel"}),e.jsxs(r,{variant:"primary",onClick:async()=>{if(0!==o.length)if(m){C(null),v(0);try{const e=await S.mutateAsync({files:o.map(e=>e.file),speciesId:m,onProgress:v});e.summary.successful>0&&(d("success",`Successfully uploaded ${e.summary.successful} image${1!==e.summary.successful?"s":""}`),l(),P()),e.failed&&e.failed.length>0&&d("error",`${e.failed.length} file${1!==e.failed.length?"s":""} failed to upload`)}catch{C("Upload failed. Please try again.")}}else C("Please select a species");else C("Please select at least one image")},disabled:!q,isLoading:E,children:["Upload ",o.length>0?`(${o.length})`:""]})]})]})})},C=e=>null==e?{variant:"info",label:"N/A"}:e>=80?{variant:"success",label:`${e}%`}:e>=60?{variant:"warning",label:`${e}%`}:{variant:"danger",label:`${e}%`},S=({species:s,filters:a,onFilterChange:t})=>e.jsxs("div",{className:"flex flex-wrap gap-4 p-4 bg-gray-50 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Species"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.speciesId||"",onChange:e=>t({speciesId:e.target.value||void 0,page:1}),children:[e.jsx("option",{value:"",children:"All Species"}),s.map(s=>e.jsx("option",{value:s.id,children:s.englishName},s.id))]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Annotation Status"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.annotationStatus||"all",onChange:e=>t({annotationStatus:e.target.value,page:1}),children:[e.jsx("option",{value:"all",children:"All Images"}),e.jsx("option",{value:"annotated",children:"Annotated"}),e.jsx("option",{value:"unannotated",children:"Unannotated"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quality"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.qualityFilter||"all",onChange:e=>t({qualityFilter:e.target.value,page:1}),children:[e.jsx("option",{value:"all",children:"All Quality"}),e.jsx("option",{value:"high",children:"High (80-100)"}),e.jsx("option",{value:"medium",children:"Medium (60-79)"}),e.jsx("option",{value:"low",children:"Low (0-59)"}),e.jsx("option",{value:"unscored",children:"Unscored"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.sortBy||"createdAt",onChange:e=>t({sortBy:e.target.value}),children:[e.jsx("option",{value:"createdAt",children:"Date Added"}),e.jsx("option",{value:"speciesName",children:"Species Name"}),e.jsx("option",{value:"annotationCount",children:"Annotation Count"}),e.jsx("option",{value:"qualityScore",children:"Quality Score"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.sortOrder||"desc",onChange:e=>t({sortOrder:e.target.value}),children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]}),L=({image:s,onView:a,onAnnotate:t,onDelete:l,isDeleting:i,isAnnotating:d})=>e.jsxs("div",{className:"relative group bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative aspect-[4/3] cursor-pointer",onClick:a,children:[e.jsx(n,{src:s.url,alt:s.speciesName,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center",children:e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium transition-opacity",children:"Click to view"})}),e.jsx("div",{className:"absolute top-2 left-2",children:(()=>{const a=C(s.qualityScore);return e.jsx(m,{variant:a.variant,size:"sm",title:"Quality Score",children:a.label})})()}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(m,{variant:s.annotationCount>0?"success":"warning",size:"sm",children:[s.annotationCount," annotations"]})})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",title:s.speciesName,children:s.speciesName}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(r,{variant:"secondary",size:"sm",onClick:a,className:"flex-1",children:"View"}),0===s.annotationCount&&e.jsx(r,{variant:"primary",size:"sm",onClick:t,isLoading:d,disabled:d,className:"flex-1",children:"Annotate"}),e.jsx(r,{variant:"danger",size:"sm",onClick:l,isLoading:i,disabled:i,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),A=({page:s,totalPages:a,total:t,pageSize:n,onPageChange:l})=>{const i=(s-1)*n+1,d=Math.min(s*n,t);return e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",i," to ",d," of ",t," images"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"secondary",size:"sm",disabled:s<=1,onClick:()=>l(s-1),children:"Previous"}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-600",children:["Page ",s," of ",a]}),e.jsx(r,{variant:"secondary",size:"sm",disabled:s>=a,onClick:()=>l(s+1),children:"Next"})]})]})},P=({imageId:a,isOpen:t,onClose:n,onAnnotate:l,onDelete:d,isAnnotating:o,isDeleting:c})=>{const{data:x,isLoading:h}=(e=>g({queryKey:v.detail(e||""),queryFn:async()=>{if(!e)return null;try{return(await i.get(`/api/admin/images/${e}`)).data.data}catch(s){return p("Error fetching image details:",s instanceof Error?s:new Error(String(s))),null}},enabled:!!e,staleTime:6e4,gcTime:3e5}))(t?a:null),[u,j]=s.useState(!0);return t?e.jsx(b,{isOpen:t,onClose:n,title:"Image Details",size:"xl",children:h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:x.url,alt:x.species?.englishName||"Bird image",className:"w-full rounded-lg"}),u&&x.annotations.map(s=>s.boundingBox?e.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-500 bg-opacity-20 rounded",style:{left:`${s.boundingBox.x}%`,top:`${s.boundingBox.y}%`,width:`${s.boundingBox.width}%`,height:`${s.boundingBox.height}%`},title:`${s.spanishTerm} (${s.englishTerm})`,children:e.jsx("span",{className:"absolute -top-6 left-0 bg-blue-600 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:s.spanishTerm})},s.id):null)]}),x.annotations.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"showAnnotations",checked:u,onChange:e=>j(e.target.checked),className:"rounded text-blue-600"}),e.jsx("label",{htmlFor:"showAnnotations",className:"text-sm text-gray-600",children:"Show annotation overlays"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Species"}),e.jsx("p",{className:"text-gray-600",children:x.species?.englishName||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 italic",children:x.species?.scientificName}),e.jsx("p",{className:"text-sm text-gray-500",children:x.species?.spanishName})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Image Info"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[x.width," x ",x.height]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Quality:"}),(()=>{const s=C(x.qualityScore);return e.jsx(m,{variant:s.variant,size:"sm",children:s.label})})()]}),x.photographer&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Photo by ",x.photographer,x.photographerUsername&&e.jsxs("span",{className:"text-gray-400",children:[" ","(@",x.photographerUsername,")"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Added ",new Date(x.createdAt).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["Annotations (",x.annotations.length,")"]}),0===x.annotations.length?e.jsx("p",{className:"text-gray-500 text-sm",children:"No annotations yet"}):e.jsx("div",{className:"max-h-48 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Spanish"}),e.jsx("th",{className:"text-left py-2 px-3",children:"English"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Type"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Confidence"})]})}),e.jsx("tbody",{children:x.annotations.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:s.spanishTerm}),e.jsx("td",{className:"py-2 px-3",children:s.englishTerm}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(m,{variant:"info",size:"sm",children:s.annotationType})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(m,{variant:"approved"===s.status?"success":"rejected"===s.status?"danger":"warning",size:"sm",children:s.status})}),e.jsx("td",{className:"py-2 px-3",children:s.confidence?`${(100*s.confidence).toFixed(0)}%`:"-"})]},s.id))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[0===x.annotations.length&&e.jsx(r,{variant:"primary",onClick:l,isLoading:o,disabled:o,children:"Generate Annotations"}),e.jsx(r,{variant:"danger",onClick:d,isLoading:c,disabled:c,children:"Delete Image"}),e.jsx(r,{variant:"secondary",onClick:n,children:"Close"})]})]}):e.jsx(y,{variant:"danger",children:"Failed to load image details"})}):null},E=({species:a,onToast:t})=>{const[n,l]=s.useState({page:1,pageSize:20,annotationStatus:"all",qualityFilter:"all",sortBy:"createdAt",sortOrder:"desc"}),[m,x]=s.useState(null),[j,y]=s.useState(null),[f,N]=s.useState(!1),{data:w,isLoading:C,refetch:E}=((e={})=>{const{page:s=1,pageSize:a=20,speciesId:t,annotationStatus:n="all",qualityFilter:l="all",sortBy:r="createdAt",sortOrder:d="desc"}=e;return g({queryKey:v.list(e),queryFn:async()=>{try{const e=new URLSearchParams({page:s.toString(),pageSize:a.toString(),annotationStatus:n,qualityFilter:l,sortBy:r,sortOrder:d});return t&&e.append("speciesId",t),(await i.get(`/api/admin/images?${e}`)).data.data}catch(e){return p("Error fetching gallery images:",e instanceof Error?e:new Error(String(e))),{images:[],pagination:{total:0,page:1,pageSize:20,totalPages:0}}}},staleTime:3e4,gcTime:3e5})})(n),q=(()=>{const e=h();return u({mutationFn:async e=>(await i.delete(`/api/admin/images/${e}`)).data,onSuccess:()=>{e.invalidateQueries({queryKey:v.all})},onError:e=>{p("Error deleting image:",e instanceof Error?e:new Error(String(e)))}})})(),I=(()=>{const e=h();return u({mutationFn:async e=>(await i.post(`/api/admin/images/${e}/annotate`)).data,onSuccess:(s,a)=>{e.invalidateQueries({queryKey:v.detail(a)}),e.invalidateQueries({queryKey:v.all})},onError:e=>{p("Error annotating image:",e instanceof Error?e:new Error(String(e)))}})})(),T=s.useCallback(e=>{l(s=>({...s,...e}))},[]),z=s.useCallback(e=>{x(e)},[]),D=s.useCallback(async e=>{try{const s=await I.mutateAsync(e);t("success",`Generated ${s.annotationCount} annotations`),E()}catch{t("error","Failed to generate annotations")}},[I,t,E]),M=s.useCallback(async e=>{try{await q.mutateAsync(e),t("success","Image deleted successfully"),x(null),y(null),E()}catch{t("error","Failed to delete image")}},[q,t,E]),$=s.useCallback(e=>{l(s=>({...s,page:e}))},[]),F=w?.images||[],R=w?.pagination||{total:0,page:1,pageSize:20,totalPages:0};return e.jsxs("div",{children:[e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Image Gallery",subtitle:`Browse and manage ${R.total} collected images`}),e.jsxs(c,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(r,{variant:"primary",onClick:()=>N(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Upload Images"]})}),e.jsx(S,{species:a,filters:n,onFilterChange:T}),C?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading images..."})]}):0===F.length?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-lg font-medium",children:"No images found"}),e.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your filters or collect some images first."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:F.map(s=>e.jsx(L,{image:s,onView:()=>z(s.id),onAnnotate:()=>D(s.id),onDelete:()=>y(s.id),isDeleting:q.isPending&&j===s.id,isAnnotating:I.isPending},s.id))}),e.jsx(A,{page:R.page,totalPages:R.totalPages,total:R.total,pageSize:R.pageSize,onPageChange:$})]})]})]}),m&&e.jsx(P,{imageId:m,isOpen:!!m,onClose:()=>x(null),onAnnotate:()=>D(m),onDelete:()=>M(m),isAnnotating:I.isPending,isDeleting:q.isPending}),e.jsx(b,{isOpen:!!j,onClose:()=>y(null),title:"Delete Image",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Are you sure you want to delete this image? This will also delete all associated annotations. This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(r,{variant:"secondary",onClick:()=>y(null),children:"Cancel"}),e.jsx(r,{variant:"danger",onClick:()=>j&&M(j),isLoading:q.isPending,children:"Delete"})]})]})}),e.jsx(k,{isOpen:f,onClose:()=>N(!1),species:a,onSuccess:()=>E(),onToast:t})]})},q={all:["image-management"],dashboard:()=>[...q.all,"dashboard"],stats:()=>[...q.all,"stats"],quota:()=>[...q.all,"quota"],jobs:()=>[...q.all,"jobs"],pendingImages:()=>[...q.all,"pending-images"],gallery:(e,s,a)=>[...q.all,"gallery",{page:e,status:s,speciesId:a}]},I=()=>{const e=h(),{data:s,isLoading:a,refetch:t}=g({queryKey:q.dashboard(),queryFn:async()=>{try{return(await i.get("/api/admin/dashboard")).data.data}catch(e){return p("Error fetching dashboard:",e instanceof Error?e:new Error(String(e))),{stats:{totalImages:0,pendingAnnotation:0,annotated:0,failed:0,bySpecies:{}},quota:{unsplash:{remaining:50,limit:50,resetTime:null},anthropic:{remaining:1e3,limit:1e3,resetTime:null}},jobs:[],hasActiveJobs:!1}}},staleTime:3e4,gcTime:3e5}),n=s?.hasActiveJobs||!1,{data:l}=((e=!1)=>g({queryKey:q.jobs(),queryFn:async()=>{try{return(await i.get("/api/admin/jobs")).data.data}catch(e){return p("Error fetching jobs:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:1e4,gcTime:3e5,refetchInterval:!!e&&3e3}))(n),r=n&&l?l:s?.jobs||[],{data:d=[]}=g({queryKey:q.pendingImages(),queryFn:async()=>{try{return(await i.get("/api/admin/images/pending")).data.data}catch(e){return p("Error fetching pending images:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:3e4,gcTime:3e5}),o=(()=>{const e=h();return u({mutationFn:async e=>(await i.post("/api/admin/images/collect",e)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:q.dashboard()}),e.invalidateQueries({queryKey:q.jobs()}),e.invalidateQueries({queryKey:q.stats()}),e.invalidateQueries({queryKey:q.quota()})},onError:e=>{p("Error starting image collection:",e instanceof Error?e:new Error(String(e)))}})})(),c=(()=>{const e=h();return u({mutationFn:async e=>(await i.post("/api/admin/images/annotate",e)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:q.dashboard()}),e.invalidateQueries({queryKey:q.jobs()}),e.invalidateQueries({queryKey:q.stats()}),e.invalidateQueries({queryKey:q.quota()}),e.invalidateQueries({queryKey:q.pendingImages()})},onError:e=>{p("Error starting annotation:",e instanceof Error?e:new Error(String(e)))}})})(),m=(()=>{const e=h();return u({mutationFn:async e=>(await i.post("/api/admin/images/bulk/delete",{imageIds:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:q.all})},onError:e=>{p("Error deleting images:",e instanceof Error?e:new Error(String(e)))}})})(),x=(()=>{const e=h();return u({mutationFn:async e=>(await i.post("/api/admin/images/bulk/annotate",{imageIds:e})).data,onSuccess:()=>{e.invalidateQueries({queryKey:q.dashboard()}),e.invalidateQueries({queryKey:q.jobs()}),e.invalidateQueries({queryKey:q.stats()})},onError:e=>{p("Error starting bulk annotation:",e instanceof Error?e:new Error(String(e)))}})})();return{stats:s?.stats,quota:s?.quota,jobs:r,pendingImages:d,isLoading:a,hasActiveJobs:n,refetchStats:()=>(e.invalidateQueries({queryKey:q.dashboard()}),t()),collectMutation:o,annotateMutation:c,bulkDeleteMutation:m,bulkAnnotateMutation:x}},T=({species:a,selected:t,onChange:n,disabled:l=!1})=>{const[i,r]=s.useState(""),[d,o]=s.useState(!1),c=a.filter(e=>e.englishName?.toLowerCase().includes(i.toLowerCase())||e.spanishName?.toLowerCase().includes(i.toLowerCase())||e.scientificName?.toLowerCase().includes(i.toLowerCase()));return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"border rounded-lg p-3 cursor-pointer "+(l?"bg-gray-100 cursor-not-allowed":"bg-white hover:border-blue-500"),onClick:()=>!l&&o(!d),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:0===t.length?"Select species...":`${t.length} species selected`}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 transition-transform "+(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),t.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.slice(0,5).map(s=>{const t=a.find(e=>e.id===s);return e.jsx(m,{variant:"primary",size:"sm",children:t?.englishName||s},s)}),t.length>5&&e.jsxs(m,{variant:"default",size:"sm",children:["+",t.length-5," more"]})]})]}),d&&!l&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-80 overflow-hidden",children:[e.jsx("div",{className:"p-2 border-b",children:e.jsx("input",{type:"text",placeholder:"Search species...",className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none",value:i,onChange:e=>r(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsxs("div",{className:"p-2 border-b flex gap-2",children:[e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-800",onClick:e=>{e.stopPropagation(),n(c.map(e=>e.id))},children:"Select All"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:e=>{e.stopPropagation(),n([])},children:"Clear All"})]}),e.jsxs("div",{className:"max-h-52 overflow-y-auto",children:[c.map(s=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",onClick:e=>e.stopPropagation(),children:[e.jsx("input",{type:"checkbox",checked:t.includes(s.id),onChange:()=>{return e=s.id,void(t.includes(e)?n(t.filter(s=>s!==e)):n([...t,e]));var e},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("span",{className:"ml-3",children:[e.jsx("span",{className:"font-medium",children:s.englishName}),e.jsx("span",{className:"text-gray-500 text-sm ml-2",children:s.scientificName})]})]},s.id)),0===c.length&&e.jsx("div",{className:"px-3 py-4 text-center text-gray-500",children:"No species found"})]})]})]})},z=({toasts:s,onRemove:a})=>0===s.length?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:s.map(s=>e.jsx(y,{variant:"success"===s.type?"success":"error"===s.type?"danger":"info",onClose:()=>a(s.id),children:s.message},s.id))}),D=({isOpen:s,onClose:a,onConfirm:t,count:n,isDeleting:l})=>s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Delete ",n," image",1!==n?"s":"","?"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"This action cannot be undone. All selected images and their associated annotations will be permanently deleted."})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(r,{variant:"secondary",onClick:a,disabled:l,children:"Cancel"}),e.jsx(r,{variant:"danger",onClick:t,isLoading:l,disabled:l,children:"Delete"})]})]})]}):null,M=({className:s=""})=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${s}`}),$=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 text-center",children:[e.jsx(M,{className:"h-8 w-16 mx-auto mb-2"}),e.jsx(M,{className:"h-4 w-24 mx-auto"})]}),F=()=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx($,{}),e.jsx($,{}),e.jsx($,{}),e.jsx($,{})]}),R=()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-10 w-full"})]}),B=()=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(M,{className:"h-5 w-24"}),e.jsx(M,{className:"h-5 w-16 rounded-full"})]}),e.jsx(M,{className:"h-2 w-full rounded-full mb-2"}),e.jsx(M,{className:"h-4 w-32"})]}),O=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx(M,{className:"h-6 w-1/3 mb-2"}),e.jsx(M,{className:"h-4 w-2/3 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{}),e.jsx(B,{})]})]}),Q=({count:s=8})=>e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:s}).map((s,a)=>e.jsx("div",{className:"aspect-square",children:e.jsx(M,{className:"h-full w-full rounded-lg"})},a))}),K=()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"h-4 w-24"}),e.jsx(M,{className:"h-3 w-full rounded-full"}),e.jsx(M,{className:"h-3 w-32"})]}),U=()=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx(M,{className:"h-6 w-1/3 mb-2"}),e.jsx(M,{className:"h-4 w-2/3 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"h-4 w-40"}),e.jsx(M,{className:"h-10 w-full"}),e.jsx(M,{className:"h-3 w-48"})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t",children:e.jsx(M,{className:"h-10 w-40"})})]}),e.jsx(O,{})]}),W=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx(M,{className:"h-6 w-1/4 mb-2"}),e.jsx(M,{className:"h-4 w-1/3 mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(K,{}),e.jsx(K,{})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx(M,{className:"h-6 w-1/3 mb-2"}),e.jsx(M,{className:"h-4 w-1/2 mb-6"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:8}).map((s,a)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx(M,{className:"h-6 w-8 mx-auto mb-1"}),e.jsx(M,{className:"h-3 w-20 mx-auto"})]},a))})]})]}),H=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{className:"h-10 w-48"}),e.jsx(M,{className:"h-10 w-32"})]}),e.jsx(Q,{count:12}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(M,{className:"h-10 w-24"}),e.jsx(M,{className:"h-10 w-10"}),e.jsx(M,{className:"h-10 w-10"}),e.jsx(M,{className:"h-10 w-10"}),e.jsx(M,{className:"h-10 w-24"})]})]}),V=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx(M,{className:"h-6 w-1/4 mb-2"}),e.jsx(M,{className:"h-4 w-1/3 mb-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-4 pb-3 border-b",children:[e.jsx(M,{className:"h-4 w-16"}),e.jsx(M,{className:"h-4 w-16"}),e.jsx(M,{className:"h-4 w-24"}),e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-4 w-20"})]}),Array.from({length:5}).map((s,a)=>e.jsxs("div",{className:"flex gap-4 py-3 border-b border-gray-100",children:[e.jsx(M,{className:"h-5 w-16 rounded-full"}),e.jsx(M,{className:"h-5 w-16 rounded-full"}),e.jsx(M,{className:"h-3 w-24 rounded-full"}),e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-4 w-20"})]},a))]})]}),G=({activeTab:s})=>{switch(s){case"collection":case"annotation":default:return e.jsx(U,{});case"gallery":return e.jsx(H,{});case"statistics":return e.jsx(W,{});case"history":return e.jsx(V,{})}},J=()=>{const{user:n,loading:i}=t(),{data:g=[],isLoading:h}=l(),{stats:u,quota:p,jobs:b,pendingImages:v,isLoading:f,refetchStats:N,collectMutation:w,annotateMutation:k,bulkDeleteMutation:C}=I(),{toasts:S,addToast:L,removeToast:A}=(()=>{const[e,a]=s.useState([]);return{toasts:e,addToast:s.useCallback((e,s)=>{const t=`toast-${Date.now()}`;a(a=>[...a,{id:t,type:e,message:s}]),setTimeout(()=>{a(e=>e.filter(e=>e.id!==t))},5e3)},[]),removeToast:s.useCallback(e=>{a(s=>s.filter(s=>s.id!==e))},[])}})(),[P,q]=s.useState("collection"),[M,$]=s.useState([]),[F,R]=s.useState(2),[B,O]=s.useState([]),[Q,K]=s.useState(!0),[U,W]=s.useState(!1),[H,V]=s.useState([]);if(i)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})});if(!n)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access image management."}),e.jsx(a,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});const J=h||f;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Image Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Collect bird images and manage AI annotations"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(a,{to:"/admin/annotations",className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"View Annotations"})})]}),e.jsx("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[{key:"collection",label:"Image Collection"},{key:"gallery",label:"Gallery"},{key:"annotation",label:"Batch Annotation"},{key:"statistics",label:"Statistics"},{key:"history",label:"Job History"}].map(s=>e.jsx("button",{onClick:()=>q(s.key),className:"px-4 py-2 font-medium border-b-2 transition-colors "+(P===s.key?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:s.label},s.key))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[J&&e.jsx(G,{activeTab:P}),!J&&e.jsxs(e.Fragment,{children:["collection"===P&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Collect Images",subtitle:"Select species and configure collection parameters"}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bird Species"}),e.jsx(T,{species:g,selected:M,onChange:$,disabled:w.isPending})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images per Species"}),e.jsx("input",{type:"number",min:1,max:10,value:F,onChange:e=>R(parseInt(e.target.value)||2),disabled:w.isPending,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:bg-gray-100"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Recommended: 2-5 images per species"})]}),p&&p.unsplash.remaining<10&&e.jsxs(y,{variant:"warning",title:"Low API Quota",children:["Only ",p.unsplash.remaining," Unsplash requests remaining.",p.unsplash.resetTime&&e.jsxs("span",{children:[" Resets at ",new Date(p.unsplash.resetTime).toLocaleTimeString()]})]})]})}),e.jsx(x,{children:e.jsxs(r,{variant:"primary",onClick:async()=>{if(0!==M.length)try{await w.mutateAsync({speciesIds:M,imagesPerSpecies:F}),L("success",`Started collecting images for ${M.length} species`),$([])}catch{L("error","Failed to start image collection")}else L("error","Please select at least one species")},isLoading:w.isPending,disabled:0===M.length||w.isPending,children:["Collect Images (",M.length," species)"]})})]}),e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Active Jobs",subtitle:"Currently running collection and annotation jobs"}),e.jsx(c,{children:0===b.filter(e=>"running"===e.status||"pending"===e.status).length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{children:"No active jobs"})]}):e.jsx("div",{className:"space-y-4",children:b.filter(e=>"running"===e.status||"pending"===e.status).map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium capitalize",children:s.type}),e.jsx(m,{variant:"running"===s.status?"primary":"warning",dot:!0,children:s.status})]}),e.jsx(j,{value:s.progress,max:s.total,variant:"gradient",color:"primary",showLabel:!0,animated:"running"===s.status}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[s.progress," / ",s.total," completed"]})]},s.id))})})]})]}),"gallery"===P&&e.jsx(E,{species:g,onToast:L}),"annotation"===P&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Start Annotation",subtitle:"Generate AI annotations for bird images"}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",checked:Q,onChange:()=>K(!0),disabled:k.isPending,className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-medium",children:["Annotate all un-annotated images (",u?.pendingAnnotation||0," images)"]})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",checked:!Q,onChange:()=>K(!1),disabled:k.isPending,className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Select specific images"})]})}),!Q&&e.jsx("div",{className:"border rounded-lg p-4 max-h-64 overflow-y-auto",children:0===v.length?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No pending images"}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(s=>e.jsxs("label",{className:"relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all "+(B.includes(s.id)?"border-blue-500 ring-2 ring-blue-200":"border-transparent hover:border-gray-300"),children:[e.jsx("input",{type:"checkbox",checked:B.includes(s.id),onChange:e=>{e.target.checked?O([...B,s.id]):O(B.filter(e=>e!==s.id))},className:"sr-only"}),e.jsx("img",{src:s.url,alt:"Bird",className:"w-full h-20 object-cover"}),B.includes(s.id)&&e.jsx("div",{className:"absolute top-1 right-1 bg-blue-600 rounded-full p-0.5",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},s.id))})}),p&&p.anthropic.remaining<100&&e.jsxs(y,{variant:"warning",title:"Low API Quota",children:["Only ",p.anthropic.remaining," Anthropic requests remaining.",p.anthropic.resetTime&&e.jsxs("span",{children:[" Resets at ",new Date(p.anthropic.resetTime).toLocaleTimeString()]})]})]})}),e.jsx(x,{children:e.jsx(r,{variant:"primary",onClick:async()=>{try{if(Q)await k.mutateAsync({annotateAll:!0}),L("success","Started annotation for all pending images");else{if(0===B.length)return void L("error","Please select at least one image");await k.mutateAsync({imageIds:B}),L("success",`Started annotation for ${B.length} images`),O([])}}catch{L("error","Failed to start annotation")}},isLoading:k.isPending,disabled:k.isPending||!Q&&0===B.length||Q&&0===(u?.pendingAnnotation||0),children:"Start Annotation"})})]}),e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Annotation Progress",subtitle:"Real-time annotation status"}),e.jsx(c,{children:0===b.filter(e=>"annotation"===e.type&&("running"===e.status||"pending"===e.status)).length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),e.jsx("p",{children:"No annotation jobs running"}),e.jsx("p",{className:"text-sm mt-1",children:"Start an annotation job to see progress here"})]}):e.jsx("div",{className:"space-y-4",children:b.filter(e=>"annotation"===e.type&&("running"===e.status||"pending"===e.status)).map(s=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{variant:"running"===s.status?"success":"warning",dot:!0,children:"running"===s.status?"Processing":"Queued"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Started ",new Date(s.startedAt).toLocaleTimeString()]})]}),e.jsx(j,{value:s.progress,max:s.total,variant:"striped",color:"success",size:"lg",showLabel:!0,label:"Annotation Progress",animated:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:s.results?.annotated||0}),e.jsx("div",{className:"text-xs text-green-700",children:"Annotated"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:s.total-s.progress}),e.jsx("div",{className:"text-xs text-yellow-700",children:"Remaining"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.results?.failed||0}),e.jsx("div",{className:"text-xs text-red-700",children:"Failed"})]})]})]},s.id))})})]})]}),"statistics"===P&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(d,{variant:"elevated",padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:u?.totalImages||0}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Total Images"})]})}),e.jsx(d,{variant:"elevated",padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:u?.pendingAnnotation||0}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Pending Annotation"})]})}),e.jsx(d,{variant:"elevated",padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:u?.annotated||0}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Annotated"})]})}),e.jsx(d,{variant:"elevated",padding:"md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:u?.failed||0}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Failed"})]})})]}),e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"API Quota Status",subtitle:"Current usage and limits"}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Unsplash API"}),e.jsx(j,{value:p?.unsplash.remaining||0,max:p?.unsplash.limit||50,variant:"gradient",color:(p?.unsplash.remaining||0)<10?"danger":(p?.unsplash.remaining||0)<25?"warning":"success",showLabel:!0,label:"Requests Remaining"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[p?.unsplash.remaining||0," / ",p?.unsplash.limit||50," requests",p?.unsplash.resetTime&&e.jsxs("span",{className:"ml-2",children:["(Resets: ",new Date(p.unsplash.resetTime).toLocaleString(),")"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Anthropic API"}),e.jsx(j,{value:p?.anthropic.remaining||0,max:p?.anthropic.limit||1e3,variant:"gradient",color:(p?.anthropic.remaining||0)<100?"danger":(p?.anthropic.remaining||0)<500?"warning":"success",showLabel:!0,label:"Tokens Remaining"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[p?.anthropic.remaining||0," / ",p?.anthropic.limit||1e3," requests",p?.anthropic.resetTime&&e.jsxs("span",{className:"ml-2",children:["(Resets: ",new Date(p.anthropic.resetTime).toLocaleString(),")"]})]})]})]})})]}),e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Images by Species",subtitle:"Distribution of collected images"}),e.jsx(c,{children:u?.bySpecies&&Object.keys(u.bySpecies).length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(u.bySpecies).sort(([,e],[,s])=>s-e).slice(0,12).map(([s,a])=>{const t=g.find(e=>e.id===s);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:a}),e.jsx("div",{className:"text-xs text-gray-600 truncate",title:t?.englishName||s,children:t?.englishName||s})]},s)})}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No images collected yet"})})]})]}),"history"===P&&e.jsxs(d,{variant:"elevated",padding:"lg",children:[e.jsx(o,{title:"Job History",subtitle:"Recent collection and annotation jobs"}),e.jsx(c,{children:0===b.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("p",{children:"No jobs yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start collecting or annotating images to see job history"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Progress"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Started"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Completed"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Results"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx(m,{variant:"collection"===s.type?"primary":"info",size:"sm",children:s.type})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(m,{variant:"completed"===s.status?"success":"failed"===s.status?"danger":"running"===s.status?"primary":"warning",dot:!0,size:"sm",children:s.status})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{value:s.progress,max:s.total,size:"sm",color:"failed"===s.status?"danger":"primary",className:"w-24"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.progress,"/",s.total]})]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(s.startedAt).toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:s.completedAt?new Date(s.completedAt).toLocaleString():"-"}),e.jsx("td",{className:"py-3 px-4",children:s.results?e.jsxs("div",{className:"text-sm",children:["collection"===s.type&&e.jsxs("span",{className:"text-green-600",children:[s.results.collected," collected"]}),"annotation"===s.type&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-green-600",children:[s.results.annotated," annotated"]}),s.results.failed&&s.results.failed>0&&e.jsxs("span",{className:"text-red-600 ml-2",children:[s.results.failed," failed"]})]})]}):s.error?e.jsx("span",{className:"text-sm text-red-600",title:s.error,children:"Error"}):"-"})]},s.id))})]})})})]})]})]}),e.jsx(z,{toasts:S,onRemove:A}),e.jsx(D,{isOpen:U,onClose:()=>W(!1),onConfirm:async()=>{try{const e=await C.mutateAsync(H);L("success",e.message),V([]),W(!1),N()}catch{L("error","Failed to delete images")}},count:H.length,isDeleting:C.isPending})]})};export{J as ImageManagementPage,J as default};
