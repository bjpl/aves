import{r as s}from"./react-vendor-BjSJ0Zw_.js";import{o as e}from"./vendor-B4WW6Bjp.js";import{i as n,e as r}from"./index-DR9osLae.js";const t=e("https://ubqnfiwxghkxltluyczd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVicW5maXd4Z2hreGx0bHV5Y3pkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NTA1NTAsImV4cCI6MjA3NTIyNjU1MH0.GNEjJ_ralYnpIeUVnDSpF64WSlPK-Z_69wIdAgwRj0U",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:window.localStorage,storageKey:"aves-auth-token"},db:{schema:"public"},global:{headers:{"X-Client-Info":"aves-frontend@0.1.0"}}}),a=()=>{const[e,a]=s.useState(null),[i,o]=s.useState(null),[u,l]=s.useState(!0),[c,d]=s.useState(null);s.useEffect(()=>{t.auth.getSession().then(({data:{session:s}})=>{o(s),a(s?.user??null),l(!1),s&&n("User session restored",{userId:s.user.id})});const{data:{subscription:s}}=t.auth.onAuthStateChange((s,e)=>{o(e),a(e?.user??null),l(!1),e&&n("Auth state changed",{userId:e.user.id,event:s})});return()=>s.unsubscribe()},[]);return{user:e,session:i,loading:u,error:c,signIn:async(s,e)=>{try{l(!0),d(null);const r=await(async(s,e)=>{const{data:n,error:r}=await t.auth.signInWithPassword({email:s,password:e});if(r)throw new Error(r.message);return n})(s,e);o(r.session),a(r.user),n("User signed in successfully",{userId:r.user?.id})}catch(i){const s=i instanceof Error?i.message:"Failed to sign in";throw d(s),r("Sign in failed",i),i}finally{l(!1)}},signUp:async(s,e,i)=>{try{l(!0),d(null);const r=await(async(s,e,n)=>{const{data:r,error:a}=await t.auth.signUp({email:s,password:e,options:{data:{name:n||s.split("@")[0]}}});if(a)throw new Error(a.message);return r})(s,e,i);o(r.session),a(r.user),n("User signed up successfully",{userId:r.user?.id})}catch(u){const s=u instanceof Error?u.message:"Failed to sign up";throw d(s),r("Sign up failed",u),u}finally{l(!1)}},signOut:async()=>{try{l(!0),d(null),await(async()=>{const{error:s}=await t.auth.signOut();if(s)throw new Error(s.message)})(),o(null),a(null),n("User signed out successfully")}catch(s){const e=s instanceof Error?s.message:"Failed to sign out";throw d(e),r("Sign out failed",s),s}finally{l(!1)}},refreshSession:async()=>{try{l(!0);const{data:{session:s},error:e}=await t.auth.refreshSession();if(e)throw e;o(s),a(s?.user??null)}catch(s){const e=s instanceof Error?s.message:"Failed to refresh session";d(e),r("Session refresh failed",s)}finally{l(!1)}}}};export{a as u};
