import{j as e,r as t,L as s}from"./react-vendor-8XroUam3.js";import{u as a,b as r,c as n,a as i}from"./data-vendor-CmJkK5PS.js";import{s as l,u as o}from"./useSupabaseAuth-DgmidNdA.js";import{i as d,e as c,q as x}from"./index-CLBSgpMz.js";import"./vendor-Dmsy3jl6.js";const m=()=>a({queryKey:["annotations","pending"],queryFn:async()=>{d("Fetching pending annotations from Supabase");const{data:e,error:t}=await l.from("ai_annotation_items").select("*").eq("status","pending").order("created_at",{ascending:!1});if(t)throw c("Failed to fetch pending annotations",new Error(t.message)),new Error(t.message);const s=[...new Set(e?.map(e=>e.image_id)||[])],{data:a,error:r}=await l.from("images").select("id, url").in("id",s);r&&c("Failed to fetch image URLs",new Error(r.message));const n=new Map(a?.map(e=>[e.id,e.url])||[]),i=e?.map(e=>{let t="string"==typeof e.bounding_box?JSON.parse(e.bounding_box):e.bounding_box;t&&void 0!==t.x&&!t.topLeft&&(t={topLeft:{x:t.x,y:t.y},bottomRight:{x:t.x+t.width,y:t.y+t.height},width:t.width,height:t.height});return{id:e.id,imageId:e.image_id,spanishTerm:e.spanish_term,englishTerm:e.english_term,boundingBox:t,type:e.annotation_type,difficultyLevel:e.difficulty_level,pronunciation:e.pronunciation,confidenceScore:parseFloat(e.confidence.toString()),status:e.status,isVisible:"approved"===e.status,createdAt:new Date(e.created_at),updatedAt:new Date(e.created_at),imageUrl:n.get(e.image_id)||""}})||[];return d("Pending annotations fetched with image URLs",{count:i.length}),i}}),g=({variant:t="default",padding:s="md",hover:a=!1,className:r="",children:n,...i})=>{const l=a?"transform hover:scale-105 transition-transform":"";return e.jsx("div",{className:`bg-white rounded-lg overflow-hidden ${{default:"shadow-sm",elevated:"shadow-lg",outlined:"border border-gray-200",interactive:"shadow-md hover:shadow-xl cursor-pointer transition-all"}[t]} ${{none:"",sm:"p-3",md:"p-4",lg:"p-6"}[s]} ${l} ${r}`,...i,children:n})},h=({title:t,subtitle:s,action:a,className:r="",children:n,...i})=>e.jsx("div",{className:`border-b border-gray-100 pb-3 mb-3 ${r}`,...i,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[t&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),s&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s}),n]}),a&&e.jsx("div",{className:"ml-4",children:a})]})}),u=({className:t="",children:s,...a})=>e.jsx("div",{className:`${t}`,...a,children:s}),p=({align:t="right",className:s="",children:a,...r})=>e.jsx("div",{className:`border-t border-gray-100 pt-3 mt-3 flex ${{left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"}[t]} ${s}`,...r,children:a}),b=({variant:t="primary",size:s="md",isLoading:a=!1,fullWidth:r=!1,leftIcon:n,rightIcon:i,children:l,className:o="",disabled:d,...c})=>{const x=r?"w-full":"";return e.jsxs("button",{className:`inline-flex items-center justify-center font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ${{primary:"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:shadow-xl transform hover:scale-105 focus:ring-blue-500",secondary:"bg-white text-gray-800 shadow-lg hover:shadow-xl transform hover:scale-105 focus:ring-gray-300",danger:"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg focus:ring-red-500",success:"bg-green-500 text-white hover:bg-green-600 hover:shadow-lg focus:ring-green-500",warning:"bg-yellow-500 text-yellow-900 hover:bg-yellow-600 hover:shadow-lg focus:ring-yellow-500",outline:"border-2 border-gray-300 text-gray-700 bg-transparent hover:bg-gray-50 focus:ring-gray-300",ghost:"text-gray-700 bg-transparent hover:bg-gray-100 focus:ring-gray-300"}[t]} ${{sm:"px-3 py-1.5 text-sm",md:"px-6 py-2.5 text-base",lg:"px-8 py-4 text-lg"}[s]} ${x} ${o}`,disabled:d||a,...c,children:[a&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!a&&n&&e.jsx("span",{className:"mr-2",children:n}),l,!a&&i&&e.jsx("span",{className:"ml-2",children:i})]})},y=({variant:t="default",size:s="md",rounded:a=!1,outlined:r=!1,dot:n=!1,className:i="",children:l,...o})=>{const d={default:r?"border border-gray-300 text-gray-700 bg-transparent":"bg-gray-100 text-gray-800",primary:r?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-100 text-blue-800",success:r?"border border-green-300 text-green-700 bg-transparent":"bg-green-100 text-green-800",warning:r?"border border-yellow-300 text-yellow-700 bg-transparent":"bg-yellow-100 text-yellow-800",danger:r?"border border-red-300 text-red-700 bg-transparent":"bg-red-100 text-red-800",info:r?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-50 text-blue-700"},c=a?"rounded-full":"rounded";return e.jsxs("span",{className:`inline-flex items-center font-medium transition-colors ${d[t]} ${{sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"}[s]} ${c} ${i}`,...o,children:[n&&e.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${{default:"bg-gray-500",primary:"bg-blue-500",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500",info:"bg-blue-500"}[t]}`}),l]})},v=t.forwardRef(({label:t,error:s,helperText:a,leftIcon:r,rightIcon:n,fullWidth:i=!1,className:l="",disabled:o,...d},c)=>{const x=i?"w-full":"",m=s?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500";return e.jsxs("div",{className:""+(i?"w-full":""),children:[t&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,d.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[r&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:r}),e.jsx("input",{ref:c,className:`block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 ${m} ${x} ${r?"pl-10":""} ${n?"pr-10":""} ${o?"bg-gray-100 cursor-not-allowed":""} ${l}`,disabled:o,"aria-invalid":!!s,"aria-describedby":s?`${d.id}-error`:a?`${d.id}-helper`:void 0,...d}),n&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:n})]}),s&&e.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${d.id}-error`,role:"alert",children:s}),a&&!s&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${d.id}-helper`,children:a})]})});v.displayName="Input";const f=t.forwardRef(({label:t,error:s,helperText:a,fullWidth:r=!1,className:n="",disabled:i,...l},o)=>{const d=r?"w-full":"",c=s?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500";return e.jsxs("div",{className:""+(r?"w-full":""),children:[t&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,l.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("textarea",{ref:o,className:`block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y ${c} ${d} ${i?"bg-gray-100 cursor-not-allowed":""} ${n}`,disabled:i,"aria-invalid":!!s,"aria-describedby":s?`${l.id}-error`:a?`${l.id}-helper`:void 0,...l}),s&&e.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${l.id}-error`,role:"alert",children:s}),a&&!s&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${l.id}-helper`,children:a})]})});f.displayName="TextArea";const j=window.location.hostname.includes("github.io"),w=window.location.pathname.includes("/admin"),N={VITE_API_URL:"https://aves-backend-production.up.railway.app"},S=N?.VITE_API_URL;let C;C=w||!j?S:"";const A=i.create({baseURL:C,timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!1});A.interceptors.request.use(e=>{const t=localStorage.getItem("supabase.auth.token");if(t)try{const s=JSON.parse(t);s?.currentSession?.access_token&&(e.headers.Authorization=`Bearer ${s.currentSession.access_token}`)}catch(s){}return e},e=>Promise.reject(e)),A.interceptors.response.use(e=>e,e=>Promise.reject(e));const T={all:["ai-annotations"],lists:()=>[...T.all,"list"],list:e=>[...T.lists(),e],pending:()=>[...T.all,"pending"],stats:()=>[...T.all,"stats"]},k={NOT_IN_IMAGE:{value:"not_in_image",label:"Feature Not in Image",description:"The identified feature does not exist in this photo",icon:"üö´",severity:"critical",category:"technical"},TOO_SMALL:{value:"too_small",label:"Too Small to See",description:"Feature is too tiny to be useful for learning (<2% of image)",icon:"üî¨",severity:"high",category:"technical"},UNCLEAR_BLURRY:{value:"unclear_blurry",label:"Unclear/Blurry",description:"Cannot distinguish feature clearly due to image quality",icon:"üëì",severity:"high",category:"technical"},OCCLUDED:{value:"occluded",label:"Blocked/Hidden",description:"Feature is partially or fully obstructed from view",icon:"üåø",severity:"medium",category:"technical"},WRONG_IDENTIFICATION:{value:"wrong_id",label:"Misidentified Feature",description:"AI confused one thing for another (e.g., branch as beak)",icon:"‚ùå",severity:"critical",category:"identification"},WRONG_TERM:{value:"wrong_term",label:"Incorrect Spanish/English Term",description:"Translation or terminology is incorrect",icon:"üìö",severity:"high",category:"identification"},DUPLICATE:{value:"duplicate",label:"Duplicate Annotation",description:'Same feature already annotated (e.g., "ala" and "alas")',icon:"üìã",severity:"low",category:"identification"},NOT_REPRESENTATIVE:{value:"not_representative",label:"Not a Representative Example",description:"Feature exists but is atypical, unusual angle, or poor teaching example",icon:"üéì",severity:"high",category:"pedagogical"},CONFUSING_FOR_LEARNERS:{value:"confusing",label:"Potentially Confusing",description:"Could mislead learners due to unusual presentation",icon:"üòï",severity:"medium",category:"pedagogical"},INAPPROPRIATE_DIFFICULTY:{value:"wrong_difficulty",label:"Inappropriate Difficulty Level",description:"Marked as beginner but should be advanced (or vice versa)",icon:"üìä",severity:"low",category:"pedagogical"},BAD_POSITION:{value:"bad_position",label:"Severely Misaligned",description:"Bounding box is >50% off from actual feature location",icon:"üéØ",severity:"high",category:"positioning"},BOX_TOO_LARGE:{value:"box_too_large",label:"Box Includes Too Much",description:"Bounding box captures surrounding area, not just feature",icon:"üìè",severity:"medium",category:"positioning"},BOX_TOO_SMALL:{value:"box_too_small",label:"Box Cuts Off Feature",description:"Bounding box is too tight, cuts off part of feature",icon:"‚úÇÔ∏è",severity:"medium",category:"positioning"},OTHER:{value:"other",label:"Other Issue",description:"Other quality issue not listed above",icon:"ü§î",severity:"low",category:"other"}},L=({annotationLabel:s,onReject:a,onCancel:r})=>{const[n,i]=t.useState(null),[l,o]=t.useState(""),d={technical:Object.values(k).filter(e=>"technical"===e.category),identification:Object.values(k).filter(e=>"identification"===e.category),pedagogical:Object.values(k).filter(e=>"pedagogical"===e.category),positioning:Object.values(k).filter(e=>"positioning"===e.category),other:Object.values(k).filter(e=>"other"===e.category)},c=e=>{switch(e){case"critical":return"bg-red-100 border-red-300 text-red-800";case"high":return"bg-orange-100 border-orange-300 text-orange-800";case"medium":return"bg-yellow-100 border-yellow-300 text-yellow-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"bg-red-600 text-white px-6 py-4 rounded-t-lg",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Reject Annotation: ",s]}),e.jsx("p",{className:"text-sm text-red-100 mt-1",children:"Select the primary issue with this annotation"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üîß"})," Technical Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.technical.map(t=>e.jsx("button",{onClick:()=>i(t.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(n===t.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(t.severity)}`),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]})},t.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ü§ñ"})," AI Identification Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.identification.map(t=>e.jsx("button",{onClick:()=>i(t.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(n===t.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(t.severity)}`),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]})},t.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üéì"})," Educational Quality Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.pedagogical.map(t=>e.jsx("button",{onClick:()=>i(t.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(n===t.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(t.severity)}`),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]})},t.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üéØ"})," Positioning Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.positioning.map(t=>e.jsx("button",{onClick:()=>i(t.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(n===t.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(t.severity)}`),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]})},t.value))})]}),d.other.map(t=>e.jsx("button",{onClick:()=>i(t.value),className:"w-full text-left p-3 rounded-lg border-2 transition-all "+(n===t.value?"border-red-500 bg-red-50 shadow-md":"border-gray-200 hover:border-red-300 hover:bg-red-50 bg-gray-50"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.description})]})]})},t.value)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:l,onChange:e=>o(e.target.value),placeholder:"Any additional context or details about this rejection...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 h-24 resize-none"})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3 border-t",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{n&&a(n,l)},disabled:!n,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-md transition-colors",children:n?"‚úï Confirm Rejection":"Select a Category"})]})]})})},_=({imageUrl:s,initialBox:a,label:r,onSave:n,onCancel:i})=>{const[l,o]=t.useState(a),[d,c]=t.useState(!1),[x,m]=t.useState(null),[g,h]=t.useState({x:0,y:0}),u=t.useRef(null),p=(e,t,s)=>{e.preventDefault(),"drag"===t?c(!0):m(s||null),h({x:e.clientX,y:e.clientY})},b=()=>{c(!1),m(null)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&i()},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-800 text-white px-6 py-4 rounded-t-lg",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Adjust Bounding Box - ",r]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Drag the box to move ‚Ä¢ Drag corners/edges to resize ‚Ä¢ Click Save when done"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{ref:u,className:"relative bg-gray-900 rounded-lg overflow-hidden select-none",style:{paddingTop:"75%"},onMouseMove:e=>{if(!u.current)return;if(!d&&!x)return;const t=u.current.getBoundingClientRect(),s=(e.clientX-g.x)/t.width,a=(e.clientY-g.y)/t.height;if(d){const e=Math.max(0,Math.min(1-l.width,l.topLeft.x+s)),t=Math.max(0,Math.min(1-l.height,l.topLeft.y+a));o({...l,topLeft:{x:e,y:t},bottomRight:{x:e+l.width,y:t+l.height}})}else if(x){let e={...l};if(x.includes("n")){const t=Math.max(0,Math.min(l.bottomRight.y-.05,l.topLeft.y+a));e.topLeft.y=t,e.height=e.bottomRight.y-t}if(x.includes("s")){const t=Math.max(l.topLeft.y+.05,Math.min(1,l.bottomRight.y+a));e.bottomRight.y=t,e.height=t-e.topLeft.y}if(x.includes("w")){const t=Math.max(0,Math.min(l.bottomRight.x-.05,l.topLeft.x+s));e.topLeft.x=t,e.width=e.bottomRight.x-t}if(x.includes("e")){const t=Math.max(l.topLeft.x+.05,Math.min(1,l.bottomRight.x+s));e.bottomRight.x=t,e.width=t-e.topLeft.x}o(e)}h({x:e.clientX,y:e.clientY})},onMouseUp:b,onMouseLeave:b,children:[e.jsx("img",{src:s,alt:r,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain pointer-events-none"}),e.jsxs("div",{className:"absolute border-4 bg-yellow-400 bg-opacity-20 "+(d?"cursor-move border-green-400":"cursor-move border-yellow-400"),style:{left:100*l.topLeft.x+"%",top:100*l.topLeft.y+"%",width:100*l.width+"%",height:100*l.height+"%",boxShadow:d?"0 0 30px rgba(34, 197, 94, 0.8)":"0 0 20px rgba(250, 204, 21, 0.6)"},onMouseDown:e=>p(e,"drag"),children:[e.jsx("div",{className:"absolute -top-10 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:r}),e.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-nw-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","nw")}}),e.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-ne-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","ne")}}),e.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-sw-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","sw")}}),e.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-se-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","se")}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-n-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","n")}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-s-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","s")}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-w-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","w")}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-e-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),p(e,"resize","e")}})]})]}),e.jsxs("div",{className:"mt-4 bg-gray-100 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Current Coordinates (Normalized 0-1)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"X:"})," ",e.jsx("span",{className:"text-blue-600 font-bold",children:l.topLeft.x.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Y:"})," ",e.jsx("span",{className:"text-blue-600 font-bold",children:l.topLeft.y.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"W:"})," ",e.jsx("span",{className:"text-green-600 font-bold",children:l.width.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"H:"})," ",e.jsx("span",{className:"text-green-600 font-bold",children:l.height.toFixed(3)})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3",children:[e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),o(a)},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"‚Ü∫ Reset to Original"}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),i()},className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:e=>{(e=>{e.preventDefault(),e.stopPropagation(),n(l)})(e)},className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-md transition-colors shadow-md",children:"üíæ Save & Apply"})]})]})})};const I=({annotation:s,imageUrl:a,onActionComplete:i,isSelected:l=!1,onSelect:o})=>{const[d,m]=t.useState(!1),[f,j]=t.useState({spanishTerm:s.spanishTerm,englishTerm:s.englishTerm,pronunciation:s.pronunciation||""}),[w,N]=t.useState(""),[S,C]=t.useState(!1),[k,I]=t.useState(!1),[E,R]=t.useState(!1),[D,F]=t.useState(s.boundingBox),z=(()=>{const e=r();return n({mutationFn:async e=>(await A.post(`/api/annotations/ai/${e}/approve`)).data.data,onMutate:async t=>{await e.cancelQueries({queryKey:T.all});const s=e.getQueryData(T.pending());return s&&e.setQueryData(T.pending(),s.filter(e=>e.id!==t)),{previousData:s}},onSuccess:()=>{e.invalidateQueries({queryKey:T.all}),e.invalidateQueries({queryKey:T.stats()}),e.invalidateQueries({queryKey:x.annotations.all})},onError:(t,s,a)=>{a?.previousData&&e.setQueryData(T.pending(),a.previousData),c("Error approving annotation",t instanceof Error?t:new Error(String(t)))}})})(),$=(()=>{const e=r();return n({mutationFn:async({annotationId:e,category:t,notes:s,reason:a})=>(await A.post(`/api/annotations/ai/${e}/reject`,{category:t,notes:s,reason:a})).data.data,onMutate:async({annotationId:t})=>{await e.cancelQueries({queryKey:T.all});const s=e.getQueryData(T.pending());return s&&e.setQueryData(T.pending(),s.filter(e=>e.id!==t)),{previousData:s}},onSuccess:()=>{e.invalidateQueries({queryKey:T.all}),e.invalidateQueries({queryKey:T.stats()})},onError:(t,s,a)=>{a?.previousData&&e.setQueryData(T.pending(),a.previousData),c("Error rejecting annotation",t instanceof Error?t:new Error(String(t)))}})})(),P=(()=>{const e=r();return n({mutationFn:async({annotationId:e,updates:t})=>(await A.post(`/api/annotations/ai/${e}/edit`,t)).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:T.all}),e.invalidateQueries({queryKey:T.stats()}),e.invalidateQueries({queryKey:x.annotations.all})},onError:e=>{c("Error editing annotation",e instanceof Error?e:new Error(String(e)))}})})(),M=(()=>{const e=r();return n({mutationFn:async({annotationId:e,updates:t})=>(await A.patch(`/api/annotations/ai/${e}`,t)).data,onMutate:async({annotationId:t,updates:s})=>{await e.cancelQueries({queryKey:T.all});const a=e.getQueryData(T.pending());return a&&e.setQueryData(T.pending(),a.map(e=>e.id===t?{...e,...s}:e)),{previousData:a}},onError:(t,s,a)=>{a?.previousData&&e.setQueryData(T.pending(),a.previousData),c("Error updating annotation",t instanceof Error?t:new Error(String(t)))},onSuccess:()=>{e.invalidateQueries({queryKey:T.all}),e.invalidateQueries({queryKey:T.stats()})}})})(),q=async()=>{try{await z.mutateAsync(s.id),i?.()}catch(c){}},O=()=>{m(!1),j({spanishTerm:s.spanishTerm,englishTerm:s.englishTerm,pronunciation:s.pronunciation||""})},B=z.isPending||$.isPending||P.isPending||M.isPending;t.useEffect(()=>{const e=e=>{const t=e.target;if(("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)&&"Escape"!==e.key)return;if(B)return;switch(e.key.toLowerCase()){case"a":d||S||k||E||(e.preventDefault(),q());break;case"r":d||S||k||E||(e.preventDefault(),I(!0));break;case"e":d||S||k||E||(e.preventDefault(),m(!0));break;case"f":d||S||k||E||(e.preventDefault(),R(!0));break;case"escape":e.preventDefault(),I(!1),R(!1),C(!1),d&&O()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[d,S,k,E,B]);const Q=()=>{const e=s.boundingBox;return e&&e.width&&e.height?e.width*e.height:0},U=Q()<.02,K=(s.confidenceScore??1)<.7,W=U||K;return e.jsxs(g,{variant:"elevated",className:"mb-4",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-start justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o&&e.jsx("input",{type:"checkbox",checked:l,onChange:e=>o(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",e.jsx("span",{className:"font-medium",children:s.type})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[void 0!==s.confidenceScore&&e.jsxs(y,{variant:(Y=s.confidenceScore,Y?Y>=.8?"success":Y>=.6?"warning":"danger":"default"),size:"sm",children:["Confidence: ",(100*s.confidenceScore).toFixed(1),"%"]}),e.jsxs(y,{variant:"info",size:"sm",children:["Difficulty: ",s.difficultyLevel]}),U&&e.jsxs(y,{variant:"warning",size:"sm",children:["‚ö†Ô∏è Too Small (",(100*Q()).toFixed(1),"%)"]}),K&&e.jsx(y,{variant:"danger",size:"sm",children:"‚ö†Ô∏è Low Confidence"})]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden relative bg-gray-900",children:e.jsxs("div",{className:"relative w-full",style:{paddingTop:"75%"},children:[e.jsx("img",{src:a,alt:s.englishTerm,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain"}),s.boundingBox&&s.boundingBox.topLeft&&e.jsx("div",{className:"absolute border-4 border-yellow-400 bg-yellow-400 bg-opacity-10 pointer-events-none",style:{left:100*s.boundingBox.topLeft.x+"%",top:100*s.boundingBox.topLeft.y+"%",width:100*s.boundingBox.width+"%",height:100*s.boundingBox.height+"%",boxShadow:"inset 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4)"},children:e.jsx("div",{className:"absolute -top-8 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:s.spanishTerm})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:d?"Edit Annotation Data":"Annotation Data"}),d?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),e.jsx(v,{value:f.spanishTerm,onChange:e=>j({...f,spanishTerm:e.target.value}),placeholder:"Spanish term"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),e.jsx(v,{value:f.englishTerm,onChange:e=>j({...f,englishTerm:e.target.value}),placeholder:"English term"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),e.jsx(v,{value:f.pronunciation,onChange:e=>j({...f,pronunciation:e.target.value}),placeholder:"Pronunciation (optional)"})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",e.jsx("span",{className:"text-base text-gray-900",children:s.spanishTerm})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",e.jsx("span",{className:"text-base text-gray-900",children:s.englishTerm})]}),s.pronunciation&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",e.jsx("span",{className:"text-base text-gray-900 font-mono",children:s.pronunciation})]})]}),e.jsxs("div",{className:"rounded-lg p-3 "+(W?"bg-yellow-50 border-2 border-yellow-300":"bg-blue-50"),children:[e.jsx("h5",{className:"text-xs font-semibold mb-2 "+(W?"text-yellow-900":"text-blue-900"),children:"Bounding Box (Normalized 0-1)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs font-mono "+(W?"text-yellow-800":"text-blue-800"),children:[e.jsxs("div",{children:["X: ",s.boundingBox.topLeft.x.toFixed(2),", Y:"," ",s.boundingBox.topLeft.y.toFixed(2)]}),e.jsxs("div",{children:["W: ",s.boundingBox.width.toFixed(2),", H:"," ",s.boundingBox.height.toFixed(2)]})]}),W&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-yellow-300",children:[e.jsx("p",{className:"text-xs text-yellow-900 font-semibold mb-1",children:"üí° Suggested Action:"}),e.jsxs("ul",{className:"text-xs text-yellow-800 space-y-1",children:[U&&e.jsx("li",{children:'‚Ä¢ Consider rejecting: "Too Small (<2% of image)"'}),K&&e.jsx("li",{children:"‚Ä¢ Review carefully: AI confidence below 70%"})]})]})]}),S&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),e.jsx(v,{value:w,onChange:e=>N(e.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"danger",size:"sm",onClick:async()=>{try{await $.mutateAsync({annotationId:s.id,reason:w||void 0}),C(!1),N(""),i?.()}catch(c){}},isLoading:$.isPending,children:"Confirm Rejection"}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>{C(!1),N("")},children:"Cancel"})]})]})]})]})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[e.jsx("div",{className:"flex gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"success",size:"sm",onClick:async()=>{try{await P.mutateAsync({annotationId:s.id,updates:f}),m(!1),i?.()}catch(c){}},isLoading:P.isPending,disabled:B,children:"Save & Approve"}),e.jsx(b,{variant:"ghost",size:"sm",onClick:O,disabled:B,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"success",size:"sm",onClick:q,isLoading:z.isPending,disabled:B,children:"Approve (A)"}),e.jsx(b,{variant:"secondary",size:"sm",onClick:()=>m(!0),disabled:B,children:"Edit (E)"})]})}),!d&&!S&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"warning",size:"sm",onClick:()=>R(!0),disabled:B,children:"üéØ Fix Position (F)"}),e.jsx(b,{variant:"danger",size:"sm",onClick:()=>I(!0),disabled:B,children:"Reject (R)"})]})]})}),(z.isSuccess||$.isSuccess||P.isSuccess)&&e.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:e.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:e.jsxs("span",{className:"text-green-600 font-semibold",children:[z.isSuccess&&"Approved!",$.isSuccess&&"Rejected!",P.isSuccess&&"Updated!"]})})}),k&&e.jsx(L,{annotationLabel:`${s.spanishTerm} (${s.englishTerm})`,onReject:async(e,t)=>{try{await $.mutateAsync({annotationId:s.id,category:e,notes:t}),I(!1),i?.()}catch(c){}},onCancel:()=>I(!1)}),E&&e.jsx(_,{imageUrl:a,initialBox:(X=s.boundingBox,"topLeft"in X?X:{topLeft:{x:X.x,y:X.y},bottomRight:{x:X.x+X.width,y:X.y+X.height},width:X.width,height:X.height}),label:s.spanishTerm,onSave:async e=>{try{const t=function(e){if("x"in e&&!("topLeft"in e))return e;const t=e;return{x:t.topLeft.x,y:t.topLeft.y,width:t.width,height:t.height}}(e);await M.mutateAsync({annotationId:s.id,updates:{boundingBox:t}});F(e),R(!1),i?.()}catch(c){}},onCancel:()=>R(!1)})]});var X,Y},E={all:["annotation-analytics"],analytics:()=>[...E.all,"data"]},R=()=>a({queryKey:E.analytics(),queryFn:async()=>{try{return(await A.get("/api/annotations/analytics")).data}catch(e){return c("Error fetching annotation analytics:",e instanceof Error?e:new Error(String(e))),{overview:{total:0,pending:0,approved:0,rejected:0,avgConfidence:"0.00"},bySpecies:{},byType:{},rejectionsByCategory:{},qualityFlags:{tooSmall:0,lowConfidence:0}}}},staleTime:12e4,gcTime:6e5,retry:2}),D=({targetCount:t=400})=>{const{data:s,isLoading:a,error:r}=R();if(a)return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})});if(r||!s)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-red-800 font-semibold mb-2",children:"Failed to load analytics"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Please check your connection and try again."})]});const n=((e,t=400)=>Math.min(100,Math.round(e/t*100)))(s.overview.total,t),i=s.qualityFlags.tooSmall+s.qualityFlags.lowConfidence;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Annotation Analytics"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dataset quality and review progress metrics"})]}),e.jsxs(y,{variant:"info",size:"lg",children:[s.overview.total," Total Annotations"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(g,{variant:"elevated",children:e.jsx(u,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Pending Review"}),e.jsx("p",{className:"text-4xl font-bold text-yellow-600",children:s.overview.pending}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.pending/s.overview.total*100).toFixed(1),"% of total"]})]})})}),e.jsx(g,{variant:"elevated",children:e.jsx(u,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Approved"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:s.overview.approved}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.approved/s.overview.total*100).toFixed(1),"% of total"]})]})})}),e.jsx(g,{variant:"elevated",children:e.jsx(u,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Rejected"}),e.jsx("p",{className:"text-4xl font-bold text-red-600",children:s.overview.rejected}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.rejected/s.overview.total*100).toFixed(1),"% of total"]})]})})}),e.jsx(g,{variant:"elevated",children:e.jsx(u,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Avg Confidence"}),e.jsxs("p",{className:"text-4xl font-bold text-blue-600",children:[(100*parseFloat(s.overview.avgConfidence)).toFixed(0),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[parseFloat(s.overview.avgConfidence)>=.8?"High":"Medium"," quality"]})]})})})]}),e.jsxs(g,{variant:"elevated",children:[e.jsx(h,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Dataset Progress"})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[s.overview.total," / ",t," annotations"]}),e.jsxs("span",{className:"font-bold text-blue-600",children:[n,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-500 ease-out",style:{width:`${n}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600",children:[t-s.overview.total," more annotations needed for MVP dataset"]})]})})]}),i>0&&e.jsxs(g,{variant:"elevated",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quality Flags"}),e.jsxs(y,{variant:"warning",size:"sm",children:[i," Issues Detected"]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.qualityFlags.tooSmall>0&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"‚ö†Ô∏è Too Small (<2%)"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Bounding boxes covering less than 2% of image area"})]}),e.jsx("span",{className:"text-2xl font-bold text-yellow-600",children:s.qualityFlags.tooSmall})]}),e.jsx("p",{className:"text-xs text-yellow-800 mt-2",children:"üí° Suggestion: Consider rejecting or requesting better images"})]}),s.qualityFlags.lowConfidence>0&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"‚ö†Ô∏è Low Confidence (<70%)"}),e.jsx("p",{className:"text-xs text-red-700",children:"AI confidence score below recommended threshold"})]}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:s.qualityFlags.lowConfidence})]}),e.jsx("p",{className:"text-xs text-red-800 mt-2",children:"üí° Suggestion: Review carefully before approving"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(g,{variant:"elevated",children:[e.jsx(h,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Species Coverage"})}),e.jsx(u,{children:Object.keys(s.bySpecies).length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Object.entries(s.bySpecies).sort(([,e],[,t])=>t-e).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t}),e.jsxs(y,{variant:"info",size:"sm",children:[s," annotations"]})]},t))}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No species data available"})})]}),e.jsxs(g,{variant:"elevated",children:[e.jsx(h,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Annotation Types"})}),e.jsx(u,{children:Object.keys(s.byType).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(s.byType).sort(([,e],[,t])=>t-e).map(([t,a])=>{const r=a/s.overview.pending*100;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:t}),e.jsxs("span",{className:"text-gray-600",children:[a," (",r.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${r}%`}})})]},t)})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No type distribution data available"})})]})]}),Object.keys(s.rejectionsByCategory).length>0&&e.jsxs(g,{variant:"elevated",children:[e.jsx(h,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rejection Categories"})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.entries(s.rejectionsByCategory).sort(([,e],[,t])=>t-e).map(([t,s])=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-red-900",children:t.replace(/_/g," ")}),e.jsx(y,{variant:"danger",size:"sm",children:s})]})},t))})})]})]})},F=()=>{const{user:a,loading:i}=o(),{data:c,isLoading:x,error:g,refetch:h}=m(),u=(()=>{const e=r();return n({mutationFn:async({annotationId:e,notes:t})=>{const{data:s,error:a}=await l.from("ai_annotation_items").update({status:"approved"}).eq("id",e).select().single();if(a)throw new Error(a.message);return t&&await l.from("ai_annotation_reviews").insert({annotation_id:e,action:"approved",notes:t}),s},onSuccess:()=>{e.invalidateQueries({queryKey:["annotations"]}),d("Annotation approved successfully")}})})(),p=(()=>{const e=r();return n({mutationFn:async({annotationId:e,reason:t})=>{const{data:s,error:a}=await l.from("ai_annotation_items").update({status:"rejected"}).eq("id",e).select().single();if(a)throw new Error(a.message);return await l.from("ai_annotation_reviews").insert({annotation_id:e,action:"rejected",notes:t}),s},onSuccess:()=>{e.invalidateQueries({queryKey:["annotations"]}),d("Annotation rejected")}})})(),b=(()=>{const e=r();return n({mutationFn:async({annotationId:e,updates:t})=>{const{data:s,error:a}=await l.from("ai_annotation_items").update({...t,status:"edited"}).eq("id",e).select().single();if(a)throw new Error(a.message);return s},onSuccess:()=>{e.invalidateQueries({queryKey:["annotations"]}),d("Annotation edited successfully")}})})(),[y,v]=t.useState("pending"),[f,j]=t.useState("newest"),[w,N]=t.useState(new Set),[S,C]=t.useState("review");if(i||x)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})});if(!a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),e.jsx(s,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});if(g)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),e.jsx("p",{className:"text-gray-600 mb-4",children:g.message}),e.jsx("button",{onClick:()=>h(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})});const A=c||[],T=A.filter(e=>"pending"===e.status).length,k=A.filter(e=>"approved"===e.status).length,L=async(e,t)=>{try{await u.mutateAsync({annotationId:e,notes:t}),h()}catch(s){}},_=async(e,t)=>{try{await p.mutateAsync({annotationId:e,reason:t}),h()}catch(s){}},E=async(e,t)=>{try{await b.mutateAsync({annotationId:e,updates:t}),h()}catch(s){}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),e.jsxs("div",{className:"flex gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:T}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:k}),e.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:A.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>C("review"),className:"px-4 py-2 font-medium border-b-2 transition-colors "+("review"===S?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:"Review Annotations"}),e.jsx("button",{onClick:()=>C("analytics"),className:"px-4 py-2 font-medium border-b-2 transition-colors "+("analytics"===S?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:"üìä Analytics Dashboard"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:"analytics"===S?e.jsx(D,{targetCount:400}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>v("pending"),className:"px-4 py-2 rounded-md font-medium "+("pending"===y?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Pending (",T,")"]}),e.jsxs("button",{onClick:()=>v("all"),className:"px-4 py-2 rounded-md font-medium "+("all"===y?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All (",A.length,")"]})]}),w.size>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[w.size," selected"]}),e.jsx("button",{onClick:async()=>{const e=`Approve ${w.size} annotations?`;if(window.confirm(e)){for(const e of w)await L(e);N(new Set)}},className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md",children:"Bulk Approve"}),e.jsx("button",{onClick:()=>N(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),0===A.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üéâ"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),e.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:A.map(t=>e.jsx(I,{annotation:t,imageUrl:t.imageUrl||"",onApprove:L,onReject:_,onEdit:E},t.id))})]})})]})};export{F as AdminAnnotationReviewPage,F as default};
