import{r as e,j as t,e as s,L as a}from"./react-vendor-BjSJ0Zw_.js";import{u as r,a as i,b as n}from"./data-vendor-Co-Mk0hz.js";import{e as l,q as o}from"./index-DR9osLae.js";import{a as d,C as c,b as x,B as m,c as g,d as h,T as u}from"./Tooltip-BDDCW5yJ.js";import{B as p,u as b,T as y}from"./ToastContainer-kmbyk56n.js";import{u as v}from"./useSupabaseAuth-D05WyEDk.js";import"./vendor-B4WW6Bjp.js";const j={all:["ai-annotations"],lists:()=>[...j.all,"list"],list:e=>[...j.lists(),e],pending:()=>[...j.all,"pending"],stats:()=>[...j.all,"stats"]},f=()=>r({queryKey:j.pending(),queryFn:async()=>{try{return(await d.get("/api/ai/annotations/pending")).data.annotations}catch(e){return l("Error fetching pending AI annotations:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:6e4,gcTime:18e4,placeholderData:[]}),N=()=>r({queryKey:j.stats(),queryFn:async()=>{try{return(await d.get("/api/ai/annotations/stats")).data.data}catch(e){return console.error("‚ùå STATS QUERY: Error fetching stats:",e),l("Error fetching AI annotation stats:",e instanceof Error?e:new Error(String(e))),{total:0,pending:0,approved:0,rejected:0,avgConfidence:0}}},staleTime:3e5,gcTime:6e5}),w=e.forwardRef(({label:e,error:s,helperText:a,leftIcon:r,rightIcon:i,fullWidth:n=!1,className:l="",disabled:o,...d},c)=>{const x=n?"w-full":"",m=s?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500";return t.jsxs("div",{className:""+(n?"w-full":""),children:[e&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e,d.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[r&&t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:r}),t.jsx("input",{ref:c,className:`block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 ${m} ${x} ${r?"pl-10":""} ${i?"pr-10":""} ${o?"bg-gray-100 cursor-not-allowed":""} ${l}`,disabled:o,"aria-invalid":!!s,"aria-describedby":s?`${d.id}-error`:a?`${d.id}-helper`:void 0,...d}),i&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:i})]}),s&&t.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${d.id}-error`,role:"alert",children:s}),a&&!s&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${d.id}-helper`,children:a})]})});w.displayName="Input";const C=e.forwardRef(({label:e,error:s,helperText:a,fullWidth:r=!1,className:i="",disabled:n,...l},o)=>{const d=r?"w-full":"",c=s?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500";return t.jsxs("div",{className:""+(r?"w-full":""),children:[e&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e,l.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("textarea",{ref:o,className:`block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y ${c} ${d} ${n?"bg-gray-100 cursor-not-allowed":""} ${i}`,disabled:n,"aria-invalid":!!s,"aria-describedby":s?`${l.id}-error`:a?`${l.id}-helper`:void 0,...l}),s&&t.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${l.id}-error`,role:"alert",children:s}),a&&!s&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${l.id}-helper`,children:a})]})});C.displayName="TextArea";const S={NOT_IN_IMAGE:{value:"not_in_image",label:"Feature Not in Image",description:"The identified feature does not exist in this photo",icon:"üö´",severity:"critical",category:"technical"},TOO_SMALL:{value:"too_small",label:"Too Small to See",description:"Feature is too tiny to be useful for learning (<2% of image)",icon:"üî¨",severity:"high",category:"technical"},UNCLEAR_BLURRY:{value:"unclear_blurry",label:"Unclear/Blurry",description:"Cannot distinguish feature clearly due to image quality",icon:"üëì",severity:"high",category:"technical"},OCCLUDED:{value:"occluded",label:"Blocked/Hidden",description:"Feature is partially or fully obstructed from view",icon:"üåø",severity:"medium",category:"technical"},WRONG_IDENTIFICATION:{value:"wrong_id",label:"Misidentified Feature",description:"AI confused one thing for another (e.g., branch as beak)",icon:"‚ùå",severity:"critical",category:"identification"},WRONG_TERM:{value:"wrong_term",label:"Incorrect Spanish/English Term",description:"Translation or terminology is incorrect",icon:"üìö",severity:"high",category:"identification"},DUPLICATE:{value:"duplicate",label:"Duplicate Annotation",description:'Same feature already annotated (e.g., "ala" and "alas")',icon:"üìã",severity:"low",category:"identification"},NOT_REPRESENTATIVE:{value:"not_representative",label:"Not a Representative Example",description:"Feature exists but is atypical, unusual angle, or poor teaching example",icon:"üéì",severity:"high",category:"pedagogical"},CONFUSING_FOR_LEARNERS:{value:"confusing",label:"Potentially Confusing",description:"Could mislead learners due to unusual presentation",icon:"üòï",severity:"medium",category:"pedagogical"},INAPPROPRIATE_DIFFICULTY:{value:"wrong_difficulty",label:"Inappropriate Difficulty Level",description:"Marked as beginner but should be advanced (or vice versa)",icon:"üìä",severity:"low",category:"pedagogical"},BAD_POSITION:{value:"bad_position",label:"Severely Misaligned",description:"Bounding box is >50% off from actual feature location",icon:"üéØ",severity:"high",category:"positioning"},BOX_TOO_LARGE:{value:"box_too_large",label:"Box Includes Too Much",description:"Bounding box captures surrounding area, not just feature",icon:"üìè",severity:"medium",category:"positioning"},BOX_TOO_SMALL:{value:"box_too_small",label:"Box Cuts Off Feature",description:"Bounding box is too tight, cuts off part of feature",icon:"‚úÇÔ∏è",severity:"medium",category:"positioning"},OTHER:{value:"other",label:"Other Issue",description:"Other quality issue not listed above",icon:"ü§î",severity:"low",category:"other"}},T=({annotationLabel:s,onReject:a,onCancel:r})=>{const[i,n]=e.useState(null),[l,o]=e.useState(""),d={technical:Object.values(S).filter(e=>"technical"===e.category),identification:Object.values(S).filter(e=>"identification"===e.category),pedagogical:Object.values(S).filter(e=>"pedagogical"===e.category),positioning:Object.values(S).filter(e=>"positioning"===e.category),other:Object.values(S).filter(e=>"other"===e.category)},c=e=>{switch(e){case"critical":return"bg-red-100 border-red-300 text-red-800";case"high":return"bg-orange-100 border-orange-300 text-orange-800";case"medium":return"bg-yellow-100 border-yellow-300 text-yellow-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-auto",children:[t.jsxs("div",{className:"bg-red-600 text-white px-6 py-4 rounded-t-lg",children:[t.jsxs("h3",{className:"text-xl font-bold",children:["Reject Annotation: ",s]}),t.jsx("p",{className:"text-sm text-red-100 mt-1",children:"Select the primary issue with this annotation"})]}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"text-lg",children:"üîß"})," Technical Issues"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.technical.map(e=>t.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"text-lg",children:"ü§ñ"})," AI Identification Issues"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.identification.map(e=>t.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"text-lg",children:"üéì"})," Educational Quality Issues"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.pedagogical.map(e=>t.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"text-lg",children:"üéØ"})," Positioning Issues"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.positioning.map(e=>t.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),d.other.map(e=>t.jsx("button",{onClick:()=>n(e.value),className:"w-full text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":"border-gray-200 hover:border-red-300 hover:bg-red-50 bg-gray-50"),children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value)),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes (Optional)"}),t.jsx("textarea",{value:l,onChange:e=>o(e.target.value),placeholder:"Any additional context or details about this rejection...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 h-24 resize-none"})]})]}),t.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3 border-t",children:[t.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),t.jsx("button",{onClick:()=>{i&&a(i,l)},disabled:!i,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-md transition-colors",children:i?"‚úï Confirm Rejection":"Select a Category"})]})]})})},A=({imageUrl:s,initialBox:a,label:r,onSave:i,onCancel:n})=>{const[l,o]=e.useState({...a,shape:a.shape||"rectangle"}),[d,c]=e.useState(!1),[x,m]=e.useState(null),[g,h]=e.useState({x:0,y:0}),u=e.useRef(null),p=e=>{o(t=>({...t,shape:e}))},b=(e,t,s)=>{e.preventDefault(),"drag"===t?c(!0):m(s||null),h({x:e.clientX,y:e.clientY})},y=()=>{c(!1),m(null)};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&n()},children:t.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"bg-gray-800 text-white px-6 py-4 rounded-t-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-xl font-bold",children:["Adjust Bounding Box - ",r]}),t.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Drag the box to move ‚Ä¢ Drag corners/edges to resize ‚Ä¢ Click Save when done"})]}),t.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg p-1",children:[t.jsxs("button",{type:"button",onClick:()=>p("rectangle"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2 "+("rectangle"===l.shape?"bg-yellow-500 text-yellow-900":"text-gray-300 hover:bg-gray-600"),title:"Rectangle shape",children:[t.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})}),"Rectangle"]}),t.jsxs("button",{type:"button",onClick:()=>p("ellipse"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2 "+("ellipse"===l.shape?"bg-yellow-500 text-yellow-900":"text-gray-300 hover:bg-gray-600"),title:"Ellipse/Circle shape",children:[t.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("ellipse",{cx:"12",cy:"12",rx:"10",ry:"8"})}),"Ellipse"]})]})]})}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{ref:u,className:"relative bg-gray-900 rounded-lg overflow-hidden select-none",style:{paddingTop:"75%"},onMouseMove:e=>{if(!u.current)return;if(!d&&!x)return;const t=u.current.getBoundingClientRect(),s=(e.clientX-g.x)/t.width,a=(e.clientY-g.y)/t.height;if(d){const e=Math.max(0,Math.min(1-l.width,l.x+s)),t=Math.max(0,Math.min(1-l.height,l.y+a));o({...l,x:e,y:t})}else if(x){let e={...l};if(x.includes("n")){const t=Math.max(0,Math.min(l.y+l.height-.05,l.y+a)),s=l.y-t;e.y=t,e.height+=s}if(x.includes("s")){const t=Math.max(.05,Math.min(1-l.y,l.height+a));e.height=t}if(x.includes("w")){const t=Math.max(0,Math.min(l.x+l.width-.05,l.x+s)),a=l.x-t;e.x=t,e.width+=a}if(x.includes("e")){const t=Math.max(.05,Math.min(1-l.x,l.width+s));e.width=t}o(e)}h({x:e.clientX,y:e.clientY})},onMouseUp:y,onMouseLeave:y,children:[t.jsx("img",{src:s,alt:r,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain pointer-events-none"}),t.jsxs("div",{className:"absolute cursor-move",style:{left:100*l.x+"%",top:100*l.y+"%",width:100*l.width+"%",height:100*l.height+"%",borderRadius:"ellipse"===l.shape?"50%":"0",border:"4px solid "+(d?"#22c55e":"#facc15"),backgroundColor:"rgba(250, 204, 21, 0.2)",boxShadow:d?"0 0 30px rgba(34, 197, 94, 0.8)":"0 0 20px rgba(250, 204, 21, 0.6)"},onMouseDown:e=>b(e,"drag"),children:[t.jsx("div",{className:"absolute -top-10 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:r}),t.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-nw-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","nw")}}),t.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-ne-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","ne")}}),t.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-sw-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","sw")}}),t.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-se-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","se")}}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-n-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","n")}}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-s-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","s")}}),t.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-w-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","w")}}),t.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-e-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","e")}})]})]}),t.jsxs("div",{className:"mt-4 bg-gray-100 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Current Coordinates (Normalized 0-1)"}),t.jsxs("div",{className:"grid grid-cols-5 gap-4 text-sm font-mono",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"X:"})," ",t.jsx("span",{className:"text-blue-600 font-bold",children:l.x.toFixed(3)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Y:"})," ",t.jsx("span",{className:"text-blue-600 font-bold",children:l.y.toFixed(3)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"W:"})," ",t.jsx("span",{className:"text-green-600 font-bold",children:l.width.toFixed(3)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"H:"})," ",t.jsx("span",{className:"text-green-600 font-bold",children:l.height.toFixed(3)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Shape:"})," ",t.jsx("span",{className:"text-purple-600 font-bold capitalize",children:l.shape})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3",children:[t.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),o(a)},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"‚Ü∫ Reset to Original"}),t.jsx("div",{className:"flex-1"}),t.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),n()},className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),t.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),i(l)},className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-md transition-colors shadow-md",children:"üíæ Save & Apply"})]})]})})},k=({annotation:s,imageUrl:a,onActionComplete:r,isSelected:u=!1,onSelect:b,onToast:y})=>{const[v,f]=e.useState(!1),[N,C]=e.useState({spanishTerm:s.spanishTerm,englishTerm:s.englishTerm,pronunciation:s.pronunciation||""}),[S,k]=e.useState(""),[E,D]=e.useState(!1),[F,P]=e.useState(!1),[I,R]=e.useState(!1),[O,z]=e.useState(s.boundingBox),M=(()=>{const e=i();return n({mutationFn:async e=>{try{return(await d.post(`/api/ai/annotations/${e}/approve`)).data.data}catch(l){throw console.error("‚ùå APPROVE MUTATION: Request failed!",{error:l,status:l.response?.status,data:l.response?.data,message:l.message}),l}},onMutate:async t=>{await e.cancelQueries({queryKey:j.all});const s=e.getQueryData(j.pending());if(s){const a=s.filter(e=>e.id!==t);e.setQueryData(j.pending(),a)}return{previousData:s}},onSuccess:async(t,s)=>{await Promise.all([e.invalidateQueries({queryKey:j.all,refetchType:"active"}),e.invalidateQueries({queryKey:j.stats(),refetchType:"active"}),e.invalidateQueries({queryKey:o.annotations.all})]),await e.refetchQueries({queryKey:j.pending(),type:"active"})},onError:(t,s,a)=>{console.error("‚ùå APPROVE MUTATION: onError called!",{err:t,annotationId:s,hasContext:!!a,hasPreviousData:!!a?.previousData}),a?.previousData&&e.setQueryData(j.pending(),a.previousData),l("Error approving annotation",t instanceof Error?t:new Error(String(t)))}})})(),B=(()=>{const e=i();return n({mutationFn:async({annotationId:e,category:t,notes:s,reason:a})=>(await d.post(`/api/ai/annotations/${e}/reject`,{category:t,notes:s,reason:a})).data.data,onMutate:async({annotationId:t})=>{await e.cancelQueries({queryKey:j.all});const s=e.getQueryData(j.pending());return s&&e.setQueryData(j.pending(),s.filter(e=>e.id!==t)),{previousData:s}},onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:j.all,refetchType:"active"}),e.invalidateQueries({queryKey:j.stats(),refetchType:"active"})]),await e.refetchQueries({queryKey:j.pending(),type:"active"})},onError:(t,s,a)=>{a?.previousData&&e.setQueryData(j.pending(),a.previousData),l("Error rejecting annotation",t instanceof Error?t:new Error(String(t)))}})})(),q=(()=>{const e=i();return n({mutationFn:async({annotationId:e,updates:t})=>(await d.post(`/api/ai/annotations/${e}/edit`,t)).data.data,onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:j.all,refetchType:"active"}),e.invalidateQueries({queryKey:j.stats(),refetchType:"active"}),e.invalidateQueries({queryKey:o.annotations.all})]),await e.refetchQueries({queryKey:j.pending(),type:"active"})},onError:e=>{l("Error editing annotation",e instanceof Error?e:new Error(String(e)))}})})(),L=(()=>{const e=i();return n({mutationFn:async({annotationId:e,updates:t})=>(await d.patch(`/api/ai/annotations/${e}`,t)).data,onMutate:async({annotationId:t,updates:s})=>{await e.cancelQueries({queryKey:j.all});const a=e.getQueryData(j.pending());return a&&e.setQueryData(j.pending(),a.map(e=>e.id===t?{...e,...s}:e)),{previousData:a}},onError:(t,s,a)=>{a?.previousData&&e.setQueryData(j.pending(),a.previousData),l("Error updating annotation",t instanceof Error?t:new Error(String(t)))},onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:j.all,refetchType:"active"}),e.invalidateQueries({queryKey:j.stats(),refetchType:"active"})]),await e.refetchQueries({queryKey:j.pending(),type:"active"})}})})(),$=async()=>{try{await M.mutateAsync(s.id),r?.()}catch(l){}},Q=()=>{f(!1),C({spanishTerm:s.spanishTerm,englishTerm:s.englishTerm,pronunciation:s.pronunciation||""})},_=M.isPending||B.isPending||q.isPending||L.isPending;e.useEffect(()=>{const e=e=>{const t=e.target;if(("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)&&"Escape"!==e.key)return;if(_)return;switch(e.key.toLowerCase()){case"a":v||E||F||I||(e.preventDefault(),$());break;case"r":v||E||F||I||(e.preventDefault(),P(!0));break;case"e":v||E||F||I||(e.preventDefault(),f(!0));break;case"f":v||E||F||I||(e.preventDefault(),R(!0));break;case"escape":e.preventDefault(),P(!1),R(!1),D(!1),v&&Q()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[v,E,F,I,_]);const K=()=>{const e=s.boundingBox;return e&&e.width&&e.height?e.width*e.height:0},U=K()<.02,H=(s.confidenceScore??1)<.7,W=U||H;return t.jsxs(c,{variant:"elevated",className:"mb-4",children:[t.jsx(x,{children:t.jsxs("div",{className:"flex items-start justify-between w-full",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[b&&t.jsx("input",{type:"checkbox",checked:u,onChange:e=>b(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",t.jsx("span",{className:"font-medium",children:s.type})]})]})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[void 0!==s.confidenceScore&&t.jsxs(m,{variant:(X=s.confidenceScore,X?X>=.8?"success":X>=.6?"warning":"danger":"default"),size:"sm",children:["Confidence: ",(100*s.confidenceScore).toFixed(1),"%"]}),t.jsxs(m,{variant:"info",size:"sm",children:["Difficulty: ",s.difficultyLevel]}),U&&t.jsxs(m,{variant:"warning",size:"sm",children:["‚ö†Ô∏è Too Small (",(100*K()).toFixed(1),"%)"]}),H&&t.jsx(m,{variant:"danger",size:"sm",children:"‚ö†Ô∏è Low Confidence"})]})]})}),t.jsx(g,{children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),t.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden relative bg-gray-900",children:t.jsxs("div",{className:"relative w-full",style:{paddingTop:"75%"},children:[t.jsx("img",{src:a,alt:s.englishTerm,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain"}),s.boundingBox&&t.jsx("div",{className:"absolute border-4 border-yellow-400 bg-yellow-400 bg-opacity-10 pointer-events-none",style:{left:100*s.boundingBox.x+"%",top:100*s.boundingBox.y+"%",width:100*s.boundingBox.width+"%",height:100*s.boundingBox.height+"%",boxShadow:"inset 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4)"},children:t.jsx("div",{className:"absolute -top-8 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:s.spanishTerm})})]})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:v?"Edit Annotation Data":"Annotation Data"}),v?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),t.jsx(w,{value:N.spanishTerm,onChange:e=>C({...N,spanishTerm:e.target.value}),placeholder:"Spanish term"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),t.jsx(w,{value:N.englishTerm,onChange:e=>C({...N,englishTerm:e.target.value}),placeholder:"English term"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),t.jsx(w,{value:N.pronunciation,onChange:e=>C({...N,pronunciation:e.target.value}),placeholder:"Pronunciation (optional)"})]})]}):t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",t.jsx("span",{className:"text-base text-gray-900",children:s.spanishTerm})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",t.jsx("span",{className:"text-base text-gray-900",children:s.englishTerm})]}),s.pronunciation&&t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",t.jsx("span",{className:"text-base text-gray-900 font-mono",children:s.pronunciation})]})]}),s.boundingBox?t.jsxs("div",{className:"rounded-lg p-3 "+(W?"bg-yellow-50 border-2 border-yellow-300":"bg-blue-50"),children:[t.jsx("h5",{className:"text-xs font-semibold mb-2 "+(W?"text-yellow-900":"text-blue-900"),children:"Bounding Box (Normalized 0-1)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs font-mono "+(W?"text-yellow-800":"text-blue-800"),children:[t.jsxs("div",{children:["X: ",s.boundingBox.x.toFixed(2),", Y:"," ",s.boundingBox.y.toFixed(2)]}),t.jsxs("div",{children:["W: ",s.boundingBox.width.toFixed(2),", H:"," ",s.boundingBox.height.toFixed(2)]})]}),W&&t.jsxs("div",{className:"mt-2 pt-2 border-t border-yellow-300",children:[t.jsx("p",{className:"text-xs text-yellow-900 font-semibold mb-1",children:"üí° Suggested Action:"}),t.jsxs("ul",{className:"text-xs text-yellow-800 space-y-1",children:[U&&t.jsx("li",{children:'‚Ä¢ Consider rejecting: "Too Small (<2% of image)"'}),H&&t.jsx("li",{children:"‚Ä¢ Review carefully: AI confidence below 70%"})]})]})]}):t.jsxs("div",{className:"rounded-lg p-3 bg-red-50 border-2 border-red-300",children:[t.jsx("h5",{className:"text-xs font-semibold mb-2 text-red-900",children:"‚ö†Ô∏è Missing Bounding Box"}),t.jsx("p",{className:"text-xs text-red-800",children:'This annotation is missing bounding box data. It should be rejected or have a bounding box added via "Fix Position".'})]}),E&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),t.jsx(w,{value:S,onChange:e=>k(e.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(p,{variant:"danger",size:"sm",onClick:async()=>{try{await B.mutateAsync({annotationId:s.id,reason:S||void 0}),D(!1),k(""),r?.()}catch(l){}},isLoading:B.isPending,children:"Confirm Rejection"}),t.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{D(!1),k("")},children:"Cancel"})]})]})]})]})}),t.jsx(h,{children:t.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[t.jsx("div",{className:"flex gap-2",children:v?t.jsxs(t.Fragment,{children:[t.jsx(p,{variant:"success",size:"sm",onClick:async()=>{try{await q.mutateAsync({annotationId:s.id,updates:N}),f(!1),r?.()}catch(l){}},isLoading:q.isPending,disabled:_,children:"Save & Approve"}),t.jsx(p,{variant:"ghost",size:"sm",onClick:Q,disabled:_,children:"Cancel"})]}):t.jsxs(t.Fragment,{children:[t.jsx(p,{variant:"success",size:"sm",onClick:$,isLoading:M.isPending,disabled:_,children:"Approve (A)"}),t.jsx(p,{variant:"secondary",size:"sm",onClick:()=>f(!0),disabled:_,children:"Edit (E)"})]})}),!v&&!E&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx(p,{variant:"warning",size:"sm",onClick:()=>R(!0),disabled:_,children:"üéØ Fix Position (F)"}),t.jsx(p,{variant:"danger",size:"sm",onClick:()=>P(!0),disabled:_,children:"Reject (R)"})]})]})}),(M.isSuccess||B.isSuccess||q.isSuccess)&&t.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:t.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:t.jsxs("span",{className:"text-green-600 font-semibold",children:[M.isSuccess&&"Approved!",B.isSuccess&&"Rejected!",q.isSuccess&&"Updated!"]})})}),F&&t.jsx(T,{annotationLabel:`${s.spanishTerm} (${s.englishTerm})`,onReject:async(e,t)=>{try{await B.mutateAsync({annotationId:s.id,category:e,notes:t}),P(!1),r?.()}catch(l){console.error("Rejection failed:",l)}},onCancel:()=>P(!1)}),I&&t.jsx(A,{imageUrl:a,initialBox:s.boundingBox,label:s.spanishTerm,onSave:async e=>{try{await L.mutateAsync({annotationId:s.id,updates:{boundingBox:e}});z(e),R(!1),r?.()}catch(l){console.error("‚ùå Failed to update bounding box:",l);const t=l?.response?.data?.error||l?.message||"Unknown error",s=l?.response?.status;y?y("error",`Failed to save annotation position (${s||"N/A"}): ${t}`):alert(`Failed to save annotation position!\n\nStatus: ${s||"N/A"}\nError: ${t}\n\nCheck browser console (F12) for more details.`)}},onCancel:()=>R(!1)})]});var X},E={all:["annotation-analytics"],analytics:()=>[...E.all,"data"]},D=()=>r({queryKey:E.analytics(),queryFn:async()=>{try{return(await d.get("/api/ai/annotations/analytics")).data}catch(e){return l("Error fetching annotation analytics:",e instanceof Error?e:new Error(String(e))),{overview:{total:0,pending:0,approved:0,rejected:0,avgConfidence:"0.00"},bySpecies:{},byType:{},rejectionsByCategory:{},qualityFlags:{tooSmall:0,lowConfidence:0}}}},staleTime:12e4,gcTime:6e5,retry:2}),F=({targetCount:e=400})=>{const{data:s,isLoading:a,error:r}=D();if(a)return t.jsx("div",{className:"flex items-center justify-center p-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})});if(r||!s)return t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[t.jsx("p",{className:"text-red-800 font-semibold mb-2",children:"Failed to load analytics"}),t.jsx("p",{className:"text-red-600 text-sm",children:"Please check your connection and try again."})]});const i=s.overview.approved,n=((e,t=400)=>Math.min(100,Math.round(e/t*100)))(i,e),l=s.qualityFlags.tooSmall+s.qualityFlags.lowConfidence;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Annotation Analytics"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dataset quality and review progress metrics"})]}),t.jsxs(m,{variant:"info",size:"lg",children:[s.overview.total," Total Annotations"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(c,{variant:"elevated",children:t.jsx(g,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(u,{content:"Annotations awaiting human review - these need approval or rejection before being used in the dataset",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Pending Review"})}),t.jsx("p",{className:"text-4xl font-bold text-yellow-600",children:s.overview.pending}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.pending/s.overview.total*100).toFixed(1),"% of total"]})]})})}),t.jsx(c,{variant:"elevated",children:t.jsx(g,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(u,{content:"Annotations verified by human reviewers as accurate and ready for the learning dataset",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Approved"})}),t.jsx("p",{className:"text-4xl font-bold text-green-600",children:s.overview.approved}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.approved/s.overview.total*100).toFixed(1),"% of total"]})]})})}),t.jsx(c,{variant:"elevated",children:t.jsx(g,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(u,{content:"Annotations marked as incorrect, poorly positioned, or otherwise unsuitable for the dataset",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Rejected"})}),t.jsx("p",{className:"text-4xl font-bold text-red-600",children:s.overview.rejected}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.rejected/s.overview.total*100).toFixed(1),"% of total"]})]})})}),t.jsx(c,{variant:"elevated",children:t.jsx(g,{children:t.jsxs("div",{className:"text-center",children:[t.jsx(u,{content:"Average AI confidence score across all annotations - higher values indicate more reliable automatic detection",position:"bottom",children:t.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1 cursor-help border-b border-dotted border-gray-400",children:"Avg Confidence"})}),t.jsxs("p",{className:"text-4xl font-bold text-blue-600",children:[(100*parseFloat(s.overview.avgConfidence)).toFixed(0),"%"]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[parseFloat(s.overview.avgConfidence)>=.8?"High":"Medium"," quality"]})]})})})]}),t.jsxs(c,{variant:"elevated",children:[t.jsx(x,{children:t.jsx(u,{content:"Progress toward minimum viable dataset size. Only APPROVED annotations count toward the goal since they are verified and ready for learning.",position:"right",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900 cursor-help border-b border-dotted border-gray-400 inline-block",children:"MVP Dataset Progress"})})}),t.jsx(g,{children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("span",{className:"font-medium text-gray-700",children:[t.jsx("span",{className:"text-green-600 font-bold",children:i}),t.jsx("span",{className:"text-gray-500",children:" approved"}),t.jsxs("span",{className:"text-gray-400",children:[" / ",e," target"]})]}),t.jsxs("span",{className:"font-bold text-blue-600",children:[n,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-500 ease-out",style:{width:`${n}%`}})}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[t.jsx("span",{children:e-i>0?e-i+" more approvals needed":"‚úÖ MVP target reached!"}),t.jsxs("span",{className:"text-gray-400",children:["(",s.overview.total," total, ",s.overview.pending," pending review)"]})]})]})})]}),l>0&&t.jsxs(c,{variant:"elevated",children:[t.jsx(x,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(u,{content:"Potential issues detected in annotations that may need manual review or correction",position:"right",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900 cursor-help border-b border-dotted border-gray-400",children:"Quality Flags"})}),t.jsxs(m,{variant:"warning",size:"sm",children:[l," Issues Detected"]})]})}),t.jsx(g,{children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.qualityFlags.tooSmall>0&&t.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"‚ö†Ô∏è Too Small (<2%)"}),t.jsx("p",{className:"text-xs text-yellow-700",children:"Bounding boxes covering less than 2% of image area"})]}),t.jsx("span",{className:"text-2xl font-bold text-yellow-600",children:s.qualityFlags.tooSmall})]}),t.jsx("p",{className:"text-xs text-yellow-800 mt-2",children:"üí° Suggestion: Consider rejecting or requesting better images"})]}),s.qualityFlags.lowConfidence>0&&t.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"‚ö†Ô∏è Low Confidence (<70%)"}),t.jsx("p",{className:"text-xs text-red-700",children:"AI confidence score below recommended threshold"})]}),t.jsx("span",{className:"text-2xl font-bold text-red-600",children:s.qualityFlags.lowConfidence})]}),t.jsx("p",{className:"text-xs text-red-800 mt-2",children:"üí° Suggestion: Review carefully before approving"})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs(c,{variant:"elevated",children:[t.jsx(x,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Species Coverage"})}),t.jsx(g,{children:Object.keys(s.bySpecies).length>0?t.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Object.entries(s.bySpecies).sort(([,e],[,t])=>t-e).map(([e,s])=>t.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:e}),t.jsxs(m,{variant:"info",size:"sm",children:[s," annotations"]})]},e))}):t.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No species data available"})})]}),t.jsxs(c,{variant:"elevated",children:[t.jsx(x,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Annotation Types"})}),t.jsx(g,{children:Object.keys(s.byType).length>0?t.jsx("div",{className:"space-y-3",children:Object.entries(s.byType).sort(([,e],[,t])=>t-e).map(([e,a])=>{const r=a/s.overview.pending*100;return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"font-medium text-gray-700 capitalize",children:e}),t.jsxs("span",{className:"text-gray-600",children:[a," (",r.toFixed(1),"%)"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${r}%`}})})]},e)})}):t.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No type distribution data available"})})]})]}),Object.keys(s.rejectionsByCategory).length>0&&t.jsxs(c,{variant:"elevated",children:[t.jsx(x,{children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rejection Categories"})}),t.jsx(g,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.entries(s.rejectionsByCategory).sort(([,e],[,t])=>t-e).map(([e,s])=>t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-red-900",children:e.replace(/_/g," ")}),t.jsx(m,{variant:"danger",size:"sm",children:s})]})},e))})})]})]})},P=()=>{const{user:r,loading:i}=v(),{data:n,isLoading:l,error:o,refetch:d}=f(),{data:c}=N(),{toasts:x,addToast:m,removeToast:g}=b(),[h,u]=e.useState("pending"),[p,j]=e.useState("newest"),[w,C]=e.useState(new Set),[S,T]=e.useState("review"),A=n||[],E=s.useMemo(()=>A.length?[...A].sort((e,t)=>{switch(p){case"newest":return new Date(t.createdAt||0).getTime()-new Date(e.createdAt||0).getTime();case"oldest":return new Date(e.createdAt||0).getTime()-new Date(t.createdAt||0).getTime();case"confidence-high":return(t.confidenceScore??0)-(e.confidenceScore??0);case"confidence-low":return(e.confidenceScore??0)-(t.confidenceScore??0);case"difficulty-high":return(t.difficultyLevel??1)-(e.difficultyLevel??1);case"difficulty-low":return(e.difficultyLevel??1)-(t.difficultyLevel??1);default:return 0}}):A,[A,p]),D=c?.pending||0,P=c?.approved||0,I=c?.total||0;return i||l?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})}):r?o?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),t.jsx("p",{className:"text-gray-600 mb-4",children:o.message}),t.jsx("button",{onClick:()=>d(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})}):t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),t.jsxs("div",{className:"flex gap-4 text-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:D}),t.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-green-600",children:P}),t.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:I}),t.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]}),t.jsxs("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[t.jsx("button",{onClick:()=>T("review"),className:"px-4 py-2 font-medium border-b-2 transition-colors "+("review"===S?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:"Review Annotations"}),t.jsx("button",{onClick:()=>T("analytics"),className:"px-4 py-2 font-medium border-b-2 transition-colors "+("analytics"===S?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:"üìä Analytics Dashboard"})]})]})}),t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:"analytics"===S?t.jsx(F,{targetCount:400}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsxs("button",{onClick:()=>u("pending"),className:"px-4 py-2 rounded-md font-medium "+("pending"===h?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Pending (",D,")"]}),t.jsxs("button",{onClick:()=>u("all"),className:"px-4 py-2 rounded-md font-medium "+("all"===h?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All (",I,")"]}),t.jsxs("div",{className:"border-l border-gray-300 pl-4 ml-2",children:[t.jsx("label",{htmlFor:"sort-select",className:"sr-only",children:"Sort by"}),t.jsxs("select",{id:"sort-select",value:p,onChange:e=>j(e.target.value),className:"px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsxs("optgroup",{label:"Date",children:[t.jsx("option",{value:"newest",children:"Newest First"}),t.jsx("option",{value:"oldest",children:"Oldest First"})]}),t.jsxs("optgroup",{label:"Confidence",children:[t.jsx("option",{value:"confidence-high",children:"Confidence: High to Low"}),t.jsx("option",{value:"confidence-low",children:"Confidence: Low to High"})]}),t.jsxs("optgroup",{label:"Difficulty",children:[t.jsx("option",{value:"difficulty-high",children:"Difficulty: Hard to Easy"}),t.jsx("option",{value:"difficulty-low",children:"Difficulty: Easy to Hard"})]})]})]})]}),w.size>0&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[w.size," selected"]}),t.jsx("button",{onClick:()=>C(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),0===E.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:"üéâ"}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),t.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:E.map(e=>t.jsx(k,{annotation:e,imageUrl:e.imageUrl||"",onActionComplete:()=>d(),isSelected:w.has(e.id),onSelect:t=>{const s=new Set(w);t?s.add(e.id):s.delete(e.id),C(s)},onToast:m},e.id))})]})}),t.jsx(y,{toasts:x,onRemove:g})]}):t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),t.jsx(a,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})})};export{P as AdminAnnotationReviewPage,P as default};
