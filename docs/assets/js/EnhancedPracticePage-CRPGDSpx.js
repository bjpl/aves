import{j as e,r as t,L as s}from"./react-vendor-BjSJ0Zw_.js";import{a}from"./apiAdapter-Ds9msyIR.js";import"./vendor-B4WW6Bjp.js";import"./index-BRFl2-OY.js";import"./data-vendor-Co-Mk0hz.js";const r=({score:t,accuracy:s,streak:a,totalAttempts:r})=>e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t}),e.jsx("p",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center shadow-sm",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[s,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Accuracy"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a}),e.jsx("p",{className:"text-sm text-gray-600",children:"Streak"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total"})]})]}),l=({type:t,question:s,imageUrl:a,translation:r,options:l,selectedAnswer:i,correctAnswer:n,showFeedback:c,explanation:o,onAnswer:d})=>{const m=e=>c&&e===n?"bg-green-500 text-white":c&&e===i&&e!==n?"bg-red-500 text-white":i===e?"bg-blue-500 text-white":"bg-white border-2 border-gray-300 hover:border-blue-400";return"visual_match"===t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-center",children:s}),a&&e.jsx("div",{className:"relative w-full max-w-md mx-auto",children:e.jsx("img",{src:a,alt:"Bird to identify",className:"w-full rounded-lg shadow-md object-cover aspect-video",onError:e=>{e.target.src="https://via.placeholder.com/400x300?text=Image+Not+Available"},loading:"lazy"})}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:l.map(t=>e.jsx("button",{onClick:()=>!c&&d(t),disabled:c,className:`p-4 rounded-lg font-medium transition-all ${m(t)}`,children:t},t))})]}):"fill_blank"===t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:s}),r&&e.jsx("p",{className:"text-gray-600 italic",children:r})]}),a&&e.jsx("div",{className:"relative w-full max-w-sm mx-auto",children:e.jsx("img",{src:a,alt:"Bird reference",className:"w-full rounded-lg shadow-md object-cover aspect-square",onError:e=>{e.target.style.display="none"},loading:"lazy"})}),e.jsx("div",{className:"grid grid-cols-2 gap-3 max-w-md mx-auto",children:l.map(t=>e.jsx("button",{onClick:()=>!c&&d(t),disabled:c,className:`p-3 rounded-lg font-medium transition-all ${m(t)}`,children:t},t))})]}):"multiple_choice"===t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-2xl font-semibold text-center",children:s}),a&&e.jsx("div",{className:"relative w-full max-w-sm mx-auto",children:e.jsx("img",{src:a,alt:"Bird reference",className:"w-full rounded-lg shadow-md object-cover aspect-square",onError:e=>{e.target.style.display="none"},loading:"lazy"})}),e.jsx("div",{className:"space-y-3 max-w-md mx-auto",children:l.map(t=>e.jsx("button",{onClick:()=>!c&&d(t),disabled:c,className:`w-full p-4 text-left rounded-lg font-medium transition-all ${m(t)}`,children:t},t))}),c&&o&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg text-center",children:e.jsx("p",{className:"text-sm text-blue-700",children:o})})]}):null},i=({isCorrect:t,correctAnswer:s})=>e.jsx("div",{className:"mt-6 p-4 rounded-lg text-center "+(t?"bg-green-100":"bg-red-100"),children:e.jsx("p",{className:"text-lg font-bold "+(t?"text-green-700":"text-red-700"),children:t?"Â¡Excelente! Correct!":`Not quite. The answer was: ${s}`})});const n=new class{speciesCache=[];lastFetch=0;cacheDuration=3e5;async getSpeciesWithImages(){const e=Date.now();if(this.speciesCache.length>0&&e-this.lastFetch<this.cacheDuration)return this.speciesCache;try{const t=await a.species.list();return this.speciesCache=t.filter(e=>e.annotationCount&&e.annotationCount>0||e.primaryImageUrl),this.lastFetch=e,this.speciesCache}catch(t){return console.error("Failed to fetch species:",t),this.speciesCache}}async getRandomSpecies(e){const t=await this.getSpeciesWithImages();if(0===t.length)return[];const s=[...t].sort(()=>Math.random()-.5);return s.slice(0,Math.min(e,s.length))}async generateVisualMatchExercises(e=10){const t=[],s=await this.getRandomSpecies(4*e);if(s.length<4)return[];for(let a=0;a<Math.min(e,Math.floor(s.length/4));a++){const e=s[4*a],r=s.slice(4*a+1,4*a+4),l=[e.spanishName,...r.map(e=>e.spanishName)].sort(()=>Math.random()-.5);t.push({id:`visual_match_${a}_${Date.now()}`,type:"visual_match",question:"Â¿QuÃ© pÃ¡jaro es este? (What bird is this?)",correctAnswer:e.spanishName,options:l,imageUrl:this.getImageUrl(e),speciesId:e.id,explanation:`${e.spanishName} - ${e.englishName}`})}return t}async generateFillBlankExercises(e=10){const t=[],s=await this.getRandomSpecies(4*e);if(s.length<4)return[];const a=[{es:"El ___ vive en ___.",en:"The ___ lives in ___.",getBlank:e=>e.spanishName.toLowerCase(),getContext:e=>e.habitats?.[0]||"bosques"},{es:"El ___ es de color ___.",en:"The ___ is ___ colored.",getBlank:e=>e.spanishName.toLowerCase(),getContext:e=>e.primaryColors?.[0]||"variado"},{es:"El ___ pertenece a la familia ___.",en:"The ___ belongs to the ___ family.",getBlank:e=>e.spanishName.toLowerCase(),getContext:e=>e.familyName}];for(let r=0;r<Math.min(e,Math.floor(s.length/4));r++){const e=s[4*r],l=a[r%a.length],i=s.slice(4*r+1,4*r+4),n=l.es.replace("___","___").replace("___",l.getContext(e)),c=l.en.replace("___","___").replace("___",l.getContext(e)),o=[l.getBlank(e),...i.map(e=>l.getBlank(e))].sort(()=>Math.random()-.5);t.push({id:`fill_blank_${r}_${Date.now()}`,type:"fill_blank",question:n,correctAnswer:l.getBlank(e),options:o,translation:c,speciesId:e.id,imageUrl:this.getImageUrl(e)})}return t}async generateMultipleChoiceExercises(e=10){const t=[],s=await this.getRandomSpecies(4*e);if(s.length<4)return[];const a=[{question:e=>`Â¿DÃ³nde vive el ${e.spanishName}?`,getCorrect:e=>e.habitats?.[0]||"bosques",getOptions:(e,t)=>[e,t[0]?.habitats?.[0]||"montaÃ±as",t[1]?.habitats?.[0]||"rÃ­os",t[2]?.habitats?.[0]||"costas"],explanation:e=>`El ${e.spanishName} vive en ${e.habitats?.[0]||"varios hÃ¡bitats"}`},{question:e=>`Â¿De quÃ© color es el ${e.spanishName}?`,getCorrect:e=>e.primaryColors?.[0]||"variado",getOptions:(e,t)=>[e,t[0]?.primaryColors?.[0]||"rojo",t[1]?.primaryColors?.[0]||"azul",t[2]?.primaryColors?.[0]||"verde"],explanation:e=>`El ${e.spanishName} tiene plumaje ${e.primaryColors?.join(" y ")||"variado"}`},{question:e=>`Â¿A quÃ© familia pertenece el ${e.spanishName}?`,getCorrect:e=>e.familyName,getOptions:(e,t)=>[e,...t.map(e=>e.familyName).filter(t=>t!==e).slice(0,3)],explanation:e=>`El ${e.spanishName} es de la familia ${e.familyName}`}];for(let r=0;r<Math.min(e,Math.floor(s.length/4));r++){const e=s[4*r],l=s.slice(4*r+1,4*r+4),i=a[r%a.length],n=i.getCorrect(e),c=i.getOptions(n,l).filter((e,t,s)=>s.indexOf(e)===t).slice(0,4).sort(()=>Math.random()-.5);t.push({id:`multiple_choice_${r}_${Date.now()}`,type:"multiple_choice",question:i.question(e),correctAnswer:n,options:c,explanation:i.explanation(e),speciesId:e.id,imageUrl:this.getImageUrl(e)})}return t}async generateMixedExercises(e=30){const t=Math.ceil(e/3),[s,a,r]=await Promise.all([this.generateVisualMatchExercises(t),this.generateFillBlankExercises(t),this.generateMultipleChoiceExercises(t)]);return[...s,...a,...r].sort(()=>Math.random()-.5).slice(0,e)}getImageUrl(e){if(e.primaryImageUrl)return e.primaryImageUrl;if(e.id){return`${"https://aves-production.up.railway.app"}/api/species/${e.id}/image`}return`https://via.placeholder.com/400x300?text=${encodeURIComponent(e.spanishName)}`}clearCache(){this.speciesCache=[],this.lastFetch=0}},c=()=>{const[a,c]=t.useState([]),[o,d]=t.useState(0),[m,h]=t.useState(null),[x,p]=t.useState(!1),[g,u]=t.useState(!1),[b,N]=t.useState(0),[j,w]=t.useState(0),[f,y]=t.useState(0),[v,_]=t.useState(!0),[C,k]=t.useState(null),$=t.useRef(null);t.useEffect(()=>{(async()=>{try{_(!0),k(null);const e=await n.generateMixedExercises(30);if(0===e.length)return void k("No exercises available. Please ensure species data with images is loaded.");c(e)}catch(e){console.error("Failed to load exercises:",e),k("Failed to load practice exercises. Please try again later.")}finally{_(!1)}})()},[]);const E=t.useCallback(()=>0===a.length?null:a[o%a.length],[a,o]),M=t.useCallback(()=>{h(null),p(!1),d(e=>e+1)},[]),A=t.useCallback(e=>{h(e);const t=E();if(!t)return;const s=e.toLowerCase()===t.correctAnswer.toLowerCase();u(s),p(!0),w(e=>e+1),s?(N(e=>e+1),y(e=>e+1)):y(0),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{M()},2e3)},[E,M]),S=t.useCallback(()=>{const t=E();return t?e.jsx(l,{type:t.type,question:t.question,imageUrl:t.imageUrl,translation:t.translation,options:t.options,selectedAnswer:m,correctAnswer:t.correctAnswer,showFeedback:x,explanation:t.explanation,onAnswer:A}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No exercises available"})},[E,m,x,A]),q=t.useMemo(()=>j>0?Math.round(b/j*100):0,[b,j]);return t.useEffect(()=>()=>{$.current&&clearTimeout($.current)},[]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Practice Exercises"}),e.jsx(s,{to:"/learn",className:"text-blue-600 hover:text-blue-800 font-medium",children:"â† Back to Learn"})]}),e.jsx(r,{score:b,accuracy:q,streak:f,totalAttempts:j})]}),v&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading practice exercises..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Fetching bird species with images"})]}),C&&!v&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-12 text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Unable to Load Exercises"}),e.jsx("p",{className:"text-gray-600 mb-4",children:C}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]}),!v&&!C&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium",children:E()?.type.replace("_"," ").toUpperCase()}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["Exercise ",o+1," of ",a.length]})]}),S(),x&&E()&&e.jsx(i,{isCorrect:g,correctAnswer:E().correctAnswer}),!x&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:M,className:"text-gray-500 hover:text-gray-700",children:"Skip this exercise â†’"})})]}),f>=5&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-lg text-center",children:e.jsxs("p",{className:"text-lg font-bold",children:["ðŸ”¥ You're on fire! ",f," in a row!"]})}),j>0&&j%10==0&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg text-center",children:e.jsxs("p",{className:"text-lg font-bold",children:["ðŸŽ‰ Milestone: ",j," exercises completed!"]})})]})]})})};export{c as EnhancedPracticePage};
