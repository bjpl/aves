import{r as e,j as s,e as t,L as a}from"./react-vendor-D6vaw4E_.js";import{u as r,a as i,b as n}from"./data-vendor-CRo3OXJP.js";import{e as l,q as o,u as d}from"./index-BZZsyLrt.js";import{a as c,M as x,C as m,b as h,c as g,d as u}from"./Modal-D9jlqUyx.js";import{B as p,A as b,u as y,T as v}from"./ToastContainer-ntMMWNyK.js";import{B as j}from"./Badge-DLWuO9O4.js";import"./vendor-BKIB45Nt.js";const f={all:["ai-annotations"],lists:()=>[...f.all,"list"],list:e=>[...f.lists(),e],pending:()=>[...f.all,"pending"],stats:()=>[...f.all,"stats"]},N=()=>r({queryKey:f.pending(),queryFn:async()=>{try{return(await c.get("/api/ai/annotations/pending")).data.annotations}catch(e){return l("Error fetching pending AI annotations:",e instanceof Error?e:new Error(String(e))),[]}},staleTime:6e4,gcTime:18e4,placeholderData:[]}),w=()=>r({queryKey:f.stats(),queryFn:async()=>{try{return(await c.get("/api/ai/annotations/stats")).data.data}catch(e){return l("Error fetching AI annotation stats",e instanceof Error?e:{error:e}),{total:0,pending:0,approved:0,rejected:0,avgConfidence:0}}},staleTime:3e5,gcTime:6e5}),C=e.forwardRef(({label:e,error:t,helperText:a,leftIcon:r,rightIcon:i,fullWidth:n=!1,className:l="",disabled:o,...d},c)=>{const x=n?"w-full":"",m=t?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500";return s.jsxs("div",{className:""+(n?"w-full":""),children:[e&&s.jsxs("label",{htmlFor:d.id,className:"block text-sm font-medium text-gray-700 mb-1",children:[e,d.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("div",{className:"relative",children:[r&&s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:r}),s.jsx("input",{ref:c,className:`block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 ${m} ${x} ${r?"pl-10":""} ${i?"pr-10":""} ${o?"bg-gray-100 cursor-not-allowed":""} ${l}`,disabled:o,"aria-invalid":!!t,"aria-describedby":t?`${d.id}-error`:a?`${d.id}-helper`:void 0,...d}),i&&s.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:i})]}),t&&s.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${d.id}-error`,role:"alert",children:t}),a&&!t&&s.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${d.id}-helper`,children:a})]})});C.displayName="Input";const k=e.forwardRef(({label:e,error:t,helperText:a,fullWidth:r=!1,className:i="",disabled:n,...l},o)=>{const d=r?"w-full":"",c=t?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500";return s.jsxs("div",{className:""+(r?"w-full":""),children:[e&&s.jsxs("label",{htmlFor:l.id,className:"block text-sm font-medium text-gray-700 mb-1",children:[e,l.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsx("textarea",{ref:o,className:`block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y ${c} ${d} ${n?"bg-gray-100 cursor-not-allowed":""} ${i}`,disabled:n,"aria-invalid":!!t,"aria-describedby":t?`${l.id}-error`:a?`${l.id}-helper`:void 0,...l}),t&&s.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${l.id}-error`,role:"alert",children:t}),a&&!t&&s.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${l.id}-helper`,children:a})]})});k.displayName="TextArea";const T={NOT_IN_IMAGE:{value:"not_in_image",label:"Feature Not in Image",description:"The identified feature does not exist in this photo",icon:"ðŸš«",severity:"critical",category:"technical"},TOO_SMALL:{value:"too_small",label:"Too Small to See",description:"Feature is too tiny to be useful for learning (<2% of image)",icon:"ðŸ”¬",severity:"high",category:"technical"},UNCLEAR_BLURRY:{value:"unclear_blurry",label:"Unclear/Blurry",description:"Cannot distinguish feature clearly due to image quality",icon:"ðŸ‘“",severity:"high",category:"technical"},OCCLUDED:{value:"occluded",label:"Blocked/Hidden",description:"Feature is partially or fully obstructed from view",icon:"ðŸŒ¿",severity:"medium",category:"technical"},WRONG_IDENTIFICATION:{value:"wrong_id",label:"Misidentified Feature",description:"AI confused one thing for another (e.g., branch as beak)",icon:"âŒ",severity:"critical",category:"identification"},WRONG_TERM:{value:"wrong_term",label:"Incorrect Spanish/English Term",description:"Translation or terminology is incorrect",icon:"ðŸ“š",severity:"high",category:"identification"},DUPLICATE:{value:"duplicate",label:"Duplicate Annotation",description:'Same feature already annotated (e.g., "ala" and "alas")',icon:"ðŸ“‹",severity:"low",category:"identification"},NOT_REPRESENTATIVE:{value:"not_representative",label:"Not a Representative Example",description:"Feature exists but is atypical, unusual angle, or poor teaching example",icon:"ðŸŽ“",severity:"high",category:"pedagogical"},CONFUSING_FOR_LEARNERS:{value:"confusing",label:"Potentially Confusing",description:"Could mislead learners due to unusual presentation",icon:"ðŸ˜•",severity:"medium",category:"pedagogical"},INAPPROPRIATE_DIFFICULTY:{value:"wrong_difficulty",label:"Inappropriate Difficulty Level",description:"Marked as beginner but should be advanced (or vice versa)",icon:"ðŸ“Š",severity:"low",category:"pedagogical"},BAD_POSITION:{value:"bad_position",label:"Severely Misaligned",description:"Bounding box is >50% off from actual feature location",icon:"ðŸŽ¯",severity:"high",category:"positioning"},BOX_TOO_LARGE:{value:"box_too_large",label:"Box Includes Too Much",description:"Bounding box captures surrounding area, not just feature",icon:"ðŸ“",severity:"medium",category:"positioning"},BOX_TOO_SMALL:{value:"box_too_small",label:"Box Cuts Off Feature",description:"Bounding box is too tight, cuts off part of feature",icon:"âœ‚ï¸",severity:"medium",category:"positioning"},OTHER:{value:"other",label:"Other Issue",description:"Other quality issue not listed above",icon:"ðŸ¤”",severity:"low",category:"other"}},S=({annotationLabel:t,onReject:a,onCancel:r})=>{const[i,n]=e.useState(null),[l,o]=e.useState(""),d={technical:Object.values(T).filter(e=>"technical"===e.category),identification:Object.values(T).filter(e=>"identification"===e.category),pedagogical:Object.values(T).filter(e=>"pedagogical"===e.category),positioning:Object.values(T).filter(e=>"positioning"===e.category),other:Object.values(T).filter(e=>"other"===e.category)},c=e=>{switch(e){case"critical":return"bg-red-100 border-red-300 text-red-800";case"high":return"bg-orange-100 border-orange-300 text-orange-800";case"medium":return"bg-yellow-100 border-yellow-300 text-yellow-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-auto",children:[s.jsxs("div",{className:"bg-red-600 text-white px-6 py-4 rounded-t-lg",children:[s.jsxs("h3",{className:"text-xl font-bold",children:["Reject Annotation: ",t]}),s.jsx("p",{className:"text-sm text-red-100 mt-1",children:"Select the primary issue with this annotation"})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[s.jsx("span",{className:"text-lg",children:"ðŸ”§"})," Technical Issues"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.technical.map(e=>s.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-sm",children:e.label}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[s.jsx("span",{className:"text-lg",children:"ðŸ¤–"})," AI Identification Issues"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.identification.map(e=>s.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-sm",children:e.label}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[s.jsx("span",{className:"text-lg",children:"ðŸŽ“"})," Educational Quality Issues"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.pedagogical.map(e=>s.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-sm",children:e.label}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[s.jsx("span",{className:"text-lg",children:"ðŸŽ¯"})," Positioning Issues"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.positioning.map(e=>s.jsx("button",{onClick:()=>n(e.value),className:"text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${c(e.severity)}`),children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-sm",children:e.label}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value))})]}),d.other.map(e=>s.jsx("button",{onClick:()=>n(e.value),className:"w-full text-left p-3 rounded-lg border-2 transition-all "+(i===e.value?"border-red-500 bg-red-50 shadow-md":"border-gray-200 hover:border-red-300 hover:bg-red-50 bg-gray-50"),children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xl",children:e.icon}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-sm",children:e.label}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})},e.value)),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes (Optional)"}),s.jsx("textarea",{value:l,onChange:e=>o(e.target.value),placeholder:"Any additional context or details about this rejection...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 h-24 resize-none"})]})]}),s.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3 border-t",children:[s.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>{i&&a(i,l)},disabled:!i,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-md transition-colors",children:i?"âœ• Confirm Rejection":"Select a Category"})]})]})})},A=({imageUrl:t,initialBox:a,label:r,onSave:i,onCancel:n})=>{const[l,o]=e.useState({...a,shape:a.shape||"rectangle"}),[d,c]=e.useState(!1),[x,m]=e.useState(null),[h,g]=e.useState({x:0,y:0}),u=e.useRef(null),p=e=>{o(s=>({...s,shape:e}))},b=(e,s,t)=>{e.preventDefault(),"drag"===s?c(!0):m(t||null),g({x:e.clientX,y:e.clientY})},y=()=>{c(!1),m(null)};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&n()},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto",onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"bg-gray-800 text-white px-6 py-4 rounded-t-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-bold",children:["Adjust Bounding Box - ",r]}),s.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Drag the box to move â€¢ Drag corners/edges to resize â€¢ Click Save when done"})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg p-1",children:[s.jsxs("button",{type:"button",onClick:()=>p("rectangle"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2 "+("rectangle"===l.shape?"bg-yellow-500 text-yellow-900":"text-gray-300 hover:bg-gray-600"),title:"Rectangle shape",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})}),"Rectangle"]}),s.jsxs("button",{type:"button",onClick:()=>p("ellipse"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2 "+("ellipse"===l.shape?"bg-yellow-500 text-yellow-900":"text-gray-300 hover:bg-gray-600"),title:"Ellipse/Circle shape",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("ellipse",{cx:"12",cy:"12",rx:"10",ry:"8"})}),"Ellipse"]})]})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{ref:u,className:"relative bg-gray-900 rounded-lg overflow-hidden select-none",style:{paddingTop:"75%"},onMouseMove:e=>{if(!u.current)return;if(!d&&!x)return;const s=u.current.getBoundingClientRect(),t=(e.clientX-h.x)/s.width,a=(e.clientY-h.y)/s.height;if(d){const e=Math.max(0,Math.min(1-l.width,l.x+t)),s=Math.max(0,Math.min(1-l.height,l.y+a));o({...l,x:e,y:s})}else if(x){let e={...l};if(x.includes("n")){const s=Math.max(0,Math.min(l.y+l.height-.05,l.y+a)),t=l.y-s;e.y=s,e.height+=t}if(x.includes("s")){const s=Math.max(.05,Math.min(1-l.y,l.height+a));e.height=s}if(x.includes("w")){const s=Math.max(0,Math.min(l.x+l.width-.05,l.x+t)),a=l.x-s;e.x=s,e.width+=a}if(x.includes("e")){const s=Math.max(.05,Math.min(1-l.x,l.width+t));e.width=s}o(e)}g({x:e.clientX,y:e.clientY})},onMouseUp:y,onMouseLeave:y,children:[s.jsx("img",{src:t,alt:r,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain pointer-events-none"}),s.jsxs("div",{className:"absolute cursor-move",style:{left:100*l.x+"%",top:100*l.y+"%",width:100*l.width+"%",height:100*l.height+"%",borderRadius:"ellipse"===l.shape?"50%":"0",border:"4px solid "+(d?"#22c55e":"#facc15"),backgroundColor:"rgba(250, 204, 21, 0.2)",boxShadow:d?"0 0 30px rgba(34, 197, 94, 0.8)":"0 0 20px rgba(250, 204, 21, 0.6)"},onMouseDown:e=>b(e,"drag"),children:[s.jsx("div",{className:"absolute -top-10 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:r}),s.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-nw-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","nw")}}),s.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-ne-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","ne")}}),s.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-sw-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","sw")}}),s.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-se-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","se")}}),s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-n-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","n")}}),s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-s-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","s")}}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-w-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","w")}}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-e-resize hover:scale-150 transition-transform",onMouseDown:e=>{e.stopPropagation(),b(e,"resize","e")}})]})]}),s.jsxs("div",{className:"mt-4 bg-gray-100 rounded-lg p-4",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Current Coordinates (Normalized 0-1)"}),s.jsxs("div",{className:"grid grid-cols-5 gap-4 text-sm font-mono",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"X:"})," ",s.jsx("span",{className:"text-blue-600 font-bold",children:l.x.toFixed(3)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Y:"})," ",s.jsx("span",{className:"text-blue-600 font-bold",children:l.y.toFixed(3)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"W:"})," ",s.jsx("span",{className:"text-green-600 font-bold",children:l.width.toFixed(3)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"H:"})," ",s.jsx("span",{className:"text-green-600 font-bold",children:l.height.toFixed(3)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Shape:"})," ",s.jsx("span",{className:"text-purple-600 font-bold capitalize",children:l.shape})]})]})]})]}),s.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3",children:[s.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),o({...a,shape:a.shape||"rectangle"})},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"â†º Reset to Original"}),s.jsx("div",{className:"flex-1"}),s.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),n()},className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),s.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),i(l)},className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-md transition-colors shadow-md",children:"ðŸ’¾ Save & Apply"})]})]})})},E=({exercise:t,onAnswer:a,disabled:r=!1})=>{const[i,n]=e.useState(null),[l,o]=e.useState(!1);e.useEffect(()=>{n(null),o(!1)},[t.id]);const d=e=>l?e===t.correctAnswer?"bg-green-500 text-white":i===e&&e!==t.correctAnswer?"bg-red-500 text-white":"bg-gray-100 text-gray-400 border border-gray-200":i===e?"bg-blue-500 text-white":"bg-white hover:bg-gray-50 text-gray-900 border border-gray-300";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t.instructions})}),s.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:(()=>{const e=t.sentence.split("___");return s.jsxs("p",{className:"text-xl leading-relaxed",children:[e[0],s.jsx("span",{className:"inline-block min-w-[100px] mx-2 pb-1 border-b-2 border-gray-400 text-center font-bold text-blue-600",children:l?s.jsx("span",{className:i===t.correctAnswer?"text-green-600":"text-red-600",children:i||"___"}):"___"}),e[1]]})})()}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:t.options.map((e,c)=>s.jsxs("button",{onClick:()=>{return s=e,void(r||l||(n(s),o(!0),a(s)));var s},disabled:r||l,className:`\n              px-4 py-3 rounded-lg font-medium transition-all\n              ${d(e)}\n              ${l||r?"cursor-default":"cursor-pointer"}\n            `,children:[s.jsxs("span",{className:"mr-2",children:[String.fromCharCode(65+c),"."]}),e,l&&e===t.correctAnswer&&s.jsx("span",{className:"ml-2",children:"âœ“"}),l&&i===e&&e!==t.correctAnswer&&s.jsx("span",{className:"ml-2",children:"âœ—"})]},e))}),l&&s.jsx("div",{className:"p-4 rounded-lg "+(i===t.correctAnswer?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:i===t.correctAnswer?s.jsx("p",{className:"font-semibold",children:"Â¡Correcto!"}):s.jsxs("p",{children:[s.jsx("span",{className:"font-semibold",children:"Incorrect."})," The answer was: ",s.jsx("strong",{children:t.correctAnswer})]})})]})},M=({exercise:t,onAnswer:a,disabled:r})=>{const[i,n]=e.useState(null),[l,o]=e.useState(null),d=e.useMemo(()=>({flamingo:[{id:"beak",label:"el pico",x:25,y:15,width:8,height:5},{id:"neck",label:"el cuello",x:22,y:20,width:6,height:15},{id:"legs",label:"las patas",x:20,y:50,width:10,height:30},{id:"feathers",label:"las plumas",x:15,y:35,width:20,height:15},{id:"wings",label:"las alas",x:10,y:30,width:15,height:20}],eagle:[{id:"beak",label:"el pico",x:45,y:20,width:8,height:6},{id:"talons",label:"las garras",x:40,y:65,width:12,height:10},{id:"eyes",label:"los ojos",x:43,y:18,width:5,height:3},{id:"wings",label:"las alas",x:25,y:30,width:30,height:25},{id:"tail",label:"la cola",x:35,y:55,width:15,height:12}],sparrow:[{id:"beak",label:"el pico",x:42,y:25,width:5,height:3},{id:"wings",label:"las alas",x:30,y:35,width:20,height:15},{id:"tail",label:"la cola",x:25,y:45,width:10,height:8},{id:"legs",label:"las patas",x:38,y:50,width:6,height:8},{id:"breast",label:"el pecho",x:35,y:38,width:10,height:10}]}),[]),c=e.useMemo(()=>t.metadata?.bird||"flamingo",[t.metadata?.bird]),x=e.useMemo(()=>t.metadata?.targetPart||"beak",[t.metadata?.targetPart]),m=e.useMemo(()=>d[c]||d.flamingo,[d,c]),h=e.useCallback(e=>{r||(n(e),a(e))},[r,a]),g=e.useCallback(e=>{r||o(e)},[r]),u=e.useCallback(()=>{r||o(null)},[r]),p=e.useCallback(e=>{const s=e.id===x,t=l===e.id,a=i===e.id;let n="transparent",o="transparent",d=0;return t&&!r&&(n="#3B82F6",o="rgba(59, 130, 246, 0.1)",d=.8),a&&r&&(s?(n="#10B981",o="rgba(16, 185, 129, 0.2)",d=1):(n="#EF4444",o="rgba(239, 68, 68, 0.2)",d=1)),{position:"absolute",left:`${e.x}%`,top:`${e.y}%`,width:`${e.width}%`,height:`${e.height}%`,border:`2px solid ${n}`,backgroundColor:o,opacity:d,borderRadius:"8px",cursor:r?"default":"pointer",transition:"all 0.2s ease-in-out",display:"flex",alignItems:"center",justifyContent:"center"}},[x,r,l,i]),b=e.useMemo(()=>{const e={flamingo:"https://images.unsplash.com/photo-1535821265819-8e7ff3c30737?w=600",eagle:"https://images.unsplash.com/photo-1611689342806-0863700ce1e4?w=600",sparrow:"https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=600",stork:"https://images.unsplash.com/photo-1596071915134-94f36f1d3188?w=600",owl:"https://images.unsplash.com/photo-1557401751-376608588678?w=600",peacock:"https://images.unsplash.com/photo-1512990641230-7e91cc31d0dc?w=600"};return e[c]||e.flamingo},[c]);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Visual Identification"}),s.jsxs("p",{className:"text-lg text-gray-700",children:["Click on: ",s.jsx("span",{className:"font-bold text-blue-600",children:t.prompt})]}),t.metadata?.pronunciation&&s.jsx("p",{className:"text-sm text-gray-500 mt-1 italic",children:t.metadata.pronunciation})]}),s.jsxs("div",{className:"relative mx-auto",style:{maxWidth:"500px"},children:[s.jsx("img",{src:b,alt:"Bird for identification",className:"w-full rounded-lg shadow-md"}),m.map(e=>s.jsx("div",{style:p(e),onMouseEnter:()=>g(e.id),onMouseLeave:u,onClick:()=>h(e.id),children:(l===e.id||i===e.id&&r)&&s.jsx("span",{className:"text-xs font-semibold text-gray-800 bg-white px-2 py-1 rounded shadow-sm",children:e.label})},e.id))]}),!r&&s.jsxs("div",{className:"flex justify-center space-x-4 text-sm",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-blue-100 border-2 border-blue-500 rounded mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Hover to explore"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-100 border-2 border-green-500 rounded mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Correct"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-red-100 border-2 border-red-500 rounded mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Incorrect"})]})]}),r&&i===x&&t.metadata?.tip&&s.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded",children:s.jsxs("p",{className:"text-sm text-blue-700",children:[s.jsx("strong",{children:"ðŸ’¡ Learning Tip:"})," ",t.metadata.tip]})})]})},D=({annotation:t,onClose:a})=>{const[r,i]=e.useState("learn"),[n,l]=e.useState(!1),o={id:"preview-fill-blank",type:"contextual_fill",difficultyLevel:t.difficultyLevel||1,prompt:`Complete the sentence with the correct term for "${t.englishTerm}"`,instructions:"Fill in the blank with the correct Spanish term",sentence:`El ${t.species.toLowerCase()} tiene ___ muy distintivo.`,correctAnswer:t.spanishTerm,options:[t.spanishTerm,"el pico","las plumas","las alas"].slice(0,4),imageUrl:t.imageUrl,metadata:{annotationId:t.id,pronunciation:t.pronunciation}},d={id:"preview-multiple-choice",type:"visual_identification",difficultyLevel:t.difficultyLevel||1,prompt:t.spanishTerm,imageUrl:t.imageUrl,correctAnswer:t.type,metadata:{annotationId:t.id,pronunciation:t.pronunciation,bird:t.species.toLowerCase(),targetPart:t.type,tip:`The ${t.englishTerm} is a key feature of the ${t.species}.`}},c=e=>{l(!0)};return s.jsx(x,{isOpen:!0,onClose:a,title:"Preview as Student",size:"xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded",children:[s.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Preview Mode"}),s.jsxs("p",{className:"text-sm text-blue-700",children:["This shows exactly how students will see this annotation in different contexts. The annotation is ",s.jsx("strong",{children:"not yet published"}),"."]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Spanish Term:"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.spanishTerm})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-xs font-medium text-gray-600",children:"English Term:"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.englishTerm})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Type:"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.type})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Species:"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.species})]})]}),s.jsx("div",{className:"border-b border-gray-200",children:s.jsx("nav",{className:"flex space-x-4","aria-label":"Preview Tabs",children:["learn","fill-blank","multiple-choice"].map(e=>s.jsxs("button",{onClick:()=>{i(e),l(!1)},className:"px-4 py-2 border-b-2 font-medium text-sm transition-colors "+(r===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["learn"===e&&"Learn Page View","fill-blank"===e&&"Fill-in-the-Blank","multiple-choice"===e&&"Visual ID"]},e))})}),s.jsxs("div",{className:"min-h-[400px]",children:["learn"===r&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Learn Page - Interactive Image"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Students will click on the highlighted area to discover this term."}),s.jsx("div",{className:"border-2 border-gray-200 rounded-lg overflow-hidden",children:s.jsx("div",{className:"relative bg-gray-900",children:s.jsxs("div",{className:"relative w-full overflow-hidden",style:{paddingTop:"75%"},children:[s.jsx("img",{src:t.imageUrl,alt:t.englishTerm,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain"}),t.boundingBox&&(()=>{const e=Math.max(0,Math.min(1,t.boundingBox.x)),a=Math.max(0,Math.min(1,t.boundingBox.y)),r=Math.min(t.boundingBox.width,1-e),i=Math.min(t.boundingBox.height,1-a);return s.jsx("div",{className:"absolute border-4 border-yellow-400 bg-yellow-400 bg-opacity-10 pointer-events-none animate-pulse",style:{left:100*e+"%",top:100*a+"%",width:100*r+"%",height:100*i+"%",boxShadow:"inset 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4)"},children:s.jsx("div",{className:"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 px-4 py-2 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:t.spanishTerm})})})()]})})}),s.jsx("div",{className:"bg-white border-2 border-green-500 rounded-lg p-4 shadow-md",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:s.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-lg font-bold text-gray-900",children:t.spanishTerm}),s.jsx("p",{className:"text-sm text-gray-600",children:t.englishTerm}),t.pronunciation&&s.jsx("p",{className:"text-sm text-gray-500 italic mt-1",children:t.pronunciation})]})]})})]}),"fill-blank"===r&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Practice - Fill in the Blank"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Sample exercise showing how this annotation appears in practice mode."}),s.jsx("div",{className:"border-2 border-gray-200 rounded-lg p-6 bg-white",children:s.jsx(E,{exercise:o,onAnswer:c,disabled:n})})]}),"multiple-choice"===r&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Practice - Visual Identification"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Sample exercise showing interactive visual identification."}),s.jsx("div",{className:"border-2 border-gray-200 rounded-lg p-6 bg-white",children:s.jsx(M,{exercise:d,onAnswer:c,disabled:n})})]})]}),s.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:["ðŸ’¡ ",s.jsx("strong",{children:"Tip:"})," Switch between tabs to see all student views"]}),s.jsx(p,{variant:"primary",onClick:a,children:"Close Preview"})]})]})})},F=({size:e="md",color:t="primary",label:a,centered:r=!1})=>{const i=s.jsx("div",{className:`animate-spin rounded-full ${{xs:"h-4 w-4 border-2",sm:"h-6 w-6 border-2",md:"h-8 w-8 border-2",lg:"h-12 w-12 border-3",xl:"h-16 w-16 border-4"}[e]} ${{primary:"border-blue-600",secondary:"border-gray-600",success:"border-green-600",danger:"border-red-600",white:"border-white"}[t]} border-t-transparent`,role:"status","aria-label":a||"Loading",children:s.jsx("span",{className:"sr-only",children:a||"Loading..."})});return r?s.jsxs("div",{className:"flex items-center justify-center",children:[i,a&&s.jsx("span",{className:"ml-2 text-gray-600",children:a})]}):s.jsxs("div",{className:"inline-flex items-center",children:[i,a&&s.jsx("span",{className:"ml-2 text-gray-600",children:a})]})},B=({annotationId:t,annotationLabel:a,onClose:r})=>{const[i,n]=e.useState([]),[o,d]=e.useState(!0),[c,x]=e.useState(null);e.useEffect(()=>{(async()=>{try{d(!0),x(null);const e=await fetch(`/api/annotations/${t}/history`);if(!e.ok)throw new Error(`Failed to fetch history: ${e.statusText}`);const s=await e.json();n(s.history||[])}catch(e){const s=e instanceof Error?e.message:"Unknown error occurred";x(s),l("Failed to fetch annotation history",e instanceof Error?e:{error:e})}finally{d(!1)}})()},[t]),e.useEffect(()=>{const e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]);const m=e=>{const s=new Date(e);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(s)},h=e=>{const s=new Date(e),t=(new Date).getTime()-s.getTime(),a=Math.floor(t/6e4),r=Math.floor(t/36e5),i=Math.floor(t/864e5);return a<1?"just now":a<60?`${a} minute${a>1?"s":""} ago`:r<24?`${r} hour${r>1?"s":""} ago`:i<7?`${i} day${i>1?"s":""} ago`:m(e)};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:r,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Annotation History"}),s.jsx("p",{className:"text-blue-100 text-sm mt-1",children:a})]}),s.jsx("button",{onClick:r,className:"text-white hover:text-gray-200 transition-colors","aria-label":"Close modal",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)] p-6",children:o?s.jsxs("div",{className:"flex justify-center items-center py-12",children:[s.jsx(F,{size:"lg"}),s.jsx("span",{className:"ml-3 text-gray-600",children:"Loading history..."})]}):c?s.jsxs(b,{variant:"danger",children:[s.jsx("strong",{children:"Error:"})," ",c]}):0===i.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No history available"}),s.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This annotation has no recorded changes yet."})]}):s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200"}),i.map((e,t)=>{return s.jsxs("div",{className:"relative pb-6 last:pb-0",children:[s.jsx("div",{className:"absolute left-6 top-2 -translate-x-1/2 w-3 h-3 rounded-full bg-blue-600 border-2 border-white shadow"}),s.jsxs("div",{className:"ml-14 bg-gray-50 rounded-lg p-4 border border-gray-200",children:[s.jsx("div",{className:"flex items-start justify-between mb-2",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[(a=e.changeType,s.jsx(j,{variant:{create:"success",update:"info",approve:"success",reject:"danger",delete:"danger"}[a]||"default",size:"sm",children:a.toUpperCase()})),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.changesSummary})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),s.jsx("span",{children:e.changedByEmail}),s.jsx("span",{className:"text-gray-400",children:"â€¢"}),s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{title:m(e.changedAt),children:h(e.changedAt)})]})]})}),e.changedFields.length>0&&s.jsx("div",{className:"mt-3 space-y-2",children:e.changedFields.map((e,t)=>s.jsxs("div",{className:"bg-white rounded p-3 border border-gray-200",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-1",children:e.field}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500 font-medium mb-1",children:"Before:"}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-red-800 font-mono text-xs break-all",children:e.oldValue})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-gray-500 font-medium mb-1",children:"After:"}),s.jsx("div",{className:"bg-green-50 border border-green-200 rounded p-2 text-green-800 font-mono text-xs break-all",children:e.newValue})]})]})]},t))})]})]},e.id);var a})]})})}),s.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end",children:s.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Close"})})]})})},I=({annotation:t,imageUrl:a,onActionComplete:r,isSelected:d=!1,onSelect:x,onToast:b})=>{const[y,v]=e.useState(!1),[N,w]=e.useState({spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,pronunciation:t.pronunciation||""}),[k,T]=e.useState(""),[E,M]=e.useState(!1),[F,I]=e.useState(!1),[L,P]=e.useState(!1),[$,z]=e.useState(!1),[R,_]=e.useState(!1),O=(()=>{const e=i();return n({mutationFn:async e=>{try{return(await c.post(`/api/ai/annotations/${e}/approve`)).data.data}catch(s){throw l("Approve mutation request failed",{status:s.response?.status,data:s.response?.data,message:s.message}),s}},onMutate:async s=>{await e.cancelQueries({queryKey:f.all});const t=e.getQueryData(f.pending());if(t){const a=t.filter(e=>e.id!==s);e.setQueryData(f.pending(),a)}return{previousData:t}},onSuccess:async(s,t)=>{await Promise.all([e.invalidateQueries({queryKey:f.all,refetchType:"active"}),e.invalidateQueries({queryKey:f.stats(),refetchType:"active"}),e.invalidateQueries({queryKey:o.annotations.all})]),await e.refetchQueries({queryKey:f.pending(),type:"active"})},onError:(s,t,a)=>{l("Approve mutation onError",{annotationId:t,hasContext:!!a,hasPreviousData:!!a?.previousData,error:s}),a?.previousData&&e.setQueryData(f.pending(),a.previousData),l("Error approving annotation",s instanceof Error?s:new Error(String(s)))}})})(),q=(()=>{const e=i();return n({mutationFn:async({annotationId:e,category:s,notes:t,reason:a})=>(await c.post(`/api/ai/annotations/${e}/reject`,{category:s,notes:t,reason:a})).data.data,onMutate:async({annotationId:s})=>{await e.cancelQueries({queryKey:f.all});const t=e.getQueryData(f.pending());return t&&e.setQueryData(f.pending(),t.filter(e=>e.id!==s)),{previousData:t}},onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:f.all,refetchType:"active"}),e.invalidateQueries({queryKey:f.stats(),refetchType:"active"})]),await e.refetchQueries({queryKey:f.pending(),type:"active"})},onError:(s,t,a)=>{a?.previousData&&e.setQueryData(f.pending(),a.previousData),l("Error rejecting annotation",s instanceof Error?s:new Error(String(s)))}})})(),Q=(()=>{const e=i();return n({mutationFn:async({annotationId:e,updates:s})=>(await c.post(`/api/ai/annotations/${e}/edit`,s)).data.data,onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:f.all,refetchType:"active"}),e.invalidateQueries({queryKey:f.stats(),refetchType:"active"}),e.invalidateQueries({queryKey:o.annotations.all})]),await e.refetchQueries({queryKey:f.pending(),type:"active"})},onError:e=>{l("Error editing annotation",e instanceof Error?e:new Error(String(e)))}})})(),U=(()=>{const e=i();return n({mutationFn:async({annotationId:e,updates:s})=>(await c.patch(`/api/ai/annotations/${e}`,s)).data,onMutate:async({annotationId:s,updates:t})=>{await e.cancelQueries({queryKey:f.all});const a=e.getQueryData(f.pending());return a&&e.setQueryData(f.pending(),a.map(e=>e.id===s?{...e,...t}:e)),{previousData:a}},onError:(s,t,a)=>{a?.previousData&&e.setQueryData(f.pending(),a.previousData),l("Error updating annotation",s instanceof Error?s:new Error(String(s)))},onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:f.all,refetchType:"active"}),e.invalidateQueries({queryKey:f.stats(),refetchType:"active"})]),await e.refetchQueries({queryKey:f.pending(),type:"active"})}})})(),K=async()=>{try{await O.mutateAsync(t.id),r?.()}catch(l){}},W=()=>{v(!1),w({spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,pronunciation:t.pronunciation||""})},H=O.isPending||q.isPending||Q.isPending||U.isPending;e.useEffect(()=>{const e=e=>{const s=e.target;if(("INPUT"===s.tagName||"TEXTAREA"===s.tagName||s.isContentEditable)&&"Escape"!==e.key)return;if(H)return;switch(e.key.toLowerCase()){case"a":y||E||F||L||(e.preventDefault(),K());break;case"r":y||E||F||L||(e.preventDefault(),I(!0));break;case"e":y||E||F||L||(e.preventDefault(),v(!0));break;case"f":y||E||F||L||$||(e.preventDefault(),P(!0));break;case"p":y||E||F||L||$||R||(e.preventDefault(),z(!0));break;case"h":y||E||F||L||$||R||(e.preventDefault(),_(!0));break;case"escape":e.preventDefault(),I(!1),P(!1),M(!1),z(!1),_(!1),z(!1),y&&W()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[y,E,F,L,$,H]);const V=()=>{const e=t.boundingBox;return e&&e.width&&e.height?e.width*e.height:0},X=V()<.02,Y=(t.confidenceScore??1)<.7,G=X||Y;return s.jsxs(m,{variant:"elevated",className:"mb-4",children:[s.jsx(h,{children:s.jsxs("div",{className:"flex items-start justify-between w-full",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[x&&s.jsx("input",{type:"checkbox",checked:d,onChange:e=>x(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",s.jsx("span",{className:"font-medium",children:t.type})]})]})]}),s.jsxs("div",{className:"flex gap-2 flex-wrap",children:[void 0!==t.confidenceScore&&s.jsxs(j,{variant:(J=t.confidenceScore,J?J>=.8?"success":J>=.6?"warning":"danger":"default"),size:"sm",children:["Confidence: ",(100*t.confidenceScore).toFixed(1),"%"]}),s.jsxs(j,{variant:"primary",size:"sm",children:["Difficulty: ",t.difficultyLevel]}),X&&s.jsxs(j,{variant:"warning",size:"sm",children:["âš ï¸ Too Small (",(100*V()).toFixed(1),"%)"]}),Y&&s.jsx(j,{variant:"danger",size:"sm",children:"âš ï¸ Low Confidence"})]})]})}),s.jsx(g,{children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),s.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden relative bg-gray-900",children:s.jsxs("div",{className:"relative w-full overflow-hidden",style:{paddingTop:"75%"},children:[s.jsx("img",{src:a,alt:t.englishTerm,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain"}),t.boundingBox&&(()=>{const e=Math.max(0,Math.min(1,t.boundingBox.x)),a=Math.max(0,Math.min(1,t.boundingBox.y)),r=Math.min(t.boundingBox.width,1-e),i=Math.min(t.boundingBox.height,1-a);return s.jsx("div",{className:"absolute border-4 border-yellow-400 bg-yellow-400 bg-opacity-10 pointer-events-none",style:{left:100*e+"%",top:100*a+"%",width:100*r+"%",height:100*i+"%",boxShadow:"inset 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4)"},children:s.jsx("div",{className:"absolute -top-8 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:t.spanishTerm})})})()]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:y?"Edit Annotation Data":"Annotation Data"}),y?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),s.jsx(C,{value:N.spanishTerm,onChange:e=>w({...N,spanishTerm:e.target.value}),placeholder:"Spanish term"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),s.jsx(C,{value:N.englishTerm,onChange:e=>w({...N,englishTerm:e.target.value}),placeholder:"English term"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),s.jsx(C,{value:N.pronunciation,onChange:e=>w({...N,pronunciation:e.target.value}),placeholder:"Pronunciation (optional)"})]})]}):s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",s.jsx("span",{className:"text-base text-gray-900",children:t.spanishTerm})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",s.jsx("span",{className:"text-base text-gray-900",children:t.englishTerm})]}),t.pronunciation&&s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",s.jsx("span",{className:"text-base text-gray-900 font-mono",children:t.pronunciation})]})]}),t.boundingBox?s.jsxs("div",{className:"rounded-lg p-3 "+(G?"bg-yellow-50 border-2 border-yellow-300":"bg-blue-50"),children:[s.jsx("h5",{className:"text-xs font-semibold mb-2 "+(G?"text-yellow-900":"text-blue-900"),children:"Bounding Box (Normalized 0-1)"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs font-mono "+(G?"text-yellow-800":"text-blue-800"),children:[s.jsxs("div",{children:["X: ",t.boundingBox.x.toFixed(2),", Y:"," ",t.boundingBox.y.toFixed(2)]}),s.jsxs("div",{children:["W: ",t.boundingBox.width.toFixed(2),", H:"," ",t.boundingBox.height.toFixed(2)]})]}),G&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-yellow-300",children:[s.jsx("p",{className:"text-xs text-yellow-900 font-semibold mb-1",children:"ðŸ’¡ Suggested Action:"}),s.jsxs("ul",{className:"text-xs text-yellow-800 space-y-1",children:[X&&s.jsx("li",{children:'â€¢ Consider rejecting: "Too Small (<2% of image)"'}),Y&&s.jsx("li",{children:"â€¢ Review carefully: AI confidence below 70%"})]})]})]}):s.jsxs("div",{className:"rounded-lg p-3 bg-red-50 border-2 border-red-300",children:[s.jsx("h5",{className:"text-xs font-semibold mb-2 text-red-900",children:"âš ï¸ Missing Bounding Box"}),s.jsx("p",{className:"text-xs text-red-800",children:'This annotation is missing bounding box data. It should be rejected or have a bounding box added via "Fix Position".'})]}),E&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),s.jsx(C,{value:k,onChange:e=>T(e.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(p,{variant:"danger",size:"sm",onClick:async()=>{try{await q.mutateAsync({annotationId:t.id,reason:k||void 0}),M(!1),T(""),r?.()}catch(l){}},isLoading:q.isPending,children:"Confirm Rejection"}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{M(!1),T("")},children:"Cancel"})]})]})]})]})}),s.jsx(u,{children:s.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[s.jsx("div",{className:"flex gap-2",children:y?s.jsxs(s.Fragment,{children:[s.jsx(p,{variant:"success",size:"sm",onClick:async()=>{try{await Q.mutateAsync({annotationId:t.id,updates:N}),v(!1),r?.()}catch(l){}},isLoading:Q.isPending,disabled:H,children:"Save & Approve"}),s.jsx(p,{variant:"ghost",size:"sm",onClick:W,disabled:H,children:"Cancel"})]}):s.jsxs(s.Fragment,{children:[s.jsx(p,{variant:"success",size:"sm",onClick:K,isLoading:O.isPending,disabled:H,children:"Approve (A)"}),s.jsx(p,{variant:"secondary",size:"sm",onClick:()=>v(!0),disabled:H,children:"Edit (E)"})]})}),!y&&!E&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx(p,{variant:"primary",size:"sm",onClick:()=>z(!0),disabled:H,children:"ðŸ‘ï¸ Preview (P)"}),s.jsx(p,{variant:"secondary",size:"sm",onClick:()=>_(!0),disabled:H,title:"View annotation edit history",children:"ðŸ“œ History (H)"}),s.jsx(p,{variant:"warning",size:"sm",onClick:()=>P(!0),disabled:H,children:"ðŸŽ¯ Fix Position (F)"}),s.jsx(p,{variant:"danger",size:"sm",onClick:()=>I(!0),disabled:H,children:"Reject (R)"})]})]})}),(O.isSuccess||q.isSuccess||Q.isSuccess)&&s.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:s.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:s.jsxs("span",{className:"text-green-600 font-semibold",children:[O.isSuccess&&"Approved!",q.isSuccess&&"Rejected!",Q.isSuccess&&"Updated!"]})})}),F&&s.jsx(S,{annotationLabel:`${t.spanishTerm} (${t.englishTerm})`,onReject:async(e,s)=>{try{await q.mutateAsync({annotationId:t.id,category:e,notes:s}),I(!1),r?.()}catch(a){l("Rejection failed",a instanceof Error?a:{error:a})}},onCancel:()=>I(!1)}),L&&s.jsx(A,{imageUrl:a,initialBox:{...t.boundingBox,shape:"polygon"===t.boundingBox.shape?"rectangle":t.boundingBox.shape},label:t.spanishTerm,onSave:async e=>{try{await U.mutateAsync({annotationId:t.id,updates:{boundingBox:e}}),P(!1),r?.()}catch(s){l("Failed to update bounding box",{error:s?.message||"Unknown error",status:s?.response?.status,data:s?.response?.data});const e=s?.response?.data?.error||s?.message||"Unknown error",t=s?.response?.status;b?b("error",`Failed to save annotation position (${t||"N/A"}): ${e}`):alert(`Failed to save annotation position!\n\nStatus: ${t||"N/A"}\nError: ${e}\n\nCheck browser console (F12) for more details.`)}},onCancel:()=>P(!1)}),$&&s.jsx(D,{annotation:{id:t.id,imageUrl:a,spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,type:t.type,species:t.species||"Bird",boundingBox:t.boundingBox,pronunciation:t.pronunciation,difficultyLevel:t.difficultyLevel},onClose:()=>z(!1)}),R&&s.jsx(B,{annotationId:t.id,annotationLabel:`${t.spanishTerm} (${t.englishTerm})`,onClose:()=>_(!1)})]});var J},L={all:["annotation-analytics"],analytics:()=>[...L.all,"data"]},P=()=>r({queryKey:L.analytics(),queryFn:async()=>{try{return(await c.get("/api/ai/annotations/analytics")).data}catch(e){return l("Error fetching annotation analytics:",e instanceof Error?e:new Error(String(e))),{overview:{total:0,pending:0,approved:0,rejected:0,avgConfidence:"0.00"},bySpecies:{},byType:{},rejectionsByCategory:{},qualityFlags:{tooSmall:0,lowConfidence:0}}}},staleTime:12e4,gcTime:6e5,retry:2}),$=({targetCount:e=400})=>{const{data:t,isLoading:a,error:r}=P();if(a)return s.jsx("div",{className:"flex items-center justify-center p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})});if(r||!t)return s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[s.jsx("p",{className:"text-red-800 font-semibold mb-2",children:"Failed to load analytics"}),s.jsx("p",{className:"text-red-600 text-sm",children:"Please check your connection and try again."})]});const i=t.overview.approved,n=((e,s=400)=>Math.min(100,Math.round(e/s*100)))(i,e),l=t.qualityFlags.tooSmall+t.qualityFlags.lowConfidence;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Annotation Analytics"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dataset quality and review progress metrics"})]}),s.jsxs(j,{variant:"info",size:"lg",children:[t.overview.total," Total Annotations"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(m,{variant:"elevated",children:s.jsx(g,{children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Pending Review"}),s.jsx("p",{className:"text-xs text-gray-500 mb-2 px-2",children:"Annotations awaiting human review decision"}),s.jsx("p",{className:"text-4xl font-bold text-yellow-600",children:t.overview.pending}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(t.overview.pending/t.overview.total*100).toFixed(1),"% of total"]})]})})}),s.jsx(m,{variant:"elevated",children:s.jsx(g,{children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Approved"}),s.jsx("p",{className:"text-xs text-gray-500 mb-2 px-2",children:"Verified annotations ready for dataset"}),s.jsx("p",{className:"text-4xl font-bold text-green-600",children:t.overview.approved}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(t.overview.approved/t.overview.total*100).toFixed(1),"% of total"]})]})})}),s.jsx(m,{variant:"elevated",children:s.jsx(g,{children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Rejected"}),s.jsx("p",{className:"text-xs text-gray-500 mb-2 px-2",children:"Annotations marked as unsuitable"}),s.jsx("p",{className:"text-4xl font-bold text-red-600",children:t.overview.rejected}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(t.overview.rejected/t.overview.total*100).toFixed(1),"% of total"]})]})})}),s.jsx(m,{variant:"elevated",children:s.jsx(g,{children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Avg Confidence"}),s.jsx("p",{className:"text-xs text-gray-500 mb-2 px-2",children:"Average AI confidence score"}),s.jsxs("p",{className:"text-4xl font-bold text-blue-600",children:[(100*parseFloat(t.overview.avgConfidence)).toFixed(0),"%"]}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[parseFloat(t.overview.avgConfidence)>=.8?"High":"Medium"," quality"]})]})})})]}),s.jsxs(m,{variant:"elevated",children:[s.jsx(h,{children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"MVP Dataset Progress"}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Progress toward minimum viable dataset (approved annotations only)"})]})}),s.jsx(g,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("span",{className:"font-medium text-gray-700",children:[s.jsx("span",{className:"text-green-600 font-bold",children:i}),s.jsx("span",{className:"text-gray-500",children:" approved"}),s.jsxs("span",{className:"text-gray-400",children:[" / ",e," target"]})]}),s.jsxs("span",{className:"font-bold text-blue-600",children:[n,"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-500 ease-out",style:{width:`${n}%`}})}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[s.jsx("span",{children:e-i>0?e-i+" more approvals needed":"âœ… MVP target reached!"}),s.jsxs("span",{className:"text-gray-400",children:["(",t.overview.total," total, ",t.overview.pending," pending review)"]})]})]})})]}),l>0&&s.jsxs(m,{variant:"elevated",children:[s.jsx(h,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quality Flags"}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Potential issues detected requiring review"})]}),s.jsxs(j,{variant:"warning",size:"sm",children:[l," Issues Detected"]})]})}),s.jsx(g,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.qualityFlags.tooSmall>0&&s.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"âš ï¸ Too Small (<2%)"}),s.jsx("p",{className:"text-xs text-yellow-700",children:"Bounding boxes covering less than 2% of image area"})]}),s.jsx("span",{className:"text-2xl font-bold text-yellow-600",children:t.qualityFlags.tooSmall})]}),s.jsx("p",{className:"text-xs text-yellow-800 mt-2",children:"ðŸ’¡ Small boxes may indicate distant birds or images needing close-up shots"})]}),t.qualityFlags.lowConfidence>0&&s.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"âš ï¸ Low Confidence (<70%)"}),s.jsx("p",{className:"text-xs text-red-700",children:"AI confidence score below recommended threshold"})]}),s.jsx("span",{className:"text-2xl font-bold text-red-600",children:t.qualityFlags.lowConfidence})]}),s.jsx("p",{className:"text-xs text-red-800 mt-2",children:"ðŸ’¡ May indicate unclear images or difficult angles - review carefully"})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(m,{variant:"elevated",children:[s.jsx(h,{children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Species Coverage"}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Distribution of annotations across bird species"})]})}),s.jsx(g,{children:Object.keys(t.bySpecies).length>0?s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Object.entries(t.bySpecies).sort(([,e],[,s])=>s-e).map(([e,t])=>s.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:e}),s.jsxs(j,{variant:"info",size:"sm",children:[t," annotations"]})]},e))}):s.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No species data available"})})]}),s.jsxs(m,{variant:"elevated",children:[s.jsx(h,{children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Annotation Types"}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Breakdown by annotation type (whole_bird, bounding_box, polygon)"})]})}),s.jsx(g,{children:Object.keys(t.byType).length>0?s.jsx("div",{className:"space-y-3",children:Object.entries(t.byType).sort(([,e],[,s])=>s-e).map(([e,a])=>{const r=a/t.overview.pending*100;return s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"font-medium text-gray-700 capitalize",children:e.replace("_"," ")}),s.jsxs("span",{className:"text-gray-600",children:[a," (",r.toFixed(1),"%)"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${r}%`}})})]},e)})}):s.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No type distribution data available"})})]})]}),Object.keys(t.rejectionsByCategory).length>0&&s.jsxs(m,{variant:"elevated",children:[s.jsx(h,{children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rejection Categories"}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Common reasons for rejected annotations"})]})}),s.jsx(g,{children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.entries(t.rejectionsByCategory).sort(([,e],[,s])=>s-e).map(([e,t])=>s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium text-red-900",children:e.replace(/_/g," ")}),s.jsx(j,{variant:"danger",size:"sm",children:t})]})},e))})})]})]})},z=()=>{const{user:r,loading:i}=d(),{data:n,isLoading:l,error:o,refetch:c}=N(),{data:x}=w(),{toasts:m,addToast:h,removeToast:g}=y(),[u,p]=e.useState("pending"),[b,j]=e.useState("newest"),[f,C]=e.useState(new Set),[k,T]=e.useState("review"),S=n||[],A=t.useMemo(()=>S.length?[...S].sort((e,s)=>{switch(b){case"newest":return new Date(s.createdAt||0).getTime()-new Date(e.createdAt||0).getTime();case"oldest":return new Date(e.createdAt||0).getTime()-new Date(s.createdAt||0).getTime();case"confidence-high":return(s.confidenceScore??0)-(e.confidenceScore??0);case"confidence-low":return(e.confidenceScore??0)-(s.confidenceScore??0);case"difficulty-high":return(s.difficultyLevel??1)-(e.difficultyLevel??1);case"difficulty-low":return(e.difficultyLevel??1)-(s.difficultyLevel??1);default:return 0}}):S,[S,b]),E=x?.pending||0,M=x?.approved||0,D=x?.total||0;return i||l?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})}):r?o?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),s.jsx("p",{className:"text-gray-600 mb-4",children:o.message}),s.jsx("button",{onClick:()=>c(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),s.jsxs("div",{className:"flex gap-4 text-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:E}),s.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-3xl font-bold text-green-600",children:M}),s.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-3xl font-bold text-blue-600",children:D}),s.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]}),s.jsxs("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[s.jsx("button",{onClick:()=>T("review"),className:"px-4 py-2 font-medium border-b-2 transition-colors "+("review"===k?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:"Review Annotations"}),s.jsx("button",{onClick:()=>T("analytics"),className:"px-4 py-2 font-medium border-b-2 transition-colors "+("analytics"===k?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:"ðŸ“Š Analytics Dashboard"})]})]})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:"analytics"===k?s.jsx($,{targetCount:400}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsxs("button",{onClick:()=>p("pending"),className:"px-4 py-2 rounded-md font-medium "+("pending"===u?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Pending (",E,")"]}),s.jsxs("button",{onClick:()=>p("all"),className:"px-4 py-2 rounded-md font-medium "+("all"===u?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All (",D,")"]}),s.jsxs("div",{className:"border-l border-gray-300 pl-4 ml-2",children:[s.jsx("label",{htmlFor:"sort-select",className:"sr-only",children:"Sort by"}),s.jsxs("select",{id:"sort-select",value:b,onChange:e=>j(e.target.value),className:"px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsxs("optgroup",{label:"Date",children:[s.jsx("option",{value:"newest",children:"Newest First"}),s.jsx("option",{value:"oldest",children:"Oldest First"})]}),s.jsxs("optgroup",{label:"Confidence",children:[s.jsx("option",{value:"confidence-high",children:"Confidence: High to Low"}),s.jsx("option",{value:"confidence-low",children:"Confidence: Low to High"})]}),s.jsxs("optgroup",{label:"Difficulty",children:[s.jsx("option",{value:"difficulty-high",children:"Difficulty: Hard to Easy"}),s.jsx("option",{value:"difficulty-low",children:"Difficulty: Easy to Hard"})]})]})]})]}),f.size>0&&s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[f.size," selected"]}),s.jsx("button",{onClick:()=>C(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),0===A.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),s.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),s.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:A.map(e=>s.jsx(I,{annotation:e,imageUrl:e.imageUrl||"",onActionComplete:()=>c(),isSelected:f.has(e.id),onSelect:s=>{const t=new Set(f);s?t.add(e.id):t.delete(e.id),C(t)},onToast:h},e.id))})]})}),s.jsx(v,{toasts:m,onRemove:g})]}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),s.jsx(a,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})})};export{z as AdminAnnotationReviewPage,z as default};
