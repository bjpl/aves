var G=t=>{throw TypeError(t)};var I=(t,s,r)=>s.has(t)||G("Cannot "+r);var g=(t,s,r)=>(I(t,s,"read from private field"),r?r.call(t):s.get(t)),k=(t,s,r)=>s.has(t)?G("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,r),q=(t,s,r,a)=>(I(t,s,"write to private field"),a?a.call(t,r):s.set(t,r),r),F=(t,s,r)=>(I(t,s,"access private method"),r);import{S as ee,s as se,h as J,g as te,n as Y,u as R,a as re,b as ae,i as T,e as L,j as e,q as Z}from"./index-BuDiMPS5.js";import{r as v,L as ne}from"./react-vendor-DDsanEFO.js";import{u as ie}from"./useQuery-U1KM0l3Y.js";import{s as _,u as oe}from"./useSupabaseAuth-C93JePuy.js";import{a as V}from"./index-ngrFHoWO.js";var w,$,f,N,S,z,H,X,le=(X=class extends ee{constructor(s,r){super();k(this,S);k(this,w);k(this,$);k(this,f);k(this,N);q(this,w,s),this.setOptions(r),this.bindMethods(),F(this,S,z).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var a;const r=this.options;this.options=g(this,w).defaultMutationOptions(s),se(this.options,r)||g(this,w).getMutationCache().notify({type:"observerOptionsUpdated",mutation:g(this,f),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&J(r.mutationKey)!==J(this.options.mutationKey)?this.reset():((a=g(this,f))==null?void 0:a.state.status)==="pending"&&g(this,f).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=g(this,f))==null||s.removeObserver(this)}onMutationUpdate(s){F(this,S,z).call(this),F(this,S,H).call(this,s)}getCurrentResult(){return g(this,$)}reset(){var s;(s=g(this,f))==null||s.removeObserver(this),q(this,f,void 0),F(this,S,z).call(this),F(this,S,H).call(this)}mutate(s,r){var a;return q(this,N,r),(a=g(this,f))==null||a.removeObserver(this),q(this,f,g(this,w).getMutationCache().build(g(this,w),this.options)),g(this,f).addObserver(this),g(this,f).execute(s)}},w=new WeakMap,$=new WeakMap,f=new WeakMap,N=new WeakMap,S=new WeakSet,z=function(){var r;const s=((r=g(this,f))==null?void 0:r.state)??te();q(this,$,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},H=function(s){Y.batch(()=>{var r,a,i,d,c,n,o,u;if(g(this,N)&&this.hasListeners()){const h=g(this,$).variables,x=g(this,$).context,m={client:g(this,w),meta:this.options.meta,mutationKey:this.options.mutationKey};(s==null?void 0:s.type)==="success"?((a=(r=g(this,N)).onSuccess)==null||a.call(r,s.data,h,x,m),(d=(i=g(this,N)).onSettled)==null||d.call(i,s.data,null,h,x,m)):(s==null?void 0:s.type)==="error"&&((n=(c=g(this,N)).onError)==null||n.call(c,s.error,h,x,m),(u=(o=g(this,N)).onSettled)==null||u.call(o,void 0,s.error,h,x,m))}this.listeners.forEach(h=>{h(g(this,$))})})},X);function B(t,s){const r=R(),[a]=v.useState(()=>new le(r,t));v.useEffect(()=>{a.setOptions(t)},[a,t]);const i=v.useSyncExternalStore(v.useCallback(c=>a.subscribe(Y.batchCalls(c)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d=v.useCallback((c,n)=>{a.mutate(c,n).catch(re)},[a]);if(i.error&&ae(a.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:d,mutateAsync:i.mutate}}const de=()=>ie({queryKey:["annotations","pending"],queryFn:async()=>{T("Fetching pending annotations from Supabase");const{data:t,error:s}=await _.from("ai_annotation_items").select("*").eq("status","pending").order("created_at",{ascending:!1});if(s)throw L("Failed to fetch pending annotations",new Error(s.message)),new Error(s.message);const r=[...new Set((t==null?void 0:t.map(n=>n.image_id))||[])],{data:a,error:i}=await _.from("images").select("id, url").in("id",r);i&&L("Failed to fetch image URLs",new Error(i.message));const d=new Map((a==null?void 0:a.map(n=>[n.id,n.url]))||[]),c=(t==null?void 0:t.map(n=>{var h,x,m;let o=typeof n.bounding_box=="string"?JSON.parse(n.bounding_box):n.bounding_box;o&&o.x!==void 0&&!o.topLeft&&(o={topLeft:{x:o.x,y:o.y},bottomRight:{x:o.x+o.width,y:o.y+o.height},width:o.width,height:o.height});const u={id:n.id,imageId:n.image_id,spanishTerm:n.spanish_term,englishTerm:n.english_term,boundingBox:o,type:n.annotation_type,difficultyLevel:n.difficulty_level,pronunciation:n.pronunciation,confidenceScore:parseFloat(n.confidence.toString()),status:n.status,isVisible:n.status==="approved",createdAt:new Date(n.created_at),updatedAt:new Date(n.created_at),imageUrl:d.get(n.image_id)||""};return console.log("✅ Annotation transformed:",{spanish:n.spanish_term+" → "+u.spanishTerm,bbox_raw:n.bounding_box,bbox_transformed:u.boundingBox,has_topLeft:!!((h=u.boundingBox)!=null&&h.topLeft),has_width:(x=u.boundingBox)==null?void 0:x.width,has_height:(m=u.boundingBox)==null?void 0:m.height}),u}))||[];return T("Pending annotations fetched with image URLs",{count:c.length}),console.log("Final enriched annotations sample:",c[0]),c}}),ce=()=>{const t=R();return B({mutationFn:async({annotationId:s,notes:r})=>{const{data:a,error:i}=await _.from("ai_annotation_items").update({status:"approved"}).eq("id",s).select().single();if(i)throw new Error(i.message);return r&&await _.from("ai_annotation_reviews").insert({annotation_id:s,action:"approved",notes:r}),a},onSuccess:()=>{t.invalidateQueries({queryKey:["annotations"]}),T("Annotation approved successfully")}})},ue=()=>{const t=R();return B({mutationFn:async({annotationId:s,reason:r})=>{const{data:a,error:i}=await _.from("ai_annotation_items").update({status:"rejected"}).eq("id",s).select().single();if(i)throw new Error(i.message);return await _.from("ai_annotation_reviews").insert({annotation_id:s,action:"rejected",notes:r}),a},onSuccess:()=>{t.invalidateQueries({queryKey:["annotations"]}),T("Annotation rejected")}})},he=()=>{const t=R();return B({mutationFn:async({annotationId:s,updates:r})=>{const{data:a,error:i}=await _.from("ai_annotation_items").update({...r,status:"edited"}).eq("id",s).select().single();if(i)throw new Error(i.message);return a},onSuccess:()=>{t.invalidateQueries({queryKey:["annotations"]}),T("Annotation edited successfully")}})},ge=({variant:t="default",padding:s="md",hover:r=!1,className:a="",children:i,...d})=>{const c="bg-white rounded-lg overflow-hidden",n={default:"shadow-sm",elevated:"shadow-lg",outlined:"border border-gray-200",interactive:"shadow-md hover:shadow-xl cursor-pointer transition-all"},o={none:"",sm:"p-3",md:"p-4",lg:"p-6"},u=r?"transform hover:scale-105 transition-transform":"";return e.jsx("div",{className:`${c} ${n[t]} ${o[s]} ${u} ${a}`,...d,children:i})},me=({title:t,subtitle:s,action:r,className:a="",children:i,...d})=>e.jsx("div",{className:`border-b border-gray-100 pb-3 mb-3 ${a}`,...d,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[t&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),s&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s}),i]}),r&&e.jsx("div",{className:"ml-4",children:r})]})}),xe=({className:t="",children:s,...r})=>e.jsx("div",{className:`${t}`,...r,children:s}),be=({align:t="right",className:s="",children:r,...a})=>{const i={left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"};return e.jsx("div",{className:`border-t border-gray-100 pt-3 mt-3 flex ${i[t]} ${s}`,...a,children:r})},C=({variant:t="primary",size:s="md",isLoading:r=!1,fullWidth:a=!1,leftIcon:i,rightIcon:d,children:c,className:n="",disabled:o,...u})=>{const h="inline-flex items-center justify-center font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",x={primary:"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:shadow-xl transform hover:scale-105 focus:ring-blue-500",secondary:"bg-white text-gray-800 shadow-lg hover:shadow-xl transform hover:scale-105 focus:ring-gray-300",danger:"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg focus:ring-red-500",success:"bg-green-500 text-white hover:bg-green-600 hover:shadow-lg focus:ring-green-500",outline:"border-2 border-gray-300 text-gray-700 bg-transparent hover:bg-gray-50 focus:ring-gray-300",ghost:"text-gray-700 bg-transparent hover:bg-gray-100 focus:ring-gray-300"},m={sm:"px-3 py-1.5 text-sm",md:"px-6 py-2.5 text-base",lg:"px-8 py-4 text-lg"},p=a?"w-full":"";return e.jsxs("button",{className:`${h} ${x[t]} ${m[s]} ${p} ${n}`,disabled:o||r,...u,children:[r&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!r&&i&&e.jsx("span",{className:"mr-2",children:i}),c,!r&&d&&e.jsx("span",{className:"ml-2",children:d})]})},W=({variant:t="default",size:s="md",rounded:r=!1,outlined:a=!1,dot:i=!1,className:d="",children:c,...n})=>{const o="inline-flex items-center font-medium transition-colors",u={default:a?"border border-gray-300 text-gray-700 bg-transparent":"bg-gray-100 text-gray-800",primary:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-100 text-blue-800",success:a?"border border-green-300 text-green-700 bg-transparent":"bg-green-100 text-green-800",warning:a?"border border-yellow-300 text-yellow-700 bg-transparent":"bg-yellow-100 text-yellow-800",danger:a?"border border-red-300 text-red-700 bg-transparent":"bg-red-100 text-red-800",info:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-50 text-blue-700"},h={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"},x=r?"rounded-full":"rounded",m={default:"bg-gray-500",primary:"bg-blue-500",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500",info:"bg-blue-500"};return e.jsxs("span",{className:`${o} ${u[t]} ${h[s]} ${x} ${d}`,...n,children:[i&&e.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${m[t]}`}),c]})},M=v.forwardRef(({label:t,error:s,helperText:r,leftIcon:a,rightIcon:i,fullWidth:d=!1,className:c="",disabled:n,...o},u)=>{const h="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1",x="border-gray-300 focus:border-blue-500 focus:ring-blue-500",m="border-red-500 focus:border-red-500 focus:ring-red-500",p="bg-gray-100 cursor-not-allowed",j=d?"w-full":"",y=s?m:x;return e.jsxs("div",{className:`${d?"w-full":""}`,children:[t&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,o.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[a&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:a}),e.jsx("input",{ref:u,className:`${h} ${y} ${j} ${a?"pl-10":""} ${i?"pr-10":""} ${n?p:""} ${c}`,disabled:n,"aria-invalid":!!s,"aria-describedby":s?`${o.id}-error`:r?`${o.id}-helper`:void 0,...o}),i&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:i})]}),s&&e.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${o.id}-error`,role:"alert",children:s}),r&&!s&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${o.id}-helper`,children:r})]})});M.displayName="Input";const pe=v.forwardRef(({label:t,error:s,helperText:r,fullWidth:a=!1,className:i="",disabled:d,...c},n)=>{const o="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y",u="border-gray-300 focus:border-blue-500 focus:ring-blue-500",h="border-red-500 focus:border-red-500 focus:ring-red-500",x="bg-gray-100 cursor-not-allowed",m=a?"w-full":"",p=s?h:u;return e.jsxs("div",{className:`${a?"w-full":""}`,children:[t&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,c.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("textarea",{ref:n,className:`${o} ${p} ${m} ${d?x:""} ${i}`,disabled:d,"aria-invalid":!!s,"aria-describedby":s?`${c.id}-error`:r?`${c.id}-helper`:void 0,...c}),s&&e.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${c.id}-error`,role:"alert",children:s}),r&&!s&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${c.id}-helper`,children:r})]})});pe.displayName="TextArea";const b={all:["ai-annotations"],lists:()=>[...b.all,"list"],list:t=>[...b.lists(),t],pending:()=>[...b.all,"pending"],stats:()=>[...b.all,"stats"]},ye=()=>{const t=R();return B({mutationFn:async s=>(await V.post(`/api/annotations/ai/${s}/approve`)).data.data,onMutate:async s=>{await t.cancelQueries({queryKey:b.all});const r=t.getQueryData(b.pending());return r&&t.setQueryData(b.pending(),r.filter(a=>a.id!==s)),{previousData:r}},onSuccess:()=>{t.invalidateQueries({queryKey:b.all}),t.invalidateQueries({queryKey:b.stats()}),t.invalidateQueries({queryKey:Z.annotations.all})},onError:(s,r,a)=>{a!=null&&a.previousData&&t.setQueryData(b.pending(),a.previousData),L("Error approving annotation",s instanceof Error?s:new Error(String(s)))}})},fe=()=>{const t=R();return B({mutationFn:async({annotationId:s,reason:r})=>(await V.post(`/api/annotations/ai/${s}/reject`,{reason:r})).data.data,onMutate:async({annotationId:s})=>{await t.cancelQueries({queryKey:b.all});const r=t.getQueryData(b.pending());return r&&t.setQueryData(b.pending(),r.filter(a=>a.id!==s)),{previousData:r}},onSuccess:()=>{t.invalidateQueries({queryKey:b.all}),t.invalidateQueries({queryKey:b.stats()})},onError:(s,r,a)=>{a!=null&&a.previousData&&t.setQueryData(b.pending(),a.previousData),L("Error rejecting annotation",s instanceof Error?s:new Error(String(s)))}})},ve=()=>{const t=R();return B({mutationFn:async({annotationId:s,updates:r})=>(await V.patch(`/api/annotations/ai/${s}`,r)).data.data,onSuccess:()=>{t.invalidateQueries({queryKey:b.all}),t.invalidateQueries({queryKey:b.stats()}),t.invalidateQueries({queryKey:Z.annotations.all})},onError:s=>{L("Error editing annotation",s instanceof Error?s:new Error(String(s)))}})},je=({annotation:t,imageUrl:s,onActionComplete:r,isSelected:a=!1,onSelect:i})=>{const[d,c]=v.useState(!1),[n,o]=v.useState({spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,pronunciation:t.pronunciation||""}),[u,h]=v.useState(""),[x,m]=v.useState(!1),p=ye(),j=fe(),y=ve(),D=async()=>{try{await p.mutateAsync(t.id),r==null||r()}catch{}},P=async()=>{try{await j.mutateAsync({annotationId:t.id,reason:u||void 0}),m(!1),h(""),r==null||r()}catch{}},Q=async()=>{try{await y.mutateAsync({annotationId:t.id,updates:n}),c(!1),r==null||r()}catch{}},O=()=>{c(!1),o({spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,pronunciation:t.pronunciation||""})},E=p.isPending||j.isPending||y.isPending,U=l=>l?l>=.8?"success":l>=.6?"warning":"danger":"default";return e.jsxs(ge,{variant:"elevated",className:"mb-4",children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-start justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i&&e.jsx("input",{type:"checkbox",checked:a,onChange:l=>i(l.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",e.jsx("span",{className:"font-medium",children:t.type})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.confidenceScore!==void 0&&e.jsxs(W,{variant:U(t.confidenceScore),size:"sm",children:["Confidence: ",(t.confidenceScore*100).toFixed(1),"%"]}),e.jsxs(W,{variant:"info",size:"sm",children:["Difficulty: ",t.difficultyLevel]})]})]})}),e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden relative bg-gray-900",children:e.jsxs("div",{className:"relative w-full",style:{paddingTop:"75%"},children:[e.jsx("img",{src:s,alt:t.englishTerm,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain"}),t.boundingBox&&t.boundingBox.topLeft&&e.jsx("div",{className:"absolute border-4 border-yellow-400 bg-yellow-400 bg-opacity-10 pointer-events-none",style:{left:`${t.boundingBox.topLeft.x*100}%`,top:`${t.boundingBox.topLeft.y*100}%`,width:`${t.boundingBox.width*100}%`,height:`${t.boundingBox.height*100}%`,boxShadow:"inset 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4)"},children:e.jsx("div",{className:"absolute -top-8 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:t.spanishTerm})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:d?"Edit Annotation Data":"Annotation Data"}),d?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),e.jsx(M,{value:n.spanishTerm,onChange:l=>o({...n,spanishTerm:l.target.value}),placeholder:"Spanish term"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),e.jsx(M,{value:n.englishTerm,onChange:l=>o({...n,englishTerm:l.target.value}),placeholder:"English term"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),e.jsx(M,{value:n.pronunciation,onChange:l=>o({...n,pronunciation:l.target.value}),placeholder:"Pronunciation (optional)"})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",e.jsx("span",{className:"text-base text-gray-900",children:t.spanishTerm})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",e.jsx("span",{className:"text-base text-gray-900",children:t.englishTerm})]}),t.pronunciation&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",e.jsx("span",{className:"text-base text-gray-900 font-mono",children:t.pronunciation})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("h5",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Bounding Box (Normalized 0-1)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-blue-800 font-mono",children:[e.jsxs("div",{children:["X: ",t.boundingBox.topLeft.x.toFixed(2),", Y:"," ",t.boundingBox.topLeft.y.toFixed(2)]}),e.jsxs("div",{children:["W: ",t.boundingBox.width.toFixed(2),", H:"," ",t.boundingBox.height.toFixed(2)]})]})]}),x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),e.jsx(M,{value:u,onChange:l=>h(l.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"danger",size:"sm",onClick:P,isLoading:j.isPending,children:"Confirm Rejection"}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>{m(!1),h("")},children:"Cancel"})]})]})]})]})}),e.jsxs(be,{align:"between",children:[e.jsx("div",{className:"flex gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"success",size:"sm",onClick:Q,isLoading:y.isPending,disabled:E,children:"Save & Approve"}),e.jsx(C,{variant:"ghost",size:"sm",onClick:O,disabled:E,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"success",size:"sm",onClick:D,isLoading:p.isPending,disabled:E,children:"Approve (A)"}),e.jsx(C,{variant:"secondary",size:"sm",onClick:()=>c(!0),disabled:E,children:"Edit"})]})}),!d&&!x&&e.jsx(C,{variant:"danger",size:"sm",onClick:()=>m(!0),disabled:E,children:"Reject (R)"})]}),(p.isSuccess||j.isSuccess||y.isSuccess)&&e.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:e.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:e.jsxs("span",{className:"text-green-600 font-semibold",children:[p.isSuccess&&"Approved!",j.isSuccess&&"Rejected!",y.isSuccess&&"Updated!"]})})})]})},Ce=()=>{const{user:t,loading:s}=oe(),{data:r,isLoading:a,error:i,refetch:d}=de(),c=ce(),n=ue(),o=he(),[u,h]=v.useState("pending"),[x,m]=v.useState("newest"),[p,j]=v.useState(new Set);if(s||a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),e.jsx(ne,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});if(i)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),e.jsx("p",{className:"text-gray-600 mb-4",children:i.message}),e.jsx("button",{onClick:()=>d(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})});const y=r||[],D=y.filter(l=>l.status==="pending").length,P=y.filter(l=>l.status==="approved").length,Q=async(l,A)=>{try{await c.mutateAsync({annotationId:l,notes:A}),d()}catch(K){console.error("Failed to approve annotation:",K)}},O=async(l,A)=>{try{await n.mutateAsync({annotationId:l,reason:A}),d()}catch(K){console.error("Failed to reject annotation:",K)}},E=async(l,A)=>{try{await o.mutateAsync({annotationId:l,updates:A}),d()}catch(K){console.error("Failed to edit annotation:",K)}},U=async()=>{const l=`Approve ${p.size} annotations?`;if(window.confirm(l)){for(const A of p)await Q(A);j(new Set)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),e.jsxs("div",{className:"flex gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:D}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:P}),e.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:y.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>h("pending"),className:`px-4 py-2 rounded-md font-medium ${u==="pending"?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Pending (",D,")"]}),e.jsxs("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-md font-medium ${u==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",y.length,")"]})]}),p.size>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[p.size," selected"]}),e.jsx("button",{onClick:U,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md",children:"Bulk Approve"}),e.jsx("button",{onClick:()=>j(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),e.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:y.map(l=>e.jsx(je,{annotation:l,imageUrl:l.imageUrl||"",onApprove:Q,onReject:O,onEdit:E},l.id))})]})]})};export{Ce as AdminAnnotationReviewPage,Ce as default};
