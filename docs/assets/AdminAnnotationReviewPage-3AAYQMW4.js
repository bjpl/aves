var xe=t=>{throw TypeError(t)};var oe=(t,s,r)=>s.has(t)||xe("Cannot "+r);var p=(t,s,r)=>(oe(t,s,"read from private field"),r?r.call(t):s.get(t)),G=(t,s,r)=>s.has(t)?xe("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,r),V=(t,s,r,a)=>(oe(t,s,"write to private field"),a?a.call(t,r):s.set(t,r),r),W=(t,s,r)=>(oe(t,s,"access private method"),r);import{S as we,s as Ne,h as ue,g as Se,n as he,u as z,a as Ee,b as Ce,i as te,e as K,j as e,q as me}from"./index-D99aAhUI.js";import{r as b,L as Re}from"./react-vendor-DDsanEFO.js";import{u as be}from"./useQuery-CyDQsoRF.js";import{s as U,u as Ae}from"./useSupabaseAuth-xchXdZd5.js";import{a as _e}from"./index-ngrFHoWO.js";var k,P,C,F,L,re,de,ge,$e=(ge=class extends we{constructor(s,r){super();G(this,L);G(this,k);G(this,P);G(this,C);G(this,F);V(this,k,s),this.setOptions(r),this.bindMethods(),W(this,L,re).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var a;const r=this.options;this.options=p(this,k).defaultMutationOptions(s),Ne(this.options,r)||p(this,k).getMutationCache().notify({type:"observerOptionsUpdated",mutation:p(this,C),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&ue(r.mutationKey)!==ue(this.options.mutationKey)?this.reset():((a=p(this,C))==null?void 0:a.state.status)==="pending"&&p(this,C).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=p(this,C))==null||s.removeObserver(this)}onMutationUpdate(s){W(this,L,re).call(this),W(this,L,de).call(this,s)}getCurrentResult(){return p(this,P)}reset(){var s;(s=p(this,C))==null||s.removeObserver(this),V(this,C,void 0),W(this,L,re).call(this),W(this,L,de).call(this)}mutate(s,r){var a;return V(this,F,r),(a=p(this,C))==null||a.removeObserver(this),V(this,C,p(this,k).getMutationCache().build(p(this,k),this.options)),p(this,C).addObserver(this),p(this,C).execute(s)}},k=new WeakMap,P=new WeakMap,C=new WeakMap,F=new WeakMap,L=new WeakSet,re=function(){var r;const s=((r=p(this,C))==null?void 0:r.state)??Se();V(this,P,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},de=function(s){he.batch(()=>{var r,a,l,n,c,o,x,u;if(p(this,F)&&this.hasListeners()){const i=p(this,P).variables,m=p(this,P).context,f={client:p(this,k),meta:this.options.meta,mutationKey:this.options.mutationKey};(s==null?void 0:s.type)==="success"?((a=(r=p(this,F)).onSuccess)==null||a.call(r,s.data,i,m,f),(n=(l=p(this,F)).onSettled)==null||n.call(l,s.data,null,i,m,f)):(s==null?void 0:s.type)==="error"&&((o=(c=p(this,F)).onError)==null||o.call(c,s.error,i,m,f),(u=(x=p(this,F)).onSettled)==null||u.call(x,void 0,s.error,i,m,f))}this.listeners.forEach(i=>{i(p(this,P))})})},ge);function X(t,s){const r=z(),[a]=b.useState(()=>new $e(r,t));b.useEffect(()=>{a.setOptions(t)},[a,t]);const l=b.useSyncExternalStore(b.useCallback(c=>a.subscribe(he.batchCalls(c)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),n=b.useCallback((c,o)=>{a.mutate(c,o).catch(Ee)},[a]);if(l.error&&Ce(a.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:n,mutateAsync:l.mutate}}const Be=()=>be({queryKey:["annotations","pending"],queryFn:async()=>{te("Fetching pending annotations from Supabase");const{data:t,error:s}=await U.from("ai_annotation_items").select("*").eq("status","pending").order("created_at",{ascending:!1});if(s)throw K("Failed to fetch pending annotations",new Error(s.message)),new Error(s.message);const r=[...new Set((t==null?void 0:t.map(o=>o.image_id))||[])],{data:a,error:l}=await U.from("images").select("id, url").in("id",r);l&&K("Failed to fetch image URLs",new Error(l.message));const n=new Map((a==null?void 0:a.map(o=>[o.id,o.url]))||[]),c=(t==null?void 0:t.map(o=>{var i,m,f;let x=typeof o.bounding_box=="string"?JSON.parse(o.bounding_box):o.bounding_box;x&&x.x!==void 0&&!x.topLeft&&(x={topLeft:{x:x.x,y:x.y},bottomRight:{x:x.x+x.width,y:x.y+x.height},width:x.width,height:x.height});const u={id:o.id,imageId:o.image_id,spanishTerm:o.spanish_term,englishTerm:o.english_term,boundingBox:x,type:o.annotation_type,difficultyLevel:o.difficulty_level,pronunciation:o.pronunciation,confidenceScore:parseFloat(o.confidence.toString()),status:o.status,isVisible:o.status==="approved",createdAt:new Date(o.created_at),updatedAt:new Date(o.created_at),imageUrl:n.get(o.image_id)||""};return console.log("✅ Annotation transformed:",{spanish:o.spanish_term+" → "+u.spanishTerm,bbox_raw:o.bounding_box,bbox_transformed:u.boundingBox,has_topLeft:!!((i=u.boundingBox)!=null&&i.topLeft),has_width:(m=u.boundingBox)==null?void 0:m.width,has_height:(f=u.boundingBox)==null?void 0:f.height}),u}))||[];return te("Pending annotations fetched with image URLs",{count:c.length}),console.log("Final enriched annotations sample:",c[0]),c}}),Te=()=>{const t=z();return X({mutationFn:async({annotationId:s,notes:r})=>{const{data:a,error:l}=await U.from("ai_annotation_items").update({status:"approved"}).eq("id",s).select().single();if(l)throw new Error(l.message);return r&&await U.from("ai_annotation_reviews").insert({annotation_id:s,action:"approved",notes:r}),a},onSuccess:()=>{t.invalidateQueries({queryKey:["annotations"]}),te("Annotation approved successfully")}})},ke=()=>{const t=z();return X({mutationFn:async({annotationId:s,reason:r})=>{const{data:a,error:l}=await U.from("ai_annotation_items").update({status:"rejected"}).eq("id",s).select().single();if(l)throw new Error(l.message);return await U.from("ai_annotation_reviews").insert({annotation_id:s,action:"rejected",notes:r}),a},onSuccess:()=>{t.invalidateQueries({queryKey:["annotations"]}),te("Annotation rejected")}})},Fe=()=>{const t=z();return X({mutationFn:async({annotationId:s,updates:r})=>{const{data:a,error:l}=await U.from("ai_annotation_items").update({...r,status:"edited"}).eq("id",s).select().single();if(l)throw new Error(l.message);return a},onSuccess:()=>{t.invalidateQueries({queryKey:["annotations"]}),te("Annotation edited successfully")}})},_=({variant:t="default",padding:s="md",hover:r=!1,className:a="",children:l,...n})=>{const c="bg-white rounded-lg overflow-hidden",o={default:"shadow-sm",elevated:"shadow-lg",outlined:"border border-gray-200",interactive:"shadow-md hover:shadow-xl cursor-pointer transition-all"},x={none:"",sm:"p-3",md:"p-4",lg:"p-6"},u=r?"transform hover:scale-105 transition-transform":"";return e.jsx("div",{className:`${c} ${o[t]} ${x[s]} ${u} ${a}`,...n,children:l})},J=({title:t,subtitle:s,action:r,className:a="",children:l,...n})=>e.jsx("div",{className:`border-b border-gray-100 pb-3 mb-3 ${a}`,...n,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[t&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),s&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s}),l]}),r&&e.jsx("div",{className:"ml-4",children:r})]})}),$=({className:t="",children:s,...r})=>e.jsx("div",{className:`${t}`,...r,children:s}),Le=({align:t="right",className:s="",children:r,...a})=>{const l={left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"};return e.jsx("div",{className:`border-t border-gray-100 pt-3 mt-3 flex ${l[t]} ${s}`,...a,children:r})},I=({variant:t="primary",size:s="md",isLoading:r=!1,fullWidth:a=!1,leftIcon:l,rightIcon:n,children:c,className:o="",disabled:x,...u})=>{const i="inline-flex items-center justify-center font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",m={primary:"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:shadow-xl transform hover:scale-105 focus:ring-blue-500",secondary:"bg-white text-gray-800 shadow-lg hover:shadow-xl transform hover:scale-105 focus:ring-gray-300",danger:"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg focus:ring-red-500",success:"bg-green-500 text-white hover:bg-green-600 hover:shadow-lg focus:ring-green-500",warning:"bg-yellow-500 text-yellow-900 hover:bg-yellow-600 hover:shadow-lg focus:ring-yellow-500",outline:"border-2 border-gray-300 text-gray-700 bg-transparent hover:bg-gray-50 focus:ring-gray-300",ghost:"text-gray-700 bg-transparent hover:bg-gray-100 focus:ring-gray-300"},f={sm:"px-3 py-1.5 text-sm",md:"px-6 py-2.5 text-base",lg:"px-8 py-4 text-lg"},v=a?"w-full":"";return e.jsxs("button",{className:`${i} ${m[t]} ${f[s]} ${v} ${o}`,disabled:x||r,...u,children:[r&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!r&&l&&e.jsx("span",{className:"mr-2",children:l}),c,!r&&n&&e.jsx("span",{className:"ml-2",children:n})]})},q=({variant:t="default",size:s="md",rounded:r=!1,outlined:a=!1,dot:l=!1,className:n="",children:c,...o})=>{const x="inline-flex items-center font-medium transition-colors",u={default:a?"border border-gray-300 text-gray-700 bg-transparent":"bg-gray-100 text-gray-800",primary:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-100 text-blue-800",success:a?"border border-green-300 text-green-700 bg-transparent":"bg-green-100 text-green-800",warning:a?"border border-yellow-300 text-yellow-700 bg-transparent":"bg-yellow-100 text-yellow-800",danger:a?"border border-red-300 text-red-700 bg-transparent":"bg-red-100 text-red-800",info:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-50 text-blue-700"},i={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"},m=r?"rounded-full":"rounded",f={default:"bg-gray-500",primary:"bg-blue-500",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500",info:"bg-blue-500"};return e.jsxs("span",{className:`${x} ${u[t]} ${i[s]} ${m} ${n}`,...o,children:[l&&e.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${f[t]}`}),c]})},ee=b.forwardRef(({label:t,error:s,helperText:r,leftIcon:a,rightIcon:l,fullWidth:n=!1,className:c="",disabled:o,...x},u)=>{const i="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1",m="border-gray-300 focus:border-blue-500 focus:ring-blue-500",f="border-red-500 focus:border-red-500 focus:ring-red-500",v="bg-gray-100 cursor-not-allowed",w=n?"w-full":"",S=s?f:m;return e.jsxs("div",{className:`${n?"w-full":""}`,children:[t&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,x.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[a&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:a}),e.jsx("input",{ref:u,className:`${i} ${S} ${w} ${a?"pl-10":""} ${l?"pr-10":""} ${o?v:""} ${c}`,disabled:o,"aria-invalid":!!s,"aria-describedby":s?`${x.id}-error`:r?`${x.id}-helper`:void 0,...x}),l&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:l})]}),s&&e.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${x.id}-error`,role:"alert",children:s}),r&&!s&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${x.id}-helper`,children:r})]})});ee.displayName="Input";const Me=b.forwardRef(({label:t,error:s,helperText:r,fullWidth:a=!1,className:l="",disabled:n,...c},o)=>{const x="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y",u="border-gray-300 focus:border-blue-500 focus:ring-blue-500",i="border-red-500 focus:border-red-500 focus:ring-red-500",m="bg-gray-100 cursor-not-allowed",f=a?"w-full":"",v=s?i:u;return e.jsxs("div",{className:`${a?"w-full":""}`,children:[t&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,c.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("textarea",{ref:o,className:`${x} ${v} ${f} ${n?m:""} ${l}`,disabled:n,"aria-invalid":!!s,"aria-describedby":s?`${c.id}-error`:r?`${c.id}-helper`:void 0,...c}),s&&e.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${c.id}-error`,role:"alert",children:s}),r&&!s&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${c.id}-helper`,children:r})]})});Me.displayName="TextArea";const De={VITE_API_URL:"https://aves-backend-production.up.railway.app"},pe=window.location.hostname.includes("github.io"),ye=window.location.pathname.includes("/admin"),le=De,fe=le==null?void 0:le.VITE_API_URL;let ae;ye||!pe?ae=fe:ae="";console.log("🔧 Axios Config:",{isGitHubPages:pe,isAdmin:ye,apiUrl:fe,baseURL:ae,pathname:window.location.pathname});const H=_e.create({baseURL:ae,timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!1});H.interceptors.request.use(t=>{var r,a;const s=localStorage.getItem("supabase.auth.token");if(s)try{const l=JSON.parse(s);(r=l==null?void 0:l.currentSession)!=null&&r.access_token&&(t.headers.Authorization=`Bearer ${l.currentSession.access_token}`)}catch(l){console.warn("Failed to parse auth token:",l)}return console.log("🔧 API Request:",(a=t.method)==null?void 0:a.toUpperCase(),t.url,"Base:",t.baseURL),t},t=>Promise.reject(t));H.interceptors.response.use(t=>(console.log("✅ API Response:",t.status,t.config.url),t),t=>{var s,r;return console.error("❌ API Error:",(s=t.response)==null?void 0:s.status,(r=t.config)==null?void 0:r.url,t.message),Promise.reject(t)});const y={all:["ai-annotations"],lists:()=>[...y.all,"list"],list:t=>[...y.lists(),t],pending:()=>[...y.all,"pending"],stats:()=>[...y.all,"stats"]},Oe=()=>{const t=z();return X({mutationFn:async s=>(await H.post(`/api/annotations/ai/${s}/approve`)).data.data,onMutate:async s=>{await t.cancelQueries({queryKey:y.all});const r=t.getQueryData(y.pending());return r&&t.setQueryData(y.pending(),r.filter(a=>a.id!==s)),{previousData:r}},onSuccess:()=>{t.invalidateQueries({queryKey:y.all}),t.invalidateQueries({queryKey:y.stats()}),t.invalidateQueries({queryKey:me.annotations.all})},onError:(s,r,a)=>{a!=null&&a.previousData&&t.setQueryData(y.pending(),a.previousData),K("Error approving annotation",s instanceof Error?s:new Error(String(s)))}})},Ie=()=>{const t=z();return X({mutationFn:async({annotationId:s,category:r,notes:a,reason:l})=>(await H.post(`/api/annotations/ai/${s}/reject`,{category:r,notes:a,reason:l})).data.data,onMutate:async({annotationId:s})=>{await t.cancelQueries({queryKey:y.all});const r=t.getQueryData(y.pending());return r&&t.setQueryData(y.pending(),r.filter(a=>a.id!==s)),{previousData:r}},onSuccess:()=>{t.invalidateQueries({queryKey:y.all}),t.invalidateQueries({queryKey:y.stats()})},onError:(s,r,a)=>{a!=null&&a.previousData&&t.setQueryData(y.pending(),a.previousData),K("Error rejecting annotation",s instanceof Error?s:new Error(String(s)))}})},Pe=()=>{const t=z();return X({mutationFn:async({annotationId:s,updates:r})=>(await H.patch(`/api/annotations/ai/${s}`,r)).data,onMutate:async({annotationId:s,updates:r})=>{await t.cancelQueries({queryKey:y.all});const a=t.getQueryData(y.pending());return a&&t.setQueryData(y.pending(),a.map(l=>l.id===s?{...l,...r}:l)),{previousData:a}},onError:(s,r,a)=>{a!=null&&a.previousData&&t.setQueryData(y.pending(),a.previousData),K("Error updating annotation",s instanceof Error?s:new Error(String(s)))},onSuccess:()=>{t.invalidateQueries({queryKey:y.all}),t.invalidateQueries({queryKey:y.stats()})}})},qe=()=>{const t=z();return X({mutationFn:async({annotationId:s,updates:r})=>(await H.post(`/api/annotations/ai/${s}/edit`,r)).data.data,onSuccess:()=>{t.invalidateQueries({queryKey:y.all}),t.invalidateQueries({queryKey:y.stats()}),t.invalidateQueries({queryKey:me.annotations.all})},onError:s=>{K("Error editing annotation",s instanceof Error?s:new Error(String(s)))}})},Z={NOT_IN_IMAGE:{value:"not_in_image",label:"Feature Not in Image",description:"The identified feature does not exist in this photo",icon:"🚫",severity:"critical",category:"technical"},TOO_SMALL:{value:"too_small",label:"Too Small to See",description:"Feature is too tiny to be useful for learning (<2% of image)",icon:"🔬",severity:"high",category:"technical"},UNCLEAR_BLURRY:{value:"unclear_blurry",label:"Unclear/Blurry",description:"Cannot distinguish feature clearly due to image quality",icon:"👓",severity:"high",category:"technical"},OCCLUDED:{value:"occluded",label:"Blocked/Hidden",description:"Feature is partially or fully obstructed from view",icon:"🌿",severity:"medium",category:"technical"},WRONG_IDENTIFICATION:{value:"wrong_id",label:"Misidentified Feature",description:"AI confused one thing for another (e.g., branch as beak)",icon:"❌",severity:"critical",category:"identification"},WRONG_TERM:{value:"wrong_term",label:"Incorrect Spanish/English Term",description:"Translation or terminology is incorrect",icon:"📚",severity:"high",category:"identification"},DUPLICATE:{value:"duplicate",label:"Duplicate Annotation",description:'Same feature already annotated (e.g., "ala" and "alas")',icon:"📋",severity:"low",category:"identification"},NOT_REPRESENTATIVE:{value:"not_representative",label:"Not a Representative Example",description:"Feature exists but is atypical, unusual angle, or poor teaching example",icon:"🎓",severity:"high",category:"pedagogical"},CONFUSING_FOR_LEARNERS:{value:"confusing",label:"Potentially Confusing",description:"Could mislead learners due to unusual presentation",icon:"😕",severity:"medium",category:"pedagogical"},INAPPROPRIATE_DIFFICULTY:{value:"wrong_difficulty",label:"Inappropriate Difficulty Level",description:"Marked as beginner but should be advanced (or vice versa)",icon:"📊",severity:"low",category:"pedagogical"},BAD_POSITION:{value:"bad_position",label:"Severely Misaligned",description:"Bounding box is >50% off from actual feature location",icon:"🎯",severity:"high",category:"positioning"},BOX_TOO_LARGE:{value:"box_too_large",label:"Box Includes Too Much",description:"Bounding box captures surrounding area, not just feature",icon:"📏",severity:"medium",category:"positioning"},BOX_TOO_SMALL:{value:"box_too_small",label:"Box Cuts Off Feature",description:"Bounding box is too tight, cuts off part of feature",icon:"✂️",severity:"medium",category:"positioning"},OTHER:{value:"other",label:"Other Issue",description:"Other quality issue not listed above",icon:"🤔",severity:"low",category:"other"}},ze=({annotationLabel:t,onReject:s,onCancel:r})=>{const[a,l]=b.useState(null),[n,c]=b.useState(""),o=()=>{a&&s(a,n)},x={technical:Object.values(Z).filter(i=>i.category==="technical"),identification:Object.values(Z).filter(i=>i.category==="identification"),pedagogical:Object.values(Z).filter(i=>i.category==="pedagogical"),positioning:Object.values(Z).filter(i=>i.category==="positioning"),other:Object.values(Z).filter(i=>i.category==="other")},u=i=>{switch(i){case"critical":return"bg-red-100 border-red-300 text-red-800";case"high":return"bg-orange-100 border-orange-300 text-orange-800";case"medium":return"bg-yellow-100 border-yellow-300 text-yellow-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"bg-red-600 text-white px-6 py-4 rounded-t-lg",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Reject Annotation: ",t]}),e.jsx("p",{className:"text-sm text-red-100 mt-1",children:"Select the primary issue with this annotation"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🔧"})," Technical Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.technical.map(i=>e.jsx("button",{onClick:()=>l(i.value),className:`text-left p-3 rounded-lg border-2 transition-all ${a===i.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${u(i.severity)}`}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:i.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.description})]})]})},i.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🤖"})," AI Identification Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.identification.map(i=>e.jsx("button",{onClick:()=>l(i.value),className:`text-left p-3 rounded-lg border-2 transition-all ${a===i.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${u(i.severity)}`}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:i.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.description})]})]})},i.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🎓"})," Educational Quality Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.pedagogical.map(i=>e.jsx("button",{onClick:()=>l(i.value),className:`text-left p-3 rounded-lg border-2 transition-all ${a===i.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${u(i.severity)}`}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:i.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.description})]})]})},i.value))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🎯"})," Positioning Issues"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.positioning.map(i=>e.jsx("button",{onClick:()=>l(i.value),className:`text-left p-3 rounded-lg border-2 transition-all ${a===i.value?"border-red-500 bg-red-50 shadow-md":`border-gray-200 hover:border-red-300 hover:bg-red-50 ${u(i.severity)}`}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:i.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.description})]})]})},i.value))})]}),x.other.map(i=>e.jsx("button",{onClick:()=>l(i.value),className:`w-full text-left p-3 rounded-lg border-2 transition-all ${a===i.value?"border-red-500 bg-red-50 shadow-md":"border-gray-200 hover:border-red-300 hover:bg-red-50 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:i.label}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.description})]})]})},i.value)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:n,onChange:i=>c(i.target.value),placeholder:"Any additional context or details about this rejection...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 h-24 resize-none"})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3 border-t",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:o,disabled:!a,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-md transition-colors",children:a?"✕ Confirm Rejection":"Select a Category"})]})]})})},Qe=({imageUrl:t,initialBox:s,label:r,onSave:a,onCancel:l})=>{const[n,c]=b.useState(s),[o,x]=b.useState(!1),[u,i]=b.useState(null),[m,f]=b.useState({x:0,y:0}),v=b.useRef(null),w=(d,E,R)=>{d.preventDefault(),E==="drag"?x(!0):i(R||null),f({x:d.clientX,y:d.clientY})},S=d=>{if(!v.current||!o&&!u)return;const E=v.current.getBoundingClientRect(),R=(d.clientX-m.x)/E.width,M=(d.clientY-m.y)/E.height;if(o){const j=Math.max(0,Math.min(1-n.width,n.topLeft.x+R)),g=Math.max(0,Math.min(1-n.height,n.topLeft.y+M));c({...n,topLeft:{x:j,y:g},bottomRight:{x:j+n.width,y:g+n.height}})}else if(u){let j={...n};if(u.includes("n")){const g=Math.max(0,Math.min(n.bottomRight.y-.05,n.topLeft.y+M));j.topLeft.y=g,j.height=j.bottomRight.y-g}if(u.includes("s")){const g=Math.max(n.topLeft.y+.05,Math.min(1,n.bottomRight.y+M));j.bottomRight.y=g,j.height=g-j.topLeft.y}if(u.includes("w")){const g=Math.max(0,Math.min(n.bottomRight.x-.05,n.topLeft.x+R));j.topLeft.x=g,j.width=j.bottomRight.x-g}if(u.includes("e")){const g=Math.max(n.topLeft.x+.05,Math.min(1,n.bottomRight.x+R));j.bottomRight.x=g,j.width=g-j.topLeft.x}c(j)}f({x:d.clientX,y:d.clientY})},A=()=>{x(!1),i(null)},B=()=>{c(s)},Y=d=>{d.preventDefault(),d.stopPropagation(),console.log("🔧 BoundingBoxEditor - handleSave called"),console.log("🔧 BoundingBoxEditor - Current box:",n),a(n)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:d=>{d.target===d.currentTarget&&l()},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"bg-gray-800 text-white px-6 py-4 rounded-t-lg",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Adjust Bounding Box - ",r]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Drag the box to move • Drag corners/edges to resize • Click Save when done"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{ref:v,className:"relative bg-gray-900 rounded-lg overflow-hidden select-none",style:{paddingTop:"75%"},onMouseMove:S,onMouseUp:A,onMouseLeave:A,children:[e.jsx("img",{src:t,alt:r,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain pointer-events-none"}),e.jsxs("div",{className:`absolute border-4 bg-yellow-400 bg-opacity-20 ${o?"cursor-move border-green-400":"cursor-move border-yellow-400"}`,style:{left:`${n.topLeft.x*100}%`,top:`${n.topLeft.y*100}%`,width:`${n.width*100}%`,height:`${n.height*100}%`,boxShadow:o?"0 0 30px rgba(34, 197, 94, 0.8)":"0 0 20px rgba(250, 204, 21, 0.6)"},onMouseDown:d=>w(d,"drag"),children:[e.jsx("div",{className:"absolute -top-10 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:r}),e.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-nw-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","nw")}}),e.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-ne-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","ne")}}),e.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-sw-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","sw")}}),e.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-se-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","se")}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-n-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","n")}}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-s-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","s")}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-w-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","w")}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-4 bg-white border-2 border-yellow-600 rounded-full cursor-e-resize hover:scale-150 transition-transform",onMouseDown:d=>{d.stopPropagation(),w(d,"resize","e")}})]})]}),e.jsxs("div",{className:"mt-4 bg-gray-100 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Current Coordinates (Normalized 0-1)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm font-mono",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"X:"})," ",e.jsx("span",{className:"text-blue-600 font-bold",children:n.topLeft.x.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Y:"})," ",e.jsx("span",{className:"text-blue-600 font-bold",children:n.topLeft.y.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"W:"})," ",e.jsx("span",{className:"text-green-600 font-bold",children:n.width.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"H:"})," ",e.jsx("span",{className:"text-green-600 font-bold",children:n.height.toFixed(3)})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 rounded-b-lg flex gap-3",children:[e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),B()},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"↺ Reset to Original"}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),l()},className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:d=>{console.log("🔧 Save button clicked"),Y(d)},className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-md transition-colors shadow-md",children:"💾 Save & Apply"})]})]})})};function Ke(t){return"topLeft"in t?t:{topLeft:{x:t.x,y:t.y},bottomRight:{x:t.x+t.width,y:t.y+t.height},width:t.width,height:t.height}}function Ue(t){if("x"in t&&!("topLeft"in t))return t;const s=t;return{x:s.topLeft.x,y:s.topLeft.y,width:s.width,height:s.height}}const Xe=({annotation:t,imageUrl:s,onActionComplete:r,isSelected:a=!1,onSelect:l})=>{const[n,c]=b.useState(!1),[o,x]=b.useState({spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,pronunciation:t.pronunciation||""}),[u,i]=b.useState(""),[m,f]=b.useState(!1),[v,w]=b.useState(!1),[S,A]=b.useState(!1),[B,Y]=b.useState(t.boundingBox),d=Oe(),E=Ie(),R=qe(),M=Pe(),j=async()=>{try{await d.mutateAsync(t.id),r==null||r()}catch{}},g=async()=>{try{await E.mutateAsync({annotationId:t.id,reason:u||void 0}),f(!1),i(""),r==null||r()}catch{}},T=async()=>{try{await R.mutateAsync({annotationId:t.id,updates:o}),c(!1),r==null||r()}catch{}},D=()=>{c(!1),x({spanishTerm:t.spanishTerm,englishTerm:t.englishTerm,pronunciation:t.pronunciation||""})},O=d.isPending||E.isPending||R.isPending||M.isPending;b.useEffect(()=>{const h=N=>{const Q=N.target;if((Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)&&N.key!=="Escape"||O)return;switch(N.key.toLowerCase()){case"a":!n&&!m&&!v&&!S&&(N.preventDefault(),j());break;case"r":!n&&!m&&!v&&!S&&(N.preventDefault(),w(!0));break;case"e":!n&&!m&&!v&&!S&&(N.preventDefault(),c(!0));break;case"f":!n&&!m&&!v&&!S&&(N.preventDefault(),A(!0));break;case"escape":N.preventDefault(),w(!1),A(!1),f(!1),n&&D();break}};return window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h)}},[n,m,v,S,O]);const je=h=>h?h>=.8?"success":h>=.6?"warning":"danger":"default",ce=()=>{const h=t.boundingBox;return!h||!h.width||!h.height?0:h.width*h.height},ie=ce()<.02,ne=(t.confidenceScore??1)<.7,se=ie||ne;return e.jsxs(_,{variant:"elevated",className:"mb-4",children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-start justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l&&e.jsx("input",{type:"checkbox",checked:a,onChange:h=>l(h.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",e.jsx("span",{className:"font-medium",children:t.type})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.confidenceScore!==void 0&&e.jsxs(q,{variant:je(t.confidenceScore),size:"sm",children:["Confidence: ",(t.confidenceScore*100).toFixed(1),"%"]}),e.jsxs(q,{variant:"info",size:"sm",children:["Difficulty: ",t.difficultyLevel]}),ie&&e.jsxs(q,{variant:"warning",size:"sm",children:["⚠️ Too Small (",(ce()*100).toFixed(1),"%)"]}),ne&&e.jsx(q,{variant:"danger",size:"sm",children:"⚠️ Low Confidence"})]})]})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden relative bg-gray-900",children:e.jsxs("div",{className:"relative w-full",style:{paddingTop:"75%"},children:[e.jsx("img",{src:s,alt:t.englishTerm,crossOrigin:"anonymous",className:"absolute inset-0 w-full h-full object-contain"}),t.boundingBox&&t.boundingBox.topLeft&&e.jsx("div",{className:"absolute border-4 border-yellow-400 bg-yellow-400 bg-opacity-10 pointer-events-none",style:{left:`${t.boundingBox.topLeft.x*100}%`,top:`${t.boundingBox.topLeft.y*100}%`,width:`${t.boundingBox.width*100}%`,height:`${t.boundingBox.height*100}%`,boxShadow:"inset 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 20px rgba(250, 204, 21, 0.4)"},children:e.jsx("div",{className:"absolute -top-8 left-0 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-md text-sm font-bold shadow-lg whitespace-nowrap",children:t.spanishTerm})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:n?"Edit Annotation Data":"Annotation Data"}),n?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),e.jsx(ee,{value:o.spanishTerm,onChange:h=>x({...o,spanishTerm:h.target.value}),placeholder:"Spanish term"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),e.jsx(ee,{value:o.englishTerm,onChange:h=>x({...o,englishTerm:h.target.value}),placeholder:"English term"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),e.jsx(ee,{value:o.pronunciation,onChange:h=>x({...o,pronunciation:h.target.value}),placeholder:"Pronunciation (optional)"})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",e.jsx("span",{className:"text-base text-gray-900",children:t.spanishTerm})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",e.jsx("span",{className:"text-base text-gray-900",children:t.englishTerm})]}),t.pronunciation&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",e.jsx("span",{className:"text-base text-gray-900 font-mono",children:t.pronunciation})]})]}),e.jsxs("div",{className:`rounded-lg p-3 ${se?"bg-yellow-50 border-2 border-yellow-300":"bg-blue-50"}`,children:[e.jsx("h5",{className:`text-xs font-semibold mb-2 ${se?"text-yellow-900":"text-blue-900"}`,children:"Bounding Box (Normalized 0-1)"}),e.jsxs("div",{className:`grid grid-cols-2 gap-2 text-xs font-mono ${se?"text-yellow-800":"text-blue-800"}`,children:[e.jsxs("div",{children:["X: ",t.boundingBox.topLeft.x.toFixed(2),", Y:"," ",t.boundingBox.topLeft.y.toFixed(2)]}),e.jsxs("div",{children:["W: ",t.boundingBox.width.toFixed(2),", H:"," ",t.boundingBox.height.toFixed(2)]})]}),se&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-yellow-300",children:[e.jsx("p",{className:"text-xs text-yellow-900 font-semibold mb-1",children:"💡 Suggested Action:"}),e.jsxs("ul",{className:"text-xs text-yellow-800 space-y-1",children:[ie&&e.jsx("li",{children:'• Consider rejecting: "Too Small (<2% of image)"'}),ne&&e.jsx("li",{children:"• Review carefully: AI confidence below 70%"})]})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),e.jsx(ee,{value:u,onChange:h=>i(h.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"danger",size:"sm",onClick:g,isLoading:E.isPending,children:"Confirm Rejection"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>{f(!1),i("")},children:"Cancel"})]})]})]})]})}),e.jsx(Le,{children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[e.jsx("div",{className:"flex gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"success",size:"sm",onClick:T,isLoading:R.isPending,disabled:O,children:"Save & Approve"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:D,disabled:O,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"success",size:"sm",onClick:j,isLoading:d.isPending,disabled:O,children:"Approve (A)"}),e.jsx(I,{variant:"secondary",size:"sm",onClick:()=>c(!0),disabled:O,children:"Edit (E)"})]})}),!n&&!m&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"warning",size:"sm",onClick:()=>A(!0),disabled:O,children:"🎯 Fix Position (F)"}),e.jsx(I,{variant:"danger",size:"sm",onClick:()=>w(!0),disabled:O,children:"Reject (R)"})]})]})}),(d.isSuccess||E.isSuccess||R.isSuccess)&&e.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:e.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:e.jsxs("span",{className:"text-green-600 font-semibold",children:[d.isSuccess&&"Approved!",E.isSuccess&&"Rejected!",R.isSuccess&&"Updated!"]})})}),v&&e.jsx(ze,{annotationLabel:`${t.spanishTerm} (${t.englishTerm})`,onReject:async(h,N)=>{try{await E.mutateAsync({annotationId:t.id,category:h,notes:N}),w(!1),r==null||r()}catch(Q){console.error("Rejection failed:",Q)}},onCancel:()=>w(!1)}),S&&e.jsx(Qe,{imageUrl:s,initialBox:Ke(t.boundingBox),label:t.spanishTerm,onSave:async h=>{try{console.log("🔧 BBOX Editor - New box from editor:",h);const N=Ue(h);console.log("🔧 BBOX Editor - Converted to backend format:",N),console.log("🔧 BBOX Editor - Sending PATCH to annotation:",t.id);const Q=await M.mutateAsync({annotationId:t.id,updates:{boundingBox:N}});console.log("🔧 BBOX Editor - Update result:",Q),Y(h),A(!1),r==null||r()}catch(N){console.error("❌ Failed to update bounding box:",N),console.error("Error details:",N)}},onCancel:()=>A(!1)})]})},ve={all:["annotation-analytics"],analytics:()=>[...ve.all,"data"]},He=()=>be({queryKey:ve.analytics(),queryFn:async()=>{try{return(await H.get("/api/annotations/analytics")).data}catch(t){return K("Error fetching annotation analytics:",t instanceof Error?t:new Error(String(t))),{overview:{total:0,pending:0,approved:0,rejected:0,avgConfidence:"0.00"},bySpecies:{},byType:{},rejectionsByCategory:{},qualityFlags:{tooSmall:0,lowConfidence:0}}}},staleTime:2*60*1e3,gcTime:10*60*1e3,retry:2}),Ye=(t,s=400)=>Math.min(100,Math.round(t/s*100)),Ge=({targetCount:t=400})=>{const{data:s,isLoading:r,error:a}=He();if(r)return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})});if(a||!s)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-red-800 font-semibold mb-2",children:"Failed to load analytics"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Please check your connection and try again."})]});const l=Ye(s.overview.total,t),n=s.qualityFlags.tooSmall+s.qualityFlags.lowConfidence;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Annotation Analytics"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dataset quality and review progress metrics"})]}),e.jsxs(q,{variant:"info",size:"lg",children:[s.overview.total," Total Annotations"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_,{variant:"elevated",children:e.jsx($,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Pending Review"}),e.jsx("p",{className:"text-4xl font-bold text-yellow-600",children:s.overview.pending}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.pending/s.overview.total*100).toFixed(1),"% of total"]})]})})}),e.jsx(_,{variant:"elevated",children:e.jsx($,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Approved"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:s.overview.approved}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.approved/s.overview.total*100).toFixed(1),"% of total"]})]})})}),e.jsx(_,{variant:"elevated",children:e.jsx($,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Rejected"}),e.jsx("p",{className:"text-4xl font-bold text-red-600",children:s.overview.rejected}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(s.overview.rejected/s.overview.total*100).toFixed(1),"% of total"]})]})})}),e.jsx(_,{variant:"elevated",children:e.jsx($,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Avg Confidence"}),e.jsxs("p",{className:"text-4xl font-bold text-blue-600",children:[(parseFloat(s.overview.avgConfidence)*100).toFixed(0),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[parseFloat(s.overview.avgConfidence)>=.8?"High":"Medium"," quality"]})]})})})]}),e.jsxs(_,{variant:"elevated",children:[e.jsx(J,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Dataset Progress"})}),e.jsx($,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[s.overview.total," / ",t," annotations"]}),e.jsxs("span",{className:"font-bold text-blue-600",children:[l,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-500 ease-out",style:{width:`${l}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600",children:[t-s.overview.total," more annotations needed for MVP dataset"]})]})})]}),n>0&&e.jsxs(_,{variant:"elevated",children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quality Flags"}),e.jsxs(q,{variant:"warning",size:"sm",children:[n," Issues Detected"]})]})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.qualityFlags.tooSmall>0&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900 mb-1",children:"⚠️ Too Small (<2%)"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Bounding boxes covering less than 2% of image area"})]}),e.jsx("span",{className:"text-2xl font-bold text-yellow-600",children:s.qualityFlags.tooSmall})]}),e.jsx("p",{className:"text-xs text-yellow-800 mt-2",children:"💡 Suggestion: Consider rejecting or requesting better images"})]}),s.qualityFlags.lowConfidence>0&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"⚠️ Low Confidence (<70%)"}),e.jsx("p",{className:"text-xs text-red-700",children:"AI confidence score below recommended threshold"})]}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:s.qualityFlags.lowConfidence})]}),e.jsx("p",{className:"text-xs text-red-800 mt-2",children:"💡 Suggestion: Review carefully before approving"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(_,{variant:"elevated",children:[e.jsx(J,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Species Coverage"})}),e.jsx($,{children:Object.keys(s.bySpecies).length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Object.entries(s.bySpecies).sort(([,c],[,o])=>o-c).map(([c,o])=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:c}),e.jsxs(q,{variant:"info",size:"sm",children:[o," annotations"]})]},c))}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No species data available"})})]}),e.jsxs(_,{variant:"elevated",children:[e.jsx(J,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Annotation Types"})}),e.jsx($,{children:Object.keys(s.byType).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(s.byType).sort(([,c],[,o])=>o-c).map(([c,o])=>{const x=o/s.overview.pending*100;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700 capitalize",children:c}),e.jsxs("span",{className:"text-gray-600",children:[o," (",x.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${x}%`}})})]},c)})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No type distribution data available"})})]})]}),Object.keys(s.rejectionsByCategory).length>0&&e.jsxs(_,{variant:"elevated",children:[e.jsx(J,{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rejection Categories"})}),e.jsx($,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.entries(s.rejectionsByCategory).sort(([,c],[,o])=>o-c).map(([c,o])=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-red-900",children:c.replace(/_/g," ")}),e.jsx(q,{variant:"danger",size:"sm",children:o})]})},c))})})]})]})},at=()=>{const{user:t,loading:s}=Ae(),{data:r,isLoading:a,error:l,refetch:n}=Be(),c=Te(),o=ke(),x=Fe(),[u,i]=b.useState("pending"),[m,f]=b.useState("newest"),[v,w]=b.useState(new Set),[S,A]=b.useState("review");if(s||a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),e.jsx(Re,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});if(l)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),e.jsx("p",{className:"text-gray-600 mb-4",children:l.message}),e.jsx("button",{onClick:()=>n(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})});const B=r||[],Y=B.filter(g=>g.status==="pending").length,d=B.filter(g=>g.status==="approved").length,E=async(g,T)=>{try{await c.mutateAsync({annotationId:g,notes:T}),n()}catch(D){console.error("Failed to approve annotation:",D)}},R=async(g,T)=>{try{await o.mutateAsync({annotationId:g,reason:T}),n()}catch(D){console.error("Failed to reject annotation:",D)}},M=async(g,T)=>{try{await x.mutateAsync({annotationId:g,updates:T}),n()}catch(D){console.error("Failed to edit annotation:",D)}},j=async()=>{const g=`Approve ${v.size} annotations?`;if(window.confirm(g)){for(const T of v)await E(T);w(new Set)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),e.jsxs("div",{className:"flex gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:Y}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:d}),e.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:B.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>A("review"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${S==="review"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Review Annotations"}),e.jsx("button",{onClick:()=>A("analytics"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${S==="analytics"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"📊 Analytics Dashboard"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:S==="analytics"?e.jsx(Ge,{targetCount:400}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i("pending"),className:`px-4 py-2 rounded-md font-medium ${u==="pending"?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Pending (",Y,")"]}),e.jsxs("button",{onClick:()=>i("all"),className:`px-4 py-2 rounded-md font-medium ${u==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",B.length,")"]})]}),v.size>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[v.size," selected"]}),e.jsx("button",{onClick:j,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md",children:"Bulk Approve"}),e.jsx("button",{onClick:()=>w(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),B.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),e.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:B.map(g=>e.jsx(Xe,{annotation:g,imageUrl:g.imageUrl||"",onApprove:E,onReject:R,onEdit:M},g.id))})]})})]})};export{at as AdminAnnotationReviewPage,at as default};
