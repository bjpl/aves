import{r as e}from"./react-vendor-D6vaw4E_.js";import{a as t}from"./apiAdapter-4y4I9PLQ.js";import{e as r}from"./index-BgZ62Jpe.js";const s=()=>{const[s,a]=e.useState(null),[n,c]=e.useState(!1),o=e.useCallback(()=>{let e=sessionStorage.getItem("aves-session-id");return e||(e=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("aves-session-id",e)),e},[]),i=e.useCallback(async()=>{c(!0);const e=o();try{const r=await t.progress.get(e);if(r)a({...r,lastActivity:new Date(r.lastActivity),startedAt:new Date(r.startedAt)});else{const r={sessionId:e,termsDiscovered:[],exercisesCompleted:0,correctAnswers:0,incorrectAnswers:0,totalAnswers:0,currentStreak:0,longestStreak:0,lastActivity:new Date,startedAt:new Date,lastUpdated:new Date,vocabularyMastery:{},accuracy:0};a(r),await t.progress.save(r)}}catch(s){r("Error initializing progress",s instanceof Error?s:new Error(String(s))),a({sessionId:e,termsDiscovered:[],exercisesCompleted:0,correctAnswers:0,incorrectAnswers:0,totalAnswers:0,currentStreak:0,longestStreak:0,lastActivity:new Date,startedAt:new Date,lastUpdated:new Date,vocabularyMastery:{},accuracy:0})}finally{c(!1)}},[o]),l=e.useCallback(async e=>{if(s&&!s.termsDiscovered.includes(e)){const r={...s,termsDiscovered:[...s.termsDiscovered,e],lastActivity:new Date};a(r),await t.progress.save(r)}},[s]),u=e.useCallback(async e=>{if(!s)return;const r=e?s.correctAnswers+1:s.correctAnswers,n=e?s.incorrectAnswers:s.incorrectAnswers+1,c=s.totalAnswers+1,o=c>0?Math.round(r/c*100):0,i={...s,exercisesCompleted:s.exercisesCompleted+1,correctAnswers:r,incorrectAnswers:n,totalAnswers:c,accuracy:o,currentStreak:e?s.currentStreak+1:0,longestStreak:e&&s.currentStreak+1>s.longestStreak?s.currentStreak+1:s.longestStreak,lastActivity:new Date};a(i),await t.progress.save(i)},[s]),d=e.useCallback(async(e,r)=>{if(!s)return;const n=s.vocabularyMastery[e]||0,c=r?10:-5,o=Math.max(0,Math.min(100,n+c)),i={...s,vocabularyMastery:{...s.vocabularyMastery,[e]:o},lastActivity:new Date};a(i),await t.progress.save(i)},[s]),w=e.useCallback(()=>{if(!s)return{termsLearned:0,exercisesCompleted:0,accuracy:0,currentStreak:0,longestStreak:0,sessionDuration:0,masteredTerms:0};const e=s.totalAnswers>0?Math.round(s.correctAnswers/s.totalAnswers*100):0,t=Math.round(((new Date).getTime()-new Date(s.startedAt).getTime())/1e3/60),r=Object.values(s.vocabularyMastery).filter(e=>e>=80).length;return{termsLearned:s.termsDiscovered.length,exercisesCompleted:s.exercisesCompleted,accuracy:e,currentStreak:s.currentStreak,longestStreak:s.longestStreak,sessionDuration:t,masteredTerms:r}},[s]),y=e.useCallback(async()=>{const e={sessionId:o(),termsDiscovered:[],exercisesCompleted:0,correctAnswers:0,incorrectAnswers:0,totalAnswers:0,currentStreak:0,longestStreak:0,lastActivity:new Date,startedAt:new Date,lastUpdated:new Date,vocabularyMastery:{},accuracy:0};a(e),await t.progress.save(e)},[o]);return e.useEffect(()=>{i()},[]),{progress:s,loading:n,recordTermDiscovery:l,recordExerciseCompletion:u,updateVocabularyMastery:d,getStats:w,resetProgress:y,sessionId:s?.sessionId||o()}};export{s as u};
