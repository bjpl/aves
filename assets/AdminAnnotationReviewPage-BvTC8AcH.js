var re=Object.defineProperty;var J=r=>{throw TypeError(r)};var ae=(r,e,s)=>e in r?re(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var D=(r,e,s)=>ae(r,typeof e!="symbol"?e+"":e,s),V=(r,e,s)=>e.has(r)||J("Cannot "+s);var p=(r,e,s)=>(V(r,e,"read from private field"),s?s.call(r):e.get(r)),q=(r,e,s)=>e.has(r)?J("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,s),_=(r,e,s,a)=>(V(r,e,"write to private field"),a?a.call(r,s):e.set(r,s),s),P=(r,e,s)=>(V(r,e,"access private method"),s);import{S as ie,s as ne,h as Z,g as le,n as te,u as B,a as oe,b as ce,i as I,e as U,j as t,q as se}from"./index-CKKf47s6.js";import{r as h,L as de}from"./react-vendor-DDsanEFO.js";import{u as ue}from"./useQuery-BfWqMrOW.js";import{s as M,u as he}from"./useSupabaseAuth-7mhfbcGq.js";import{a as G}from"./index-ngrFHoWO.js";var E,$,C,T,F,Y,W,ee,me=(ee=class extends ie{constructor(e,s){super();q(this,F);q(this,E);q(this,$);q(this,C);q(this,T);_(this,E,e),this.setOptions(s),this.bindMethods(),P(this,F,Y).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var a;const s=this.options;this.options=p(this,E).defaultMutationOptions(e),ne(this.options,s)||p(this,E).getMutationCache().notify({type:"observerOptionsUpdated",mutation:p(this,C),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&Z(s.mutationKey)!==Z(this.options.mutationKey)?this.reset():((a=p(this,C))==null?void 0:a.state.status)==="pending"&&p(this,C).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=p(this,C))==null||e.removeObserver(this)}onMutationUpdate(e){P(this,F,Y).call(this),P(this,F,W).call(this,e)}getCurrentResult(){return p(this,$)}reset(){var e;(e=p(this,C))==null||e.removeObserver(this),_(this,C,void 0),P(this,F,Y).call(this),P(this,F,W).call(this)}mutate(e,s){var a;return _(this,T,s),(a=p(this,C))==null||a.removeObserver(this),_(this,C,p(this,E).getMutationCache().build(p(this,E),this.options)),p(this,C).addObserver(this),p(this,C).execute(e)}},E=new WeakMap,$=new WeakMap,C=new WeakMap,T=new WeakMap,F=new WeakSet,Y=function(){var s;const e=((s=p(this,C))==null?void 0:s.state)??le();_(this,$,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},W=function(e){te.batch(()=>{var s,a,n,c,o,l,i,x;if(p(this,T)&&this.hasListeners()){const d=p(this,$).variables,b=p(this,$).context,g={client:p(this,E),meta:this.options.meta,mutationKey:this.options.mutationKey};(e==null?void 0:e.type)==="success"?((a=(s=p(this,T)).onSuccess)==null||a.call(s,e.data,d,b,g),(c=(n=p(this,T)).onSettled)==null||c.call(n,e.data,null,d,b,g)):(e==null?void 0:e.type)==="error"&&((l=(o=p(this,T)).onError)==null||l.call(o,e.error,d,b,g),(x=(i=p(this,T)).onSettled)==null||x.call(i,void 0,e.error,d,b,g))}this.listeners.forEach(d=>{d(p(this,$))})})},ee);function O(r,e){const s=B(),[a]=h.useState(()=>new me(s,r));h.useEffect(()=>{a.setOptions(r)},[a,r]);const n=h.useSyncExternalStore(h.useCallback(o=>a.subscribe(te.batchCalls(o)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),c=h.useCallback((o,l)=>{a.mutate(o,l).catch(oe)},[a]);if(n.error&&ce(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:c,mutateAsync:n.mutate}}const ge=()=>ue({queryKey:["annotations","pending"],queryFn:async()=>{I("Fetching pending annotations from Supabase");const{data:r,error:e}=await M.from("ai_annotation_items").select("*").eq("status","pending").order("created_at",{ascending:!1});if(e)throw U("Failed to fetch pending annotations",new Error(e.message)),new Error(e.message);const s=[...new Set((r==null?void 0:r.map(l=>l.image_id))||[])],{data:a,error:n}=await M.from("images").select("id, url").in("id",s);n&&U("Failed to fetch image URLs",new Error(n.message));const c=new Map((a==null?void 0:a.map(l=>[l.id,l.url]))||[]),o=(r==null?void 0:r.map(l=>{let i=typeof l.bounding_box=="string"?JSON.parse(l.bounding_box):l.bounding_box;return i&&i.x!==void 0&&!i.topLeft&&(i={topLeft:{x:i.x,y:i.y},bottomRight:{x:i.x+i.width,y:i.y+i.height},width:i.width,height:i.height}),{id:l.id,imageId:l.image_id,spanishTerm:l.spanish_term,englishTerm:l.english_term,boundingBox:i,type:l.annotation_type,difficultyLevel:l.difficulty_level,pronunciation:l.pronunciation,confidenceScore:parseFloat(l.confidence.toString()),status:l.status,isVisible:l.status==="approved",createdAt:new Date(l.created_at),updatedAt:new Date(l.created_at),imageUrl:c.get(l.image_id)||""}}))||[];return I("Pending annotations fetched with image URLs",{count:o.length}),o}}),xe=()=>{const r=B();return O({mutationFn:async({annotationId:e,notes:s})=>{const{data:a,error:n}=await M.from("ai_annotation_items").update({status:"approved"}).eq("id",e).select().single();if(n)throw new Error(n.message);return s&&await M.from("ai_annotation_reviews").insert({annotation_id:e,action:"approved",notes:s}),a},onSuccess:()=>{r.invalidateQueries({queryKey:["annotations"]}),I("Annotation approved successfully")}})},fe=()=>{const r=B();return O({mutationFn:async({annotationId:e,reason:s})=>{const{data:a,error:n}=await M.from("ai_annotation_items").update({status:"rejected"}).eq("id",e).select().single();if(n)throw new Error(n.message);return await M.from("ai_annotation_reviews").insert({annotation_id:e,action:"rejected",notes:s}),a},onSuccess:()=>{r.invalidateQueries({queryKey:["annotations"]}),I("Annotation rejected")}})},ye=()=>{const r=B();return O({mutationFn:async({annotationId:e,updates:s})=>{const{data:a,error:n}=await M.from("ai_annotation_items").update({...s,status:"edited"}).eq("id",e).select().single();if(n)throw new Error(n.message);return a},onSuccess:()=>{r.invalidateQueries({queryKey:["annotations"]}),I("Annotation edited successfully")}})},pe=({variant:r="default",padding:e="md",hover:s=!1,className:a="",children:n,...c})=>{const o="bg-white rounded-lg overflow-hidden",l={default:"shadow-sm",elevated:"shadow-lg",outlined:"border border-gray-200",interactive:"shadow-md hover:shadow-xl cursor-pointer transition-all"},i={none:"",sm:"p-3",md:"p-4",lg:"p-6"},x=s?"transform hover:scale-105 transition-transform":"";return t.jsx("div",{className:`${o} ${l[r]} ${i[e]} ${x} ${a}`,...c,children:n})},be=({title:r,subtitle:e,action:s,className:a="",children:n,...c})=>t.jsx("div",{className:`border-b border-gray-100 pb-3 mb-3 ${a}`,...c,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[r&&t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r}),e&&t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e}),n]}),s&&t.jsx("div",{className:"ml-4",children:s})]})}),ve=({className:r="",children:e,...s})=>t.jsx("div",{className:`${r}`,...s,children:e}),we=({align:r="right",className:e="",children:s,...a})=>{const n={left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"};return t.jsx("div",{className:`border-t border-gray-100 pt-3 mt-3 flex ${n[r]} ${e}`,...a,children:s})},L=({variant:r="primary",size:e="md",isLoading:s=!1,fullWidth:a=!1,leftIcon:n,rightIcon:c,children:o,className:l="",disabled:i,...x})=>{const d="inline-flex items-center justify-center font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",b={primary:"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:shadow-xl transform hover:scale-105 focus:ring-blue-500",secondary:"bg-white text-gray-800 shadow-lg hover:shadow-xl transform hover:scale-105 focus:ring-gray-300",danger:"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg focus:ring-red-500",success:"bg-green-500 text-white hover:bg-green-600 hover:shadow-lg focus:ring-green-500",outline:"border-2 border-gray-300 text-gray-700 bg-transparent hover:bg-gray-50 focus:ring-gray-300",ghost:"text-gray-700 bg-transparent hover:bg-gray-100 focus:ring-gray-300"},g={sm:"px-3 py-1.5 text-sm",md:"px-6 py-2.5 text-base",lg:"px-8 py-4 text-lg"},m=a?"w-full":"";return t.jsxs("button",{className:`${d} ${b[r]} ${g[e]} ${m} ${l}`,disabled:i||s,...x,children:[s&&t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!s&&n&&t.jsx("span",{className:"mr-2",children:n}),o,!s&&c&&t.jsx("span",{className:"ml-2",children:c})]})},H=({variant:r="default",size:e="md",rounded:s=!1,outlined:a=!1,dot:n=!1,className:c="",children:o,...l})=>{const i="inline-flex items-center font-medium transition-colors",x={default:a?"border border-gray-300 text-gray-700 bg-transparent":"bg-gray-100 text-gray-800",primary:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-100 text-blue-800",success:a?"border border-green-300 text-green-700 bg-transparent":"bg-green-100 text-green-800",warning:a?"border border-yellow-300 text-yellow-700 bg-transparent":"bg-yellow-100 text-yellow-800",danger:a?"border border-red-300 text-red-700 bg-transparent":"bg-red-100 text-red-800",info:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-50 text-blue-700"},d={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"},b=s?"rounded-full":"rounded",g={default:"bg-gray-500",primary:"bg-blue-500",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500",info:"bg-blue-500"};return t.jsxs("span",{className:`${i} ${x[r]} ${d[e]} ${b} ${c}`,...l,children:[n&&t.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${g[r]}`}),o]})},Q=h.forwardRef(({label:r,error:e,helperText:s,leftIcon:a,rightIcon:n,fullWidth:c=!1,className:o="",disabled:l,...i},x)=>{const d="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1",b="border-gray-300 focus:border-blue-500 focus:ring-blue-500",g="border-red-500 focus:border-red-500 focus:ring-red-500",m="bg-gray-100 cursor-not-allowed",v=c?"w-full":"",f=e?g:b;return t.jsxs("div",{className:`${c?"w-full":""}`,children:[r&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r,i.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[a&&t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:a}),t.jsx("input",{ref:x,className:`${d} ${f} ${v} ${a?"pl-10":""} ${n?"pr-10":""} ${l?m:""} ${o}`,disabled:l,"aria-invalid":!!e,"aria-describedby":e?`${i.id}-error`:s?`${i.id}-helper`:void 0,...i}),n&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:n})]}),e&&t.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${i.id}-error`,role:"alert",children:e}),s&&!e&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${i.id}-helper`,children:s})]})});Q.displayName="Input";const je=h.forwardRef(({label:r,error:e,helperText:s,fullWidth:a=!1,className:n="",disabled:c,...o},l)=>{const i="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y",x="border-gray-300 focus:border-blue-500 focus:ring-blue-500",d="border-red-500 focus:border-red-500 focus:ring-red-500",b="bg-gray-100 cursor-not-allowed",g=a?"w-full":"",m=e?d:x;return t.jsxs("div",{className:`${a?"w-full":""}`,children:[r&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r,o.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("textarea",{ref:l,className:`${i} ${m} ${g} ${c?b:""} ${n}`,disabled:c,"aria-invalid":!!e,"aria-describedby":e?`${o.id}-error`:s?`${o.id}-helper`:void 0,...o}),e&&t.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${o.id}-error`,role:"alert",children:e}),s&&!e&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${o.id}-helper`,children:s})]})});je.displayName="TextArea";class Ne{constructor(){D(this,"dirtyRects",[]);D(this,"isDirty",!1)}markDirty(e,s,a,n){this.dirtyRects.push({x:e,y:s,width:a,height:n}),this.isDirty=!0}markFullDirty(e,s){this.dirtyRects=[{x:0,y:0,width:e,height:s}],this.isDirty=!0}getDirtyRegions(){return this.dirtyRects}clear(){this.dirtyRects=[],this.isDirty=!1}hasDirtyRegions(){return this.isDirty}optimize(){if(this.dirtyRects.length<=1)return;const e=[],s=[...this.dirtyRects].sort((n,c)=>n.x-c.x);let a=s[0];for(let n=1;n<s.length;n++){const c=s[n];this.rectanglesOverlap(a,c)?a=this.mergeRectangles(a,c):(e.push(a),a=c)}e.push(a),this.dirtyRects=e}rectanglesOverlap(e,s){return!(e.x+e.width<s.x||s.x+s.width<e.x||e.y+e.height<s.y||s.y+s.height<e.y)}mergeRectangles(e,s){const a=Math.min(e.x,s.x),n=Math.min(e.y,s.y),c=Math.max(e.x+e.width,s.x+s.width)-a,o=Math.max(e.y+e.height,s.y+s.height)-n;return{x:a,y:n,width:c,height:o}}}class Se{constructor(){D(this,"frameTimestamps",[]);D(this,"drawCallCount",0);D(this,"lastReportTime",0);D(this,"sampleSize",60)}recordFrame(e){this.frameTimestamps.push(e),this.frameTimestamps.length>this.sampleSize&&this.frameTimestamps.shift()}recordDrawCall(){this.drawCallCount++}getCurrentFPS(){if(this.frameTimestamps.length<2)return 0;const e=this.frameTimestamps[this.frameTimestamps.length-1]-this.frameTimestamps[0],s=this.frameTimestamps.length-1;return Math.round(s/e*1e3)}getAverageFPS(){if(this.frameTimestamps.length<2)return 0;const e=[];for(let a=1;a<this.frameTimestamps.length;a++)e.push(this.frameTimestamps[a]-this.frameTimestamps[a-1]);const s=e.reduce((a,n)=>a+n,0)/e.length;return Math.round(1e3/s)}getDrawCallCount(){return this.drawCallCount}getMetrics(){return{currentFPS:this.getCurrentFPS(),averageFPS:this.getAverageFPS(),drawCalls:this.drawCallCount,frameCount:this.frameTimestamps.length}}reset(){this.frameTimestamps=[],this.drawCallCount=0,this.lastReportTime=0}shouldReport(e,s=5e3){return e-this.lastReportTime>=s?(this.lastReportTime=e,!0):!1}}const Ce=(r,e=16)=>{const s=h.useRef();return h.useCallback(a=>{s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{r(a)},e)},[r,e])},Re=({imageUrl:r,onImageLoad:e,performanceMonitor:s})=>{const a=h.useRef(null),n=h.useRef(null),c=h.useCallback(o=>{const l=a.current;if(!l)return;const i=l.getContext("2d",{alpha:!1});i&&(l.width=o.width,l.height=o.height,performance.mark("static-layer-start"),i.drawImage(o,0,0),performance.mark("static-layer-end"),performance.measure("static-layer-render","static-layer-start","static-layer-end"),s.recordDrawCall())},[s]);return h.useEffect(()=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{n.current=o,c(o),e(o,{width:o.width,height:o.height})},o.src=r},[r,c,e]),t.jsx("canvas",{ref:a,className:"max-w-full h-auto",style:{position:"absolute",top:0,left:0,width:"100%",zIndex:1,pointerEvents:"none"}})},ke={anatomical:"#3B82F6",behavioral:"#10B981",color:"#F59E0B",pattern:"#8B5CF6"},Ee=({annotations:r,dimensions:e,showLabels:s,imageLoaded:a,performanceMonitor:n})=>{const c=h.useRef(null),o=h.useCallback(()=>{const l=c.current;if(!l||!a)return;const i=l.getContext("2d",{alpha:!0});i&&(l.width=e.width,l.height=e.height,performance.mark("interactive-layer-start"),i.clearRect(0,0,l.width,l.height),r.forEach(x=>{const{boundingBox:d,type:b}=x,g=ke[b]||"#3B82F6";i.strokeStyle=g,i.lineWidth=2,i.setLineDash([5,5]);const m=d.topLeft.x,v=d.topLeft.y,f=d.width,k=d.height;i.strokeRect(m,v,f,k),s&&(i.fillStyle=g,i.globalAlpha=.9,i.fillRect(m,v-25,f,25),i.globalAlpha=1,i.fillStyle="white",i.font="14px system-ui, -apple-system, sans-serif",i.textBaseline="middle",i.fillText(x.spanishTerm,m+5,v-12)),i.setLineDash([])}),performance.mark("interactive-layer-end"),performance.measure("interactive-layer-render","interactive-layer-start","interactive-layer-end"),n.recordDrawCall())},[r,e,a,s,n]);return h.useEffect(()=>{o()},[o]),t.jsx("canvas",{ref:c,className:"max-w-full h-auto",style:{position:"absolute",top:0,left:0,width:"100%",zIndex:2,pointerEvents:"none"}})},Te={anatomical:"#3B82F6",behavioral:"#10B981",color:"#F59E0B",pattern:"#8B5CF6"},Fe=({hoveredAnnotation:r,dimensions:e,imageLoaded:s,performanceMonitor:a})=>{const n=h.useRef(null),c=h.useRef(),o=h.useCallback(()=>{const l=n.current;if(!l||!s)return;const i=l.getContext("2d",{alpha:!0});if(!i)return;l.width=e.width,l.height=e.height,performance.mark("hover-layer-start");const x=()=>{if(i.clearRect(0,0,l.width,l.height),r){const{boundingBox:d,type:b}=r,g=Te[b]||"#3B82F6";i.strokeStyle=g,i.lineWidth=3,i.shadowColor=g,i.shadowBlur=10;const m=d.topLeft.x,v=d.topLeft.y,f=d.width,k=d.height;i.strokeRect(m,v,f,k),i.shadowBlur=0,i.fillStyle=g,i.globalAlpha=.95,i.fillRect(m,v-30,Math.max(f,150),30),i.globalAlpha=1,i.fillStyle="white",i.font="bold 14px system-ui, -apple-system, sans-serif",i.textBaseline="middle",i.fillText(r.spanishTerm,m+8,v-15)}if(performance.mark("hover-layer-end"),performance.measure("hover-layer-render","hover-layer-start","hover-layer-end"),a.recordDrawCall(),a.recordFrame(performance.now()),a.shouldReport(performance.now())){const d=a.getMetrics();console.log("[Canvas Performance]",{fps:d.currentFPS,avgFPS:d.averageFPS,drawCalls:d.drawCalls,frames:d.frameCount})}};c.current&&cancelAnimationFrame(c.current),c.current=requestAnimationFrame(x)},[r,e,s,a]);return h.useEffect(()=>{o()},[o]),h.useEffect(()=>()=>{c.current&&cancelAnimationFrame(c.current)},[]),t.jsx("canvas",{ref:n,className:"max-w-full h-auto",style:{position:"absolute",top:0,left:0,width:"100%",zIndex:3,pointerEvents:"auto"}})},$e=({imageUrl:r,annotations:e,onAnnotationHover:s,onAnnotationClick:a,interactive:n=!0,showLabels:c=!1})=>{const[o,l]=h.useState({width:0,height:0}),[i,x]=h.useState(null),[d,b]=h.useState(!1),g=h.useMemo(()=>new Se,[]),m=h.useMemo(()=>new Ne,[]),v=h.useCallback((y,w)=>{l(w),b(!0)},[]),f=y=>{for(const w of e){const{boundingBox:u}=w,{topLeft:N,width:R,height:S}=u;if(y.x>=N.x&&y.x<=N.x+R&&y.y>=N.y&&y.y<=N.y+S)return w}return null},k=h.useCallback(y=>{if(!n)return;const w=y.currentTarget.getBoundingClientRect(),u=o.width/w.width,N=o.height/w.height,R={x:(y.clientX-w.left)*u,y:(y.clientY-w.top)*N},S=f(R);if(S!==i){if(x(S),s==null||s(S),S){const{boundingBox:X}=S;m.markDirty(X.topLeft.x,X.topLeft.y-30,Math.max(X.width,150),X.height+30)}else m.markFullDirty(o.width,o.height);y.currentTarget.style.cursor=S?"pointer":"default"}},[n,o,i,s,m,f]),z=Ce(k,16),A=h.useCallback(y=>{if(!n)return;const w=y.currentTarget.getBoundingClientRect(),u=o.width/w.width,N=o.height/w.height,R={x:(y.clientX-w.left)*u,y:(y.clientY-w.top)*N},S=f(R);S&&(a==null||a(S),m.markDirty(S.boundingBox.topLeft.x,S.boundingBox.topLeft.y,S.boundingBox.width,S.boundingBox.height))},[n,o,a,m,f]),K=h.useCallback(()=>{x(null),s==null||s(null),m.markFullDirty(o.width,o.height)},[s,o,m]);return t.jsxs("div",{className:"relative inline-block max-w-full",onMouseMove:z,onClick:y=>A(y),onMouseLeave:K,children:[t.jsx(Re,{imageUrl:r,onImageLoad:v,performanceMonitor:g}),t.jsx(Ee,{annotations:e,dimensions:o,showLabels:c,imageLoaded:d,performanceMonitor:g}),t.jsx(Fe,{hoveredAnnotation:i,dimensions:o,imageLoaded:d,performanceMonitor:g}),t.jsx("div",{style:{width:o.width||"auto",height:o.height||"auto",visibility:"hidden"}}),!d&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:t.jsx("div",{className:"text-gray-500",children:"Cargando imagen..."})})]})},j={all:["ai-annotations"],lists:()=>[...j.all,"list"],list:r=>[...j.lists(),r],pending:()=>[...j.all,"pending"],stats:()=>[...j.all,"stats"]},De=()=>{const r=B();return O({mutationFn:async e=>(await G.post(`/api/annotations/ai/${e}/approve`)).data.data,onMutate:async e=>{await r.cancelQueries({queryKey:j.all});const s=r.getQueryData(j.pending());return s&&r.setQueryData(j.pending(),s.filter(a=>a.id!==e)),{previousData:s}},onSuccess:()=>{r.invalidateQueries({queryKey:j.all}),r.invalidateQueries({queryKey:j.stats()}),r.invalidateQueries({queryKey:se.annotations.all})},onError:(e,s,a)=>{a!=null&&a.previousData&&r.setQueryData(j.pending(),a.previousData),U("Error approving annotation",e instanceof Error?e:new Error(String(e)))}})},Le=()=>{const r=B();return O({mutationFn:async({annotationId:e,reason:s})=>(await G.post(`/api/annotations/ai/${e}/reject`,{reason:s})).data.data,onMutate:async({annotationId:e})=>{await r.cancelQueries({queryKey:j.all});const s=r.getQueryData(j.pending());return s&&r.setQueryData(j.pending(),s.filter(a=>a.id!==e)),{previousData:s}},onSuccess:()=>{r.invalidateQueries({queryKey:j.all}),r.invalidateQueries({queryKey:j.stats()})},onError:(e,s,a)=>{a!=null&&a.previousData&&r.setQueryData(j.pending(),a.previousData),U("Error rejecting annotation",e instanceof Error?e:new Error(String(e)))}})},Me=()=>{const r=B();return O({mutationFn:async({annotationId:e,updates:s})=>(await G.patch(`/api/annotations/ai/${e}`,s)).data.data,onSuccess:()=>{r.invalidateQueries({queryKey:j.all}),r.invalidateQueries({queryKey:j.stats()}),r.invalidateQueries({queryKey:se.annotations.all})},onError:e=>{U("Error editing annotation",e instanceof Error?e:new Error(String(e)))}})},Be=({annotation:r,imageUrl:e,onActionComplete:s,isSelected:a=!1,onSelect:n})=>{const[c,o]=h.useState(!1),[l,i]=h.useState({spanishTerm:r.spanishTerm,englishTerm:r.englishTerm,pronunciation:r.pronunciation||""}),[x,d]=h.useState(""),[b,g]=h.useState(!1),m=De(),v=Le(),f=Me(),k=async()=>{try{await m.mutateAsync(r.id),s==null||s()}catch{}},z=async()=>{try{await v.mutateAsync({annotationId:r.id,reason:x||void 0}),g(!1),d(""),s==null||s()}catch{}},A=async()=>{try{await f.mutateAsync({annotationId:r.id,updates:l}),o(!1),s==null||s()}catch{}},K=()=>{o(!1),i({spanishTerm:r.spanishTerm,englishTerm:r.englishTerm,pronunciation:r.pronunciation||""})},y=m.isPending||v.isPending||f.isPending,w=u=>u?u>=.8?"success":u>=.6?"warning":"danger":"default";return t.jsxs(pe,{variant:"elevated",className:"mb-4",children:[t.jsx(be,{children:t.jsxs("div",{className:"flex items-start justify-between w-full",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[n&&t.jsx("input",{type:"checkbox",checked:a,onChange:u=>n(u.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",t.jsx("span",{className:"font-medium",children:r.type})]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[r.confidenceScore!==void 0&&t.jsxs(H,{variant:w(r.confidenceScore),size:"sm",children:["Confidence: ",(r.confidenceScore*100).toFixed(1),"%"]}),t.jsxs(H,{variant:"info",size:"sm",children:["Difficulty: ",r.difficultyLevel]})]})]})}),t.jsx(ve,{children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),t.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:t.jsx($e,{imageUrl:e,annotations:[r],interactive:!1,showLabels:!0})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:c?"Edit Annotation Data":"Annotation Data"}),c?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),t.jsx(Q,{value:l.spanishTerm,onChange:u=>i({...l,spanishTerm:u.target.value}),placeholder:"Spanish term"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),t.jsx(Q,{value:l.englishTerm,onChange:u=>i({...l,englishTerm:u.target.value}),placeholder:"English term"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),t.jsx(Q,{value:l.pronunciation,onChange:u=>i({...l,pronunciation:u.target.value}),placeholder:"Pronunciation (optional)"})]})]}):t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",t.jsx("span",{className:"text-base text-gray-900",children:r.spanishTerm})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",t.jsx("span",{className:"text-base text-gray-900",children:r.englishTerm})]}),r.pronunciation&&t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",t.jsx("span",{className:"text-base text-gray-900 font-mono",children:r.pronunciation})]})]}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[t.jsx("h5",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Bounding Box"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-blue-800",children:[t.jsxs("div",{children:["X: ",r.boundingBox.topLeft.x.toFixed(0),", Y:"," ",r.boundingBox.topLeft.y.toFixed(0)]}),t.jsxs("div",{children:["W: ",r.boundingBox.width.toFixed(0),", H:"," ",r.boundingBox.height.toFixed(0)]})]})]}),b&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),t.jsx(Q,{value:x,onChange:u=>d(u.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(L,{variant:"danger",size:"sm",onClick:z,isLoading:v.isPending,children:"Confirm Rejection"}),t.jsx(L,{variant:"ghost",size:"sm",onClick:()=>{g(!1),d("")},children:"Cancel"})]})]})]})]})}),t.jsxs(we,{align:"between",children:[t.jsx("div",{className:"flex gap-2",children:c?t.jsxs(t.Fragment,{children:[t.jsx(L,{variant:"success",size:"sm",onClick:A,isLoading:f.isPending,disabled:y,children:"Save & Approve"}),t.jsx(L,{variant:"ghost",size:"sm",onClick:K,disabled:y,children:"Cancel"})]}):t.jsxs(t.Fragment,{children:[t.jsx(L,{variant:"success",size:"sm",onClick:k,isLoading:m.isPending,disabled:y,children:"Approve (A)"}),t.jsx(L,{variant:"secondary",size:"sm",onClick:()=>o(!0),disabled:y,children:"Edit"})]})}),!c&&!b&&t.jsx(L,{variant:"danger",size:"sm",onClick:()=>g(!0),disabled:y,children:"Reject (R)"})]}),(m.isSuccess||v.isSuccess||f.isSuccess)&&t.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:t.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:t.jsxs("span",{className:"text-green-600 font-semibold",children:[m.isSuccess&&"Approved!",v.isSuccess&&"Rejected!",f.isSuccess&&"Updated!"]})})})]})},Ke=()=>{const{user:r,loading:e}=he(),{data:s,isLoading:a,error:n,refetch:c}=ge(),o=xe(),l=fe(),i=ye(),[x,d]=h.useState("pending"),[b,g]=h.useState("newest"),[m,v]=h.useState(new Set);if(e||a)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})});if(!r)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),t.jsx(de,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});if(n)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),t.jsx("p",{className:"text-gray-600 mb-4",children:n.message}),t.jsx("button",{onClick:()=>c(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})});const f=s||[],k=f.filter(u=>u.status==="pending").length,z=f.filter(u=>u.status==="approved").length,A=async(u,N)=>{try{await o.mutateAsync({annotationId:u,notes:N}),c()}catch(R){console.error("Failed to approve annotation:",R)}},K=async(u,N)=>{try{await l.mutateAsync({annotationId:u,reason:N}),c()}catch(R){console.error("Failed to reject annotation:",R)}},y=async(u,N)=>{try{await i.mutateAsync({annotationId:u,updates:N}),c()}catch(R){console.error("Failed to edit annotation:",R)}},w=async()=>{const u=`Approve ${m.size} annotations?`;if(window.confirm(u)){for(const N of m)await A(N);v(new Set)}};return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),t.jsxs("div",{className:"flex gap-4 text-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:k}),t.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-green-600",children:z}),t.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:f.length}),t.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>d("pending"),className:`px-4 py-2 rounded-md font-medium ${x==="pending"?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Pending (",k,")"]}),t.jsxs("button",{onClick:()=>d("all"),className:`px-4 py-2 rounded-md font-medium ${x==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",f.length,")"]})]}),m.size>0&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[m.size," selected"]}),t.jsx("button",{onClick:w,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md",children:"Bulk Approve"}),t.jsx("button",{onClick:()=>v(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),f.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),t.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:f.map(u=>t.jsx(Be,{annotation:u,imageUrl:u.imageUrl||"",onApprove:A,onReject:K,onEdit:y},u.id))})]})]})};export{Ke as AdminAnnotationReviewPage,Ke as default};
