var re=Object.defineProperty;var J=r=>{throw TypeError(r)};var ae=(r,e,s)=>e in r?re(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var D=(r,e,s)=>ae(r,typeof e!="symbol"?e+"":e,s),V=(r,e,s)=>e.has(r)||J("Cannot "+s);var b=(r,e,s)=>(V(r,e,"read from private field"),s?s.call(r):e.get(r)),A=(r,e,s)=>e.has(r)?J("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,s),q=(r,e,s,a)=>(V(r,e,"write to private field"),a?a.call(r,s):e.set(r,s),s),P=(r,e,s)=>(V(r,e,"access private method"),s);import{S as ne,s as ie,h as Z,g as le,n as te,u as M,a as oe,b as ce,i as I,e as U,j as t,q as se}from"./index-CKg-CX02.js";import{r as h,L as de}from"./react-vendor-DDsanEFO.js";import{u as ue}from"./useQuery-BHJYa0B9.js";import{s as L,u as he}from"./useSupabaseAuth-Bzwrou7p.js";import{a as G}from"./index-ngrFHoWO.js";var E,$,C,T,F,Y,W,ee,me=(ee=class extends ne{constructor(e,s){super();A(this,F);A(this,E);A(this,$);A(this,C);A(this,T);q(this,E,e),this.setOptions(s),this.bindMethods(),P(this,F,Y).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var a;const s=this.options;this.options=b(this,E).defaultMutationOptions(e),ie(this.options,s)||b(this,E).getMutationCache().notify({type:"observerOptionsUpdated",mutation:b(this,C),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&Z(s.mutationKey)!==Z(this.options.mutationKey)?this.reset():((a=b(this,C))==null?void 0:a.state.status)==="pending"&&b(this,C).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=b(this,C))==null||e.removeObserver(this)}onMutationUpdate(e){P(this,F,Y).call(this),P(this,F,W).call(this,e)}getCurrentResult(){return b(this,$)}reset(){var e;(e=b(this,C))==null||e.removeObserver(this),q(this,C,void 0),P(this,F,Y).call(this),P(this,F,W).call(this)}mutate(e,s){var a;return q(this,T,s),(a=b(this,C))==null||a.removeObserver(this),q(this,C,b(this,E).getMutationCache().build(b(this,E),this.options)),b(this,C).addObserver(this),b(this,C).execute(e)}},E=new WeakMap,$=new WeakMap,C=new WeakMap,T=new WeakMap,F=new WeakSet,Y=function(){var s;const e=((s=b(this,C))==null?void 0:s.state)??le();q(this,$,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},W=function(e){te.batch(()=>{var s,a,l,c,o,i,n,m;if(b(this,T)&&this.hasListeners()){const d=b(this,$).variables,f=b(this,$).context,x={client:b(this,E),meta:this.options.meta,mutationKey:this.options.mutationKey};(e==null?void 0:e.type)==="success"?((a=(s=b(this,T)).onSuccess)==null||a.call(s,e.data,d,f,x),(c=(l=b(this,T)).onSettled)==null||c.call(l,e.data,null,d,f,x)):(e==null?void 0:e.type)==="error"&&((i=(o=b(this,T)).onError)==null||i.call(o,e.error,d,f,x),(m=(n=b(this,T)).onSettled)==null||m.call(n,void 0,e.error,d,f,x))}this.listeners.forEach(d=>{d(b(this,$))})})},ee);function z(r,e){const s=M(),[a]=h.useState(()=>new me(s,r));h.useEffect(()=>{a.setOptions(r)},[a,r]);const l=h.useSyncExternalStore(h.useCallback(o=>a.subscribe(te.batchCalls(o)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),c=h.useCallback((o,i)=>{a.mutate(o,i).catch(oe)},[a]);if(l.error&&ce(a.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:c,mutateAsync:l.mutate}}const ge=()=>ue({queryKey:["annotations","pending"],queryFn:async()=>{I("Fetching pending annotations from Supabase");const{data:r,error:e}=await L.from("ai_annotation_items").select("*").eq("status","pending").order("created_at",{ascending:!1});if(e)throw U("Failed to fetch pending annotations",new Error(e.message)),new Error(e.message);const s=[...new Set((r==null?void 0:r.map(i=>i.image_id))||[])],{data:a,error:l}=await L.from("images").select("id, url").in("id",s);l&&U("Failed to fetch image URLs",new Error(l.message));const c=new Map((a==null?void 0:a.map(i=>[i.id,i.url]))||[]),o=(r==null?void 0:r.map(i=>{var d,f,x;let n=typeof i.bounding_box=="string"?JSON.parse(i.bounding_box):i.bounding_box;n&&n.x!==void 0&&!n.topLeft&&(n={topLeft:{x:n.x,y:n.y},bottomRight:{x:n.x+n.width,y:n.y+n.height},width:n.width,height:n.height});const m={id:i.id,imageId:i.image_id,spanishTerm:i.spanish_term,englishTerm:i.english_term,boundingBox:n,type:i.annotation_type,difficultyLevel:i.difficulty_level,pronunciation:i.pronunciation,confidenceScore:parseFloat(i.confidence.toString()),status:i.status,isVisible:i.status==="approved",createdAt:new Date(i.created_at),updatedAt:new Date(i.created_at),imageUrl:c.get(i.image_id)||""};return console.log("âœ… Annotation transformed:",{spanish:i.spanish_term+" â†’ "+m.spanishTerm,bbox_raw:i.bounding_box,bbox_transformed:m.boundingBox,has_topLeft:!!((d=m.boundingBox)!=null&&d.topLeft),has_width:(f=m.boundingBox)==null?void 0:f.width,has_height:(x=m.boundingBox)==null?void 0:x.height}),m}))||[];return I("Pending annotations fetched with image URLs",{count:o.length}),console.log("Final enriched annotations sample:",o[0]),o}}),xe=()=>{const r=M();return z({mutationFn:async({annotationId:e,notes:s})=>{const{data:a,error:l}=await L.from("ai_annotation_items").update({status:"approved"}).eq("id",e).select().single();if(l)throw new Error(l.message);return s&&await L.from("ai_annotation_reviews").insert({annotation_id:e,action:"approved",notes:s}),a},onSuccess:()=>{r.invalidateQueries({queryKey:["annotations"]}),I("Annotation approved successfully")}})},fe=()=>{const r=M();return z({mutationFn:async({annotationId:e,reason:s})=>{const{data:a,error:l}=await L.from("ai_annotation_items").update({status:"rejected"}).eq("id",e).select().single();if(l)throw new Error(l.message);return await L.from("ai_annotation_reviews").insert({annotation_id:e,action:"rejected",notes:s}),a},onSuccess:()=>{r.invalidateQueries({queryKey:["annotations"]}),I("Annotation rejected")}})},ye=()=>{const r=M();return z({mutationFn:async({annotationId:e,updates:s})=>{const{data:a,error:l}=await L.from("ai_annotation_items").update({...s,status:"edited"}).eq("id",e).select().single();if(l)throw new Error(l.message);return a},onSuccess:()=>{r.invalidateQueries({queryKey:["annotations"]}),I("Annotation edited successfully")}})},pe=({variant:r="default",padding:e="md",hover:s=!1,className:a="",children:l,...c})=>{const o="bg-white rounded-lg overflow-hidden",i={default:"shadow-sm",elevated:"shadow-lg",outlined:"border border-gray-200",interactive:"shadow-md hover:shadow-xl cursor-pointer transition-all"},n={none:"",sm:"p-3",md:"p-4",lg:"p-6"},m=s?"transform hover:scale-105 transition-transform":"";return t.jsx("div",{className:`${o} ${i[r]} ${n[e]} ${m} ${a}`,...c,children:l})},be=({title:r,subtitle:e,action:s,className:a="",children:l,...c})=>t.jsx("div",{className:`border-b border-gray-100 pb-3 mb-3 ${a}`,...c,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[r&&t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r}),e&&t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e}),l]}),s&&t.jsx("div",{className:"ml-4",children:s})]})}),ve=({className:r="",children:e,...s})=>t.jsx("div",{className:`${r}`,...s,children:e}),we=({align:r="right",className:e="",children:s,...a})=>{const l={left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"};return t.jsx("div",{className:`border-t border-gray-100 pt-3 mt-3 flex ${l[r]} ${e}`,...a,children:s})},B=({variant:r="primary",size:e="md",isLoading:s=!1,fullWidth:a=!1,leftIcon:l,rightIcon:c,children:o,className:i="",disabled:n,...m})=>{const d="inline-flex items-center justify-center font-semibold rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",f={primary:"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:shadow-xl transform hover:scale-105 focus:ring-blue-500",secondary:"bg-white text-gray-800 shadow-lg hover:shadow-xl transform hover:scale-105 focus:ring-gray-300",danger:"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg focus:ring-red-500",success:"bg-green-500 text-white hover:bg-green-600 hover:shadow-lg focus:ring-green-500",outline:"border-2 border-gray-300 text-gray-700 bg-transparent hover:bg-gray-50 focus:ring-gray-300",ghost:"text-gray-700 bg-transparent hover:bg-gray-100 focus:ring-gray-300"},x={sm:"px-3 py-1.5 text-sm",md:"px-6 py-2.5 text-base",lg:"px-8 py-4 text-lg"},g=a?"w-full":"";return t.jsxs("button",{className:`${d} ${f[r]} ${x[e]} ${g} ${i}`,disabled:n||s,...m,children:[s&&t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!s&&l&&t.jsx("span",{className:"mr-2",children:l}),o,!s&&c&&t.jsx("span",{className:"ml-2",children:c})]})},H=({variant:r="default",size:e="md",rounded:s=!1,outlined:a=!1,dot:l=!1,className:c="",children:o,...i})=>{const n="inline-flex items-center font-medium transition-colors",m={default:a?"border border-gray-300 text-gray-700 bg-transparent":"bg-gray-100 text-gray-800",primary:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-100 text-blue-800",success:a?"border border-green-300 text-green-700 bg-transparent":"bg-green-100 text-green-800",warning:a?"border border-yellow-300 text-yellow-700 bg-transparent":"bg-yellow-100 text-yellow-800",danger:a?"border border-red-300 text-red-700 bg-transparent":"bg-red-100 text-red-800",info:a?"border border-blue-300 text-blue-700 bg-transparent":"bg-blue-50 text-blue-700"},d={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"},f=s?"rounded-full":"rounded",x={default:"bg-gray-500",primary:"bg-blue-500",success:"bg-green-500",warning:"bg-yellow-500",danger:"bg-red-500",info:"bg-blue-500"};return t.jsxs("span",{className:`${n} ${m[r]} ${d[e]} ${f} ${c}`,...i,children:[l&&t.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${x[r]}`}),o]})},Q=h.forwardRef(({label:r,error:e,helperText:s,leftIcon:a,rightIcon:l,fullWidth:c=!1,className:o="",disabled:i,...n},m)=>{const d="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1",f="border-gray-300 focus:border-blue-500 focus:ring-blue-500",x="border-red-500 focus:border-red-500 focus:ring-red-500",g="bg-gray-100 cursor-not-allowed",v=c?"w-full":"",y=e?x:f;return t.jsxs("div",{className:`${c?"w-full":""}`,children:[r&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r,n.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[a&&t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:a}),t.jsx("input",{ref:m,className:`${d} ${y} ${v} ${a?"pl-10":""} ${l?"pr-10":""} ${i?g:""} ${o}`,disabled:i,"aria-invalid":!!e,"aria-describedby":e?`${n.id}-error`:s?`${n.id}-helper`:void 0,...n}),l&&t.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400",children:l})]}),e&&t.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${n.id}-error`,role:"alert",children:e}),s&&!e&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${n.id}-helper`,children:s})]})});Q.displayName="Input";const je=h.forwardRef(({label:r,error:e,helperText:s,fullWidth:a=!1,className:l="",disabled:c,...o},i)=>{const n="block px-4 py-2 text-gray-900 bg-white border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 resize-y",m="border-gray-300 focus:border-blue-500 focus:ring-blue-500",d="border-red-500 focus:border-red-500 focus:ring-red-500",f="bg-gray-100 cursor-not-allowed",x=a?"w-full":"",g=e?d:m;return t.jsxs("div",{className:`${a?"w-full":""}`,children:[r&&t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r,o.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("textarea",{ref:i,className:`${n} ${g} ${x} ${c?f:""} ${l}`,disabled:c,"aria-invalid":!!e,"aria-describedby":e?`${o.id}-error`:s?`${o.id}-helper`:void 0,...o}),e&&t.jsx("p",{className:"mt-1 text-sm text-red-600",id:`${o.id}-error`,role:"alert",children:e}),s&&!e&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",id:`${o.id}-helper`,children:s})]})});je.displayName="TextArea";class Ne{constructor(){D(this,"dirtyRects",[]);D(this,"isDirty",!1)}markDirty(e,s,a,l){this.dirtyRects.push({x:e,y:s,width:a,height:l}),this.isDirty=!0}markFullDirty(e,s){this.dirtyRects=[{x:0,y:0,width:e,height:s}],this.isDirty=!0}getDirtyRegions(){return this.dirtyRects}clear(){this.dirtyRects=[],this.isDirty=!1}hasDirtyRegions(){return this.isDirty}optimize(){if(this.dirtyRects.length<=1)return;const e=[],s=[...this.dirtyRects].sort((l,c)=>l.x-c.x);let a=s[0];for(let l=1;l<s.length;l++){const c=s[l];this.rectanglesOverlap(a,c)?a=this.mergeRectangles(a,c):(e.push(a),a=c)}e.push(a),this.dirtyRects=e}rectanglesOverlap(e,s){return!(e.x+e.width<s.x||s.x+s.width<e.x||e.y+e.height<s.y||s.y+s.height<e.y)}mergeRectangles(e,s){const a=Math.min(e.x,s.x),l=Math.min(e.y,s.y),c=Math.max(e.x+e.width,s.x+s.width)-a,o=Math.max(e.y+e.height,s.y+s.height)-l;return{x:a,y:l,width:c,height:o}}}class Se{constructor(){D(this,"frameTimestamps",[]);D(this,"drawCallCount",0);D(this,"lastReportTime",0);D(this,"sampleSize",60)}recordFrame(e){this.frameTimestamps.push(e),this.frameTimestamps.length>this.sampleSize&&this.frameTimestamps.shift()}recordDrawCall(){this.drawCallCount++}getCurrentFPS(){if(this.frameTimestamps.length<2)return 0;const e=this.frameTimestamps[this.frameTimestamps.length-1]-this.frameTimestamps[0],s=this.frameTimestamps.length-1;return Math.round(s/e*1e3)}getAverageFPS(){if(this.frameTimestamps.length<2)return 0;const e=[];for(let a=1;a<this.frameTimestamps.length;a++)e.push(this.frameTimestamps[a]-this.frameTimestamps[a-1]);const s=e.reduce((a,l)=>a+l,0)/e.length;return Math.round(1e3/s)}getDrawCallCount(){return this.drawCallCount}getMetrics(){return{currentFPS:this.getCurrentFPS(),averageFPS:this.getAverageFPS(),drawCalls:this.drawCallCount,frameCount:this.frameTimestamps.length}}reset(){this.frameTimestamps=[],this.drawCallCount=0,this.lastReportTime=0}shouldReport(e,s=5e3){return e-this.lastReportTime>=s?(this.lastReportTime=e,!0):!1}}const Ce=(r,e=16)=>{const s=h.useRef();return h.useCallback(a=>{s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{r(a)},e)},[r,e])},Re=({imageUrl:r,onImageLoad:e,performanceMonitor:s})=>{const a=h.useRef(null),l=h.useRef(null),c=h.useCallback(o=>{const i=a.current;if(!i)return;const n=i.getContext("2d",{alpha:!1});n&&(i.width=o.width,i.height=o.height,performance.mark("static-layer-start"),n.drawImage(o,0,0),performance.mark("static-layer-end"),performance.measure("static-layer-render","static-layer-start","static-layer-end"),s.recordDrawCall())},[s]);return h.useEffect(()=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{l.current=o,c(o),e(o,{width:o.width,height:o.height})},o.src=r},[r,c,e]),t.jsx("canvas",{ref:a,className:"max-w-full h-auto",style:{position:"absolute",top:0,left:0,width:"100%",zIndex:1,pointerEvents:"none"}})},ke={anatomical:"#3B82F6",behavioral:"#10B981",color:"#F59E0B",pattern:"#8B5CF6"},Ee=({annotations:r,dimensions:e,showLabels:s,imageLoaded:a,performanceMonitor:l})=>{const c=h.useRef(null),o=h.useCallback(()=>{const i=c.current;if(!i||!a)return;const n=i.getContext("2d",{alpha:!0});n&&(i.width=e.width,i.height=e.height,performance.mark("interactive-layer-start"),n.clearRect(0,0,i.width,i.height),r.forEach(m=>{const{boundingBox:d,type:f}=m,x=ke[f]||"#3B82F6";n.strokeStyle=x,n.lineWidth=2,n.setLineDash([5,5]);const g=d.topLeft.x,v=d.topLeft.y,y=d.width,k=d.height;n.strokeRect(g,v,y,k),s&&(n.fillStyle=x,n.globalAlpha=.9,n.fillRect(g,v-25,y,25),n.globalAlpha=1,n.fillStyle="white",n.font="14px system-ui, -apple-system, sans-serif",n.textBaseline="middle",n.fillText(m.spanishTerm,g+5,v-12)),n.setLineDash([])}),performance.mark("interactive-layer-end"),performance.measure("interactive-layer-render","interactive-layer-start","interactive-layer-end"),l.recordDrawCall())},[r,e,a,s,l]);return h.useEffect(()=>{o()},[o]),t.jsx("canvas",{ref:c,className:"max-w-full h-auto",style:{position:"absolute",top:0,left:0,width:"100%",zIndex:2,pointerEvents:"none"}})},Te={anatomical:"#3B82F6",behavioral:"#10B981",color:"#F59E0B",pattern:"#8B5CF6"},Fe=({hoveredAnnotation:r,dimensions:e,imageLoaded:s,performanceMonitor:a})=>{const l=h.useRef(null),c=h.useRef(),o=h.useCallback(()=>{const i=l.current;if(!i||!s)return;const n=i.getContext("2d",{alpha:!0});if(!n)return;i.width=e.width,i.height=e.height,performance.mark("hover-layer-start");const m=()=>{if(n.clearRect(0,0,i.width,i.height),r){const{boundingBox:d,type:f}=r,x=Te[f]||"#3B82F6";n.strokeStyle=x,n.lineWidth=3,n.shadowColor=x,n.shadowBlur=10;const g=d.topLeft.x,v=d.topLeft.y,y=d.width,k=d.height;n.strokeRect(g,v,y,k),n.shadowBlur=0,n.fillStyle=x,n.globalAlpha=.95,n.fillRect(g,v-30,Math.max(y,150),30),n.globalAlpha=1,n.fillStyle="white",n.font="bold 14px system-ui, -apple-system, sans-serif",n.textBaseline="middle",n.fillText(r.spanishTerm,g+8,v-15)}if(performance.mark("hover-layer-end"),performance.measure("hover-layer-render","hover-layer-start","hover-layer-end"),a.recordDrawCall(),a.recordFrame(performance.now()),a.shouldReport(performance.now())){const d=a.getMetrics();console.log("[Canvas Performance]",{fps:d.currentFPS,avgFPS:d.averageFPS,drawCalls:d.drawCalls,frames:d.frameCount})}};c.current&&cancelAnimationFrame(c.current),c.current=requestAnimationFrame(m)},[r,e,s,a]);return h.useEffect(()=>{o()},[o]),h.useEffect(()=>()=>{c.current&&cancelAnimationFrame(c.current)},[]),t.jsx("canvas",{ref:l,className:"max-w-full h-auto",style:{position:"absolute",top:0,left:0,width:"100%",zIndex:3,pointerEvents:"auto"}})},$e=({imageUrl:r,annotations:e,onAnnotationHover:s,onAnnotationClick:a,interactive:l=!0,showLabels:c=!1})=>{const[o,i]=h.useState({width:0,height:0}),[n,m]=h.useState(null),[d,f]=h.useState(!1),x=h.useMemo(()=>new Se,[]),g=h.useMemo(()=>new Ne,[]),v=h.useCallback((p,w)=>{i(w),f(!0)},[]),y=p=>{for(const w of e){const{boundingBox:u}=w,{topLeft:N,width:R,height:S}=u;if(p.x>=N.x&&p.x<=N.x+R&&p.y>=N.y&&p.y<=N.y+S)return w}return null},k=h.useCallback(p=>{if(!l)return;const w=p.currentTarget.getBoundingClientRect(),u=o.width/w.width,N=o.height/w.height,R={x:(p.clientX-w.left)*u,y:(p.clientY-w.top)*N},S=y(R);if(S!==n){if(m(S),s==null||s(S),S){const{boundingBox:X}=S;g.markDirty(X.topLeft.x,X.topLeft.y-30,Math.max(X.width,150),X.height+30)}else g.markFullDirty(o.width,o.height);p.currentTarget.style.cursor=S?"pointer":"default"}},[l,o,n,s,g,y]),O=Ce(k,16),_=h.useCallback(p=>{if(!l)return;const w=p.currentTarget.getBoundingClientRect(),u=o.width/w.width,N=o.height/w.height,R={x:(p.clientX-w.left)*u,y:(p.clientY-w.top)*N},S=y(R);S&&(a==null||a(S),g.markDirty(S.boundingBox.topLeft.x,S.boundingBox.topLeft.y,S.boundingBox.width,S.boundingBox.height))},[l,o,a,g,y]),K=h.useCallback(()=>{m(null),s==null||s(null),g.markFullDirty(o.width,o.height)},[s,o,g]);return t.jsxs("div",{className:"relative inline-block max-w-full",onMouseMove:O,onClick:p=>_(p),onMouseLeave:K,children:[t.jsx(Re,{imageUrl:r,onImageLoad:v,performanceMonitor:x}),t.jsx(Ee,{annotations:e,dimensions:o,showLabels:c,imageLoaded:d,performanceMonitor:x}),t.jsx(Fe,{hoveredAnnotation:n,dimensions:o,imageLoaded:d,performanceMonitor:x}),t.jsx("div",{style:{width:o.width||"auto",height:o.height||"auto",visibility:"hidden"}}),!d&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:t.jsx("div",{className:"text-gray-500",children:"Cargando imagen..."})})]})},j={all:["ai-annotations"],lists:()=>[...j.all,"list"],list:r=>[...j.lists(),r],pending:()=>[...j.all,"pending"],stats:()=>[...j.all,"stats"]},De=()=>{const r=M();return z({mutationFn:async e=>(await G.post(`/api/annotations/ai/${e}/approve`)).data.data,onMutate:async e=>{await r.cancelQueries({queryKey:j.all});const s=r.getQueryData(j.pending());return s&&r.setQueryData(j.pending(),s.filter(a=>a.id!==e)),{previousData:s}},onSuccess:()=>{r.invalidateQueries({queryKey:j.all}),r.invalidateQueries({queryKey:j.stats()}),r.invalidateQueries({queryKey:se.annotations.all})},onError:(e,s,a)=>{a!=null&&a.previousData&&r.setQueryData(j.pending(),a.previousData),U("Error approving annotation",e instanceof Error?e:new Error(String(e)))}})},Be=()=>{const r=M();return z({mutationFn:async({annotationId:e,reason:s})=>(await G.post(`/api/annotations/ai/${e}/reject`,{reason:s})).data.data,onMutate:async({annotationId:e})=>{await r.cancelQueries({queryKey:j.all});const s=r.getQueryData(j.pending());return s&&r.setQueryData(j.pending(),s.filter(a=>a.id!==e)),{previousData:s}},onSuccess:()=>{r.invalidateQueries({queryKey:j.all}),r.invalidateQueries({queryKey:j.stats()})},onError:(e,s,a)=>{a!=null&&a.previousData&&r.setQueryData(j.pending(),a.previousData),U("Error rejecting annotation",e instanceof Error?e:new Error(String(e)))}})},Le=()=>{const r=M();return z({mutationFn:async({annotationId:e,updates:s})=>(await G.patch(`/api/annotations/ai/${e}`,s)).data.data,onSuccess:()=>{r.invalidateQueries({queryKey:j.all}),r.invalidateQueries({queryKey:j.stats()}),r.invalidateQueries({queryKey:se.annotations.all})},onError:e=>{U("Error editing annotation",e instanceof Error?e:new Error(String(e)))}})},Me=({annotation:r,imageUrl:e,onActionComplete:s,isSelected:a=!1,onSelect:l})=>{const[c,o]=h.useState(!1),[i,n]=h.useState({spanishTerm:r.spanishTerm,englishTerm:r.englishTerm,pronunciation:r.pronunciation||""}),[m,d]=h.useState(""),[f,x]=h.useState(!1),g=De(),v=Be(),y=Le(),k=async()=>{try{await g.mutateAsync(r.id),s==null||s()}catch{}},O=async()=>{try{await v.mutateAsync({annotationId:r.id,reason:m||void 0}),x(!1),d(""),s==null||s()}catch{}},_=async()=>{try{await y.mutateAsync({annotationId:r.id,updates:i}),o(!1),s==null||s()}catch{}},K=()=>{o(!1),n({spanishTerm:r.spanishTerm,englishTerm:r.englishTerm,pronunciation:r.pronunciation||""})},p=g.isPending||v.isPending||y.isPending,w=u=>u?u>=.8?"success":u>=.6?"warning":"danger":"default";return t.jsxs(pe,{variant:"elevated",className:"mb-4",children:[t.jsx(be,{children:t.jsxs("div",{className:"flex items-start justify-between w-full",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[l&&t.jsx("input",{type:"checkbox",checked:a,onChange:u=>l(u.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500","aria-label":"Select annotation for batch operations"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI-Generated Annotation"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",t.jsx("span",{className:"font-medium",children:r.type})]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[r.confidenceScore!==void 0&&t.jsxs(H,{variant:w(r.confidenceScore),size:"sm",children:["Confidence: ",(r.confidenceScore*100).toFixed(1),"%"]}),t.jsxs(H,{variant:"info",size:"sm",children:["Difficulty: ",r.difficultyLevel]})]})]})}),t.jsx(ve,{children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Image Preview"}),t.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:t.jsx($e,{imageUrl:e,annotations:[r],interactive:!1,showLabels:!0})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:c?"Edit Annotation Data":"Annotation Data"}),c?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Spanish Term"}),t.jsx(Q,{value:i.spanishTerm,onChange:u=>n({...i,spanishTerm:u.target.value}),placeholder:"Spanish term"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"English Term"}),t.jsx(Q,{value:i.englishTerm,onChange:u=>n({...i,englishTerm:u.target.value}),placeholder:"English term"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pronunciation (IPA)"}),t.jsx(Q,{value:i.pronunciation,onChange:u=>n({...i,pronunciation:u.target.value}),placeholder:"Pronunciation (optional)"})]})]}):t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Spanish:"})," ",t.jsx("span",{className:"text-base text-gray-900",children:r.spanishTerm})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"English:"})," ",t.jsx("span",{className:"text-base text-gray-900",children:r.englishTerm})]}),r.pronunciation&&t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pronunciation:"})," ",t.jsx("span",{className:"text-base text-gray-900 font-mono",children:r.pronunciation})]})]}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[t.jsx("h5",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Bounding Box (Normalized 0-1)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-blue-800 font-mono",children:[t.jsxs("div",{children:["X: ",r.boundingBox.topLeft.x.toFixed(2),", Y:"," ",r.boundingBox.topLeft.y.toFixed(2)]}),t.jsxs("div",{children:["W: ",r.boundingBox.width.toFixed(2),", H:"," ",r.boundingBox.height.toFixed(2)]})]})]}),f&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsx("label",{className:"block text-sm font-medium text-red-900 mb-2",children:"Rejection Reason (Optional)"}),t.jsx(Q,{value:m,onChange:u=>d(u.target.value),placeholder:"Why is this annotation being rejected?",className:"mb-3"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(B,{variant:"danger",size:"sm",onClick:O,isLoading:v.isPending,children:"Confirm Rejection"}),t.jsx(B,{variant:"ghost",size:"sm",onClick:()=>{x(!1),d("")},children:"Cancel"})]})]})]})]})}),t.jsxs(we,{align:"between",children:[t.jsx("div",{className:"flex gap-2",children:c?t.jsxs(t.Fragment,{children:[t.jsx(B,{variant:"success",size:"sm",onClick:_,isLoading:y.isPending,disabled:p,children:"Save & Approve"}),t.jsx(B,{variant:"ghost",size:"sm",onClick:K,disabled:p,children:"Cancel"})]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{variant:"success",size:"sm",onClick:k,isLoading:g.isPending,disabled:p,children:"Approve (A)"}),t.jsx(B,{variant:"secondary",size:"sm",onClick:()=>o(!0),disabled:p,children:"Edit"})]})}),!c&&!f&&t.jsx(B,{variant:"danger",size:"sm",onClick:()=>x(!0),disabled:p,children:"Reject (R)"})]}),(g.isSuccess||v.isSuccess||y.isSuccess)&&t.jsx("div",{className:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center rounded-lg pointer-events-none",children:t.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg",children:t.jsxs("span",{className:"text-green-600 font-semibold",children:[g.isSuccess&&"Approved!",v.isSuccess&&"Rejected!",y.isSuccess&&"Updated!"]})})})]})},Ke=()=>{const{user:r,loading:e}=he(),{data:s,isLoading:a,error:l,refetch:c}=ge(),o=xe(),i=fe(),n=ye(),[m,d]=h.useState("pending"),[f,x]=h.useState("newest"),[g,v]=h.useState(new Set);if(e||a)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading annotations..."})]})});if(!r)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to access the admin panel."}),t.jsx(de,{to:"/login",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Sign In"})]})});if(l)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error Loading Annotations"}),t.jsx("p",{className:"text-gray-600 mb-4",children:l.message}),t.jsx("button",{onClick:()=>c(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md",children:"Retry"})]})});const y=s||[],k=y.filter(u=>u.status==="pending").length,O=y.filter(u=>u.status==="approved").length,_=async(u,N)=>{try{await o.mutateAsync({annotationId:u,notes:N}),c()}catch(R){console.error("Failed to approve annotation:",R)}},K=async(u,N)=>{try{await i.mutateAsync({annotationId:u,reason:N}),c()}catch(R){console.error("Failed to reject annotation:",R)}},p=async(u,N)=>{try{await n.mutateAsync({annotationId:u,updates:N}),c()}catch(R){console.error("Failed to edit annotation:",R)}},w=async()=>{const u=`Approve ${g.size} annotations?`;if(window.confirm(u)){for(const N of g)await _(N);v(new Set)}};return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Annotation Review"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Review and approve Claude-generated bird annotations"})]}),t.jsxs("div",{className:"flex gap-4 text-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:k}),t.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-green-600",children:O}),t.jsx("div",{className:"text-xs text-gray-600",children:"Approved"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:y.length}),t.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]})]})]})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[t.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>d("pending"),className:`px-4 py-2 rounded-md font-medium ${m==="pending"?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Pending (",k,")"]}),t.jsxs("button",{onClick:()=>d("all"),className:`px-4 py-2 rounded-md font-medium ${m==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",y.length,")"]})]}),g.size>0&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("span",{className:"text-sm text-gray-600 self-center",children:[g.size," selected"]}),t.jsx("button",{onClick:w,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md",children:"Bulk Approve"}),t.jsx("button",{onClick:()=>v(new Set),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md",children:"Clear"})]})]})}),y.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"All Done!"}),t.jsx("p",{className:"text-gray-600",children:"No pending annotations to review."})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:y.map(u=>t.jsx(Me,{annotation:u,imageUrl:u.imageUrl||"",onApprove:_,onReject:K,onEdit:p},u.id))})]})]})};export{Ke as AdminAnnotationReviewPage,Ke as default};
